{
  "index_patterns": ["banking-logs-*"],
  "version": 1,
  "priority": 100,
  "template": {
    "settings": {
      "number_of_shards": 3,
      "number_of_replicas": 1,
      "index.lifecycle.name": "banking-logs-policy",
      "index.lifecycle.rollover_alias": "banking-logs",
      "refresh_interval": "30s",
      "analysis": {
        "analyzer": {
          "pci_analyzer": {
            "type": "custom",
            "tokenizer": "standard",
            "filter": [
              "lowercase",
              "pci_card_number_filter"
            ]
          }
        },
        "filter": {
          "pci_card_number_filter": {
            "type": "pattern_replace",
            "pattern": "\\d{4}[-\\s]?\\d{4}[-\\s]?\\d{4}[-\\s]?\\d{4}",
            "replacement": "****-****-****-XXXX"
          }
        }
      }
    },
    "mappings": {
      "properties": {
        "@timestamp": {
          "type": "date",
          "format": "strict_date_optional_time||epoch_millis"
        },
        "event": {
          "properties": {
            "id": {
              "type": "keyword",
              "index": true
            },
            "type": {
              "type": "keyword",
              "index": true
            },
            "category": {
              "type": "keyword",
              "index": true
            },
            "action": {
              "type": "keyword",
              "index": true
            },
            "outcome": {
              "type": "keyword",
              "index": true
            },
            "duration": {
              "type": "long"
            }
          }
        },
        "log": {
          "properties": {
            "level": {
              "type": "keyword",
              "index": true
            },
            "logger": {
              "type": "keyword",
              "index": true
            },
            "origin": {
              "properties": {
                "file": {
                  "properties": {
                    "line": {
                      "type": "integer"
                    },
                    "name": {
                      "type": "keyword",
                      "index": false
                    }
                  }
                },
                "function": {
                  "type": "keyword",
                  "index": false
                }
              }
            }
          }
        },
        "message": {
          "type": "text",
          "analyzer": "pci_analyzer",
          "fields": {
            "keyword": {
              "type": "keyword",
              "ignore_above": 1024
            }
          }
        },
        "service": {
          "properties": {
            "name": {
              "type": "keyword",
              "index": true
            },
            "version": {
              "type": "keyword",
              "index": true
            },
            "environment": {
              "type": "keyword",
              "index": true
            },
            "type": {
              "type": "keyword",
              "index": true
            }
          }
        },
        "host": {
          "properties": {
            "name": {
              "type": "keyword",
              "index": true
            },
            "hostname": {
              "type": "keyword",
              "index": true
            },
            "ip": {
              "type": "ip"
            },
            "mac": {
              "type": "keyword",
              "index": false
            }
          }
        },
        "process": {
          "properties": {
            "pid": {
              "type": "long"
            },
            "thread": {
              "properties": {
                "name": {
                  "type": "keyword",
                  "index": false
                },
                "id": {
                  "type": "long"
                }
              }
            }
          }
        },
        "user": {
          "properties": {
            "id": {
              "type": "keyword",
              "index": true
            },
            "name": {
              "type": "keyword",
              "index": true
            },
            "email": {
              "type": "keyword",
              "index": false
            },
            "roles": {
              "type": "keyword",
              "index": true
            }
          }
        },
        "client": {
          "properties": {
            "ip": {
              "type": "ip"
            },
            "user_agent": {
              "properties": {
                "original": {
                  "type": "keyword",
                  "index": false
                },
                "name": {
                  "type": "keyword",
                  "index": true
                },
                "version": {
                  "type": "keyword",
                  "index": false
                }
              }
            }
          }
        },
        "http": {
          "properties": {
            "request": {
              "properties": {
                "method": {
                  "type": "keyword",
                  "index": true
                },
                "id": {
                  "type": "keyword",
                  "index": true
                }
              }
            },
            "response": {
              "properties": {
                "status_code": {
                  "type": "long"
                }
              }
            }
          }
        },
        "url": {
          "properties": {
            "path": {
              "type": "wildcard"
            },
            "query": {
              "type": "keyword",
              "index": false
            }
          }
        },
        "transaction": {
          "properties": {
            "id": {
              "type": "keyword",
              "index": true
            },
            "type": {
              "type": "keyword",
              "index": true
            }
          }
        },
        "trace": {
          "properties": {
            "id": {
              "type": "keyword",
              "index": true
            }
          }
        },
        "span": {
          "properties": {
            "id": {
              "type": "keyword",
              "index": true
            }
          }
        },
        "error": {
          "properties": {
            "id": {
              "type": "keyword",
              "index": true
            },
            "message": {
              "type": "text",
              "analyzer": "pci_analyzer"
            },
            "type": {
              "type": "keyword",
              "index": true
            },
            "stack_trace": {
              "type": "text",
              "index": false
            },
            "code": {
              "type": "keyword",
              "index": true
            }
          }
        },
        "data_classification": {
          "type": "keyword",
          "index": true
        },
        "data_residency": {
          "type": "keyword",
          "index": true
        },
        "pci_scope": {
          "type": "boolean"
        },
        "audit_required": {
          "type": "boolean"
        },
        "compliance": {
          "properties": {
            "framework": {
              "type": "keyword",
              "index": true
            },
            "requirement": {
              "type": "keyword",
              "index": true
            },
            "status": {
              "type": "keyword",
              "index": true
            }
          }
        },
        "business": {
          "properties": {
            "process": {
              "type": "keyword",
              "index": true
            },
            "domain": {
              "type": "keyword",
              "index": true
            },
            "action": {
              "type": "keyword",
              "index": true
            }
          }
        },
        "security": {
          "properties": {
            "event_type": {
              "type": "keyword",
              "index": true
            },
            "severity": {
              "type": "keyword",
              "index": true
            },
            "threat_level": {
              "type": "keyword",
              "index": true
            }
          }
        },
        "gdpr": {
          "properties": {
            "applicable": {
              "type": "boolean"
            },
            "personal_data": {
              "type": "boolean"
            },
            "consent_id": {
              "type": "keyword",
              "index": true
            },
            "legal_basis": {
              "type": "keyword",
              "index": true
            }
          }
        },
        "performance": {
          "properties": {
            "duration_ms": {
              "type": "long"
            },
            "memory_usage": {
              "type": "long"
            },
            "cpu_usage": {
              "type": "long"
            }
          }
        },
        "custom_attributes": {
          "type": "object",
          "dynamic": true
        },
        "tags": {
          "type": "keyword",
          "index": true
        },
        "labels": {
          "type": "object",
          "dynamic": true
        }
      }
    },
    "aliases": {
      "banking-logs": {}
    }
  },
  "composed_of": [],
  "_meta": {
    "description": "Template for banking application logs with PCI-DSS v4 compliance",
    "version": {
      "major": 1,
      "minor": 0,
      "patch": 0
    },
    "compliance_frameworks": [
      "PCI-DSS-v4",
      "GDPR",
      "CCPA",
      "SOX"
    ],
    "data_retention": {
      "hot_phase": "7d",
      "warm_phase": "30d",
      "cold_phase": "90d",
      "delete_phase": "2555d"
    }
  }
}