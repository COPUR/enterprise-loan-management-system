# HTTP Message Signature Validation Configuration
security:
  signature:
    # Enable/disable signature validation
    enabled: true
    
    # Enforce signature validation (true) or just log violations (false)
    enforced: true
    
    # Paths that require signature validation
    protected-paths:
      - "/api/v1/loans"
      - "/api/v1/loans/**"
      - "/api/v1/payments"
      - "/api/v1/payments/**"
      - "/api/v1/customers"
      - "/api/v1/customers/**"
      - "/api/v1/admin/**"
    
    # Paths excluded from signature validation
    excluded-paths:
      - "/actuator/**"
      - "/swagger-ui/**"
      - "/v3/api-docs/**"
      - "/auth/**"
      - "/public/**"
      - "/health"
      - "/metrics"
    
    # JWK Set URLs for key resolution
    jwk-sets:
      urls:
        keycloak: "https://auth.loanmanagement.com/auth/realms/banking/protocol/openid_connect/certs"
        internal: "https://api.loanmanagement.com/.well-known/jwks.json"
        backup: "https://backup-auth.loanmanagement.com/.well-known/jwks.json"

# Cache configuration for signature keys
spring:
  cache:
    cache-names:
      - signature-keys
    caffeine:
      spec: maximumSize=1000,expireAfterWrite=300s

# Logging configuration for signature validation
logging:
  level:
    com.loanmanagement.security.signature: DEBUG
    org.springframework.security: INFO
  pattern:
    console: "%d{ISO8601} [%thread] %-5level %logger{36} - %msg%n"

# FAPI compliance settings
fapi:
  signature:
    # Maximum allowed timestamp skew in seconds
    max-timestamp-skew: 300
    
    # Required signature algorithms (FAPI compliant)
    allowed-algorithms:
      - "rsa-sha256"
      - "ecdsa-sha256"
    
    # Required headers for different request types
    required-headers:
      get:
        - "(request-target)"
        - "host"
        - "date"
      post:
        - "(request-target)"
        - "host"
        - "date"
        - "content-length"
        - "digest"
      put:
        - "(request-target)"
        - "host"
        - "date"
        - "content-length"
        - "digest"
      patch:
        - "(request-target)"
        - "host"
        - "date"
        - "content-length"
        - "digest"
      delete:
        - "(request-target)"
        - "host"
        - "date"