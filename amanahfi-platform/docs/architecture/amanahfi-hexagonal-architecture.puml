@startuml AmanahFi Islamic Banking Platform - Hexagonal Architecture

!define PRIMARY_COLOR #4A90E2
!define SECONDARY_COLOR #7ED321
!define INFRASTRUCTURE_COLOR #F5A623
!define DOMAIN_COLOR #BD10E0
!define ISLAMIC_COLOR #228B22
!define SECURITY_COLOR #DC143C
!define CBDC_COLOR #FFD700
!define EVENT_COLOR #9B59B6
!define CACHE_COLOR #DC382D

skinparam backgroundColor #FFFFFF
skinparam componentStyle rectangle

title AmanahFi Islamic Banking Platform - Event-Driven Hexagonal Architecture v2.0.0

package "Infrastructure Layer (Kubernetes/Istio)" <<Frame>> {
    
    package "Input Adapters" {
        component [REST API Gateway\n(FAPI 2.0 + OAuth 2.1)] as ApiGateway INFRASTRUCTURE_COLOR
        component [Islamic Banking APIs\n(Murabaha, Musharakah)] as IslamicAPIs ISLAMIC_COLOR
        component [CBDC Integration Gateway\n(UAE Digital Dirham)] as CBDCGateway CBDC_COLOR
        component [Event Stream Consumers\n(Kafka Event Processing)] as EventConsumers EVENT_COLOR
        component [Security Headers Filter\n(DPoP + mTLS)] as SecurityFilter SECURITY_COLOR
        component [Sharia Compliance Filter\n(Real-time Validation)] as ShariaFilter ISLAMIC_COLOR
        component [Rate Limiting Filter\n(DDoS Protection)] as RateLimitFilter SECURITY_COLOR
    }
    
    package "Output Adapters" {
        component [Event Store Repository\n(PostgreSQL Events)] as EventStore EVENT_COLOR
        component [Redis Cache Cluster\n(Islamic Finance Cache)] as RedisCache CACHE_COLOR
        component [CBDC Wallet Integration\n(Central Bank APIs)] as CBDCWallet CBDC_COLOR
        component [Sharia Board APIs\n(Compliance Validation)] as ShariaAPIs ISLAMIC_COLOR
        component [External Bank APIs\n(UAE Banks Integration)] as ExternalBanks INFRASTRUCTURE_COLOR
        component [Audit Trail Repository\n(Compliance Tracking)] as AuditTrail SECURITY_COLOR
        component [Event Publishers\n(Domain Event Streaming)] as EventPublishers EVENT_COLOR
    }
    
    package "Security & Configuration" {
        component [FAPI 2.0 Security Config\n(DPoP + Certificate Binding)] as SecurityConfig SECURITY_COLOR
        component [Islamic Banking Config\n(Sharia Compliance Rules)] as IslamicConfig ISLAMIC_COLOR
        component [CBDC Configuration\n(Digital Currency Rules)] as CBDCConfig CBDC_COLOR
        component [Keycloak Integration\n(OAuth 2.1 + MFA)] as KeycloakConfig SECURITY_COLOR
        component [Redis Configuration\n(Cache Strategies)] as CacheConfig CACHE_COLOR
        component [Kubernetes Config\n(Service Mesh + HPA)] as K8sConfig INFRASTRUCTURE_COLOR
    }
}

package "Application Layer (Islamic Finance Orchestration)" <<Frame>> {
    component [Murabaha Services\n(Cost-Plus Financing)] as MurabahaServices ISLAMIC_COLOR
    component [Musharakah Services\n(Partnership Financing)] as MusharakahServices ISLAMIC_COLOR
    component [Ijarah Services\n(Islamic Leasing)] as IjarahServices ISLAMIC_COLOR
    component [CBDC Payment Services\n(Digital Dirham)] as CBDCServices CBDC_COLOR
    component [Compliance Services\n(Sharia Validation)] as ComplianceServices ISLAMIC_COLOR
    component [Account Services\n(Islamic Accounts)] as AccountServices ISLAMIC_COLOR
    component [Event Orchestration\n(Domain Event Coordination)] as EventOrchestration EVENT_COLOR
    component [Cache Management\n(Islamic Finance Cache)] as CacheManagement CACHE_COLOR
}

package "Domain Layer (Islamic Banking Core)" <<Frame>> {
    
    package "Islamic Finance Aggregates" {
        component [Murabaha Aggregate\n(Cost-Plus Contracts)] as MurabahaAggregate ISLAMIC_COLOR
        component [Customer Aggregate\n(Islamic KYC + AML)] as CustomerAggregate DOMAIN_COLOR
        component [Account Aggregate\n(Sharia-Compliant)] as AccountAggregate ISLAMIC_COLOR
        component [CBDC Wallet Aggregate\n(Digital Currency)] as CBDCAggregate CBDC_COLOR
        component [Payment Aggregate\n(Islamic Transactions)] as PaymentAggregate ISLAMIC_COLOR
        component [Compliance Aggregate\n(Sharia Validation)] as ComplianceAggregate ISLAMIC_COLOR
    }
    
    package "Islamic Finance Events" {
        component [MurabahaContractCreated\n(Purchase Order Event)] as MurabahaCreated EVENT_COLOR
        component [ProfitCalculated\n(Markup Determined)] as ProfitCalculated EVENT_COLOR
        component [ShariaComplianceValidated\n(Board Approval)] as ShariaValidated ISLAMIC_COLOR
        component [CBDCTransferCompleted\n(Digital Currency)] as CBDCTransfer CBDC_COLOR
        component [IslamicPaymentProcessed\n(Halal Transaction)] as IslamicPayment ISLAMIC_COLOR
        component [ComplianceCheckCompleted\n(Audit Event)] as ComplianceCheck ISLAMIC_COLOR
    }
    
    package "Islamic Finance Value Objects" {
        component [ShariaCompliantMoney\n(No Interest/Riba)] as ShariaCompliantMoney ISLAMIC_COLOR
        component [ProfitSharingRatio\n(Musharakah Terms)] as ProfitSharingRatio ISLAMIC_COLOR
        component [IslamicProductType\n(Halal Categories)] as IslamicProductType ISLAMIC_COLOR
        component [ShariaApprovalStatus\n(Board Validation)] as ShariaApprovalStatus ISLAMIC_COLOR
        component [CBDCAmount\n(Digital Currency)] as CBDCAmount CBDC_COLOR
        component [ComplianceLevel\n(Regulatory Grade)] as ComplianceLevel ISLAMIC_COLOR
    }
    
    package "Islamic Finance Domain Services" {
        component [Profit Calculation Service\n(No Interest Calculation)] as ProfitCalculationService ISLAMIC_COLOR
        component [Sharia Compliance Service\n(Real-time Validation)] as ShariaComplianceService ISLAMIC_COLOR
        component [Islamic Risk Assessment\n(Sharia-Compliant Risk)] as IslamicRiskService ISLAMIC_COLOR
        component [CBDC Integration Service\n(Central Bank Digital Currency)] as CBDCIntegrationService CBDC_COLOR
        component [Audit Trail Service\n(Compliance Tracking)] as AuditTrailService SECURITY_COLOR
    }
    
    package "Ports - Clean Interfaces" {
        component [Murabaha Repository Port\n(Islamic Contract Store)] as MurabahaPort ISLAMIC_COLOR
        component [Customer Repository Port\n(Islamic KYC Interface)] as CustomerPort PRIMARY_COLOR
        component [CBDC Wallet Port\n(Digital Currency Interface)] as CBDCPort CBDC_COLOR
        component [Sharia Board Port\n(Compliance Interface)] as ShariaPort ISLAMIC_COLOR
        component [Event Store Port\n(Islamic Event Sourcing)] as EventStorePort EVENT_COLOR
        component [Cache Port\n(Islamic Finance Cache)] as CachePort CACHE_COLOR
    }
}

' External Systems (UAE Financial Infrastructure)
cloud "UAE Financial Infrastructure" {
    database "PostgreSQL Event Store\n(Sharia-Compliant Events)" as Database DOMAIN_COLOR
    queue "Apache Kafka MSK\n(Islamic Event Streaming)" as Kafka EVENT_COLOR
    storage "Redis ElastiCache\n(Islamic Finance Cache)" as Redis CACHE_COLOR
    component "UAE Central Bank\n(CBDC Infrastructure)" as CentralBank CBDC_COLOR
    component "Sharia Board APIs\n(Compliance Validation)" as ShariaBoard ISLAMIC_COLOR
    component "UAE Banks Network\n(Multi-Bank Integration)" as UAEBanks INFRASTRUCTURE_COLOR
}

' Islamic Finance Service Domains
package "Islamic Finance Service Domains" <<Frame>> {
    component [Murabaha Service Domain\n(Cost-Plus Financing)] as MurabahaSD ISLAMIC_COLOR
    component [Musharakah Service Domain\n(Partnership Financing)] as MusharakahSD ISLAMIC_COLOR
    component [Ijarah Service Domain\n(Islamic Leasing)] as IjarahSD ISLAMIC_COLOR
    component [CBDC Service Domain\n(Digital Currency)] as CBDCSD CBDC_COLOR
    component [Sharia Compliance Domain\n(Religious Validation)] as ShariaSD ISLAMIC_COLOR
    component [Islamic Risk Domain\n(Sharia-Compliant Risk)] as RiskSD ISLAMIC_COLOR
}

' Event-Driven Islamic Banking Connections
EventConsumers --> EventOrchestration : Process Islamic Events
EventOrchestration --> MurabahaServices : Murabaha Contracts
EventOrchestration --> CBDCServices : Digital Currency
EventOrchestration --> ComplianceServices : Sharia Validation

' Islamic Finance Domain Event Flow
MurabahaAggregate --> MurabahaCreated : raises
MurabahaAggregate --> ProfitCalculated : raises
ComplianceAggregate --> ShariaValidated : raises
CBDCAggregate --> CBDCTransfer : raises
PaymentAggregate --> IslamicPayment : raises

' Application Layer Islamic Finance Coordination
MurabahaServices --> MurabahaPort : Islamic Contracts
CBDCServices --> CBDCPort : Digital Currency
ComplianceServices --> ShariaPort : Compliance Check
AccountServices --> CustomerPort : Islamic Accounts

' Domain Layer Internal Islamic Finance Relationships
MurabahaPort --> MurabahaAggregate : orchestrates
CustomerPort --> CustomerAggregate : orchestrates
CBDCPort --> CBDCAggregate : orchestrates
ShariaPort --> ComplianceAggregate : orchestrates

' Islamic Finance Service Domain Integration
MurabahaSD --> MurabahaAggregate : Sharia Compliant
CBDCSD --> CBDCAggregate : Digital Currency
ShariaSD --> ComplianceAggregate : Religious Validation
RiskSD --> IslamicRiskService : Islamic Risk

' Value Objects Integration
MurabahaAggregate --> ShariaCompliantMoney : contains
MurabahaAggregate --> ProfitSharingRatio : contains
CBDCAggregate --> CBDCAmount : contains
ComplianceAggregate --> ShariaApprovalStatus : contains

' Islamic Finance Infrastructure Implementation
ApiGateway --> SecurityFilter : FAPI 2.0 Authentication
SecurityFilter --> ShariaFilter : Sharia Validation
ShariaFilter --> MurabahaServices : Islamic Requests
IslamicAPIs --> ComplianceServices : Compliance Check

EventStore --> Database : Store Islamic Events
RedisCache --> Redis : Islamic Finance Cache
CBDCWallet --> CentralBank : Digital Currency
ShariaAPIs --> ShariaBoard : Compliance Validation

' Islamic Banking Business Rules
note top of MurabahaPort : Murabaha Islamic Financing\\n• No Interest (Riba) Calculation\\n• Asset-Backed Transactions\\n• Sharia Board Approval Required\\n• Profit-Sharing Mechanisms\\n• Islamic Risk Assessment
note top of CBDCPort : UAE Digital Dirham Integration\\n• Central Bank Digital Currency\\n• Real-time Settlement\\n• Cross-Border Payments\\n• Regulatory Compliance\\n• Multi-Bank Interoperability

note top of ShariaPort : Sharia Compliance Framework\\n• Real-time Validation\\n• Board Approval Workflow\\n• Islamic Finance Rules\\n• Haram Transaction Blocking\\n• Audit Trail Maintenance

note top of EventStorePort : Islamic Event Sourcing\\n• Sharia-Compliant Events\\n• Complete Audit Trail\\n• Religious Validation\\n• Compliance Reporting\\n• Temporal Queries

' CBDC and Islamic Finance Integration
note bottom of CentralBank : UAE CBDC Features\\n• Government-issued Digital Currency\\n• Real-time Cross-Border Payments\\n• Multi-Bank Integration\\n• Islamic Finance Compliance\\n• Regulatory Oversight

note bottom of ShariaBoard : Sharia Board Integration\\n• Real-time Compliance Validation\\n• Religious Authority Approval\\n• Fatwa Management\\n• Islamic Finance Certification\\n• Audit and Reporting

' Production Readiness for Islamic Banking
note right of K8sConfig : Kubernetes Islamic Banking\\n• Sharia-Compliant Microservices\\n• CBDC Integration Services\\n• Auto-scaling Islamic Workloads\\n• FAPI 2.0 Security Compliance\\n• Event-Driven Architecture\\n• Islamic Finance Monitoring

' Color Legend for Islamic Banking
note as IslamicLegend
  <b>AmanahFi Islamic Banking Platform Colors:</b>
  <color:#228B22>■</color> Islamic Finance Components
  <color:#FFD700>■</color> CBDC (Central Bank Digital Currency)
  <color:#DC143C>■</color> Security & Authentication
  <color:#BD10E0>■</color> Domain Layer (Core Banking)
  <color:#4A90E2>■</color> Ports (Clean Architecture)
  <color:#7ED321>■</color> Application Layer (Use Cases)
  <color:#F5A623>■</color> Infrastructure Layer
  <color:#9B59B6>■</color> Event-Driven Components
  <color:#DC382D>■</color> Cache Layer
end note

@enduml