@startuml Hexagonal Architecture - Enterprise Loan Management System (Production)

!define PRIMARY_COLOR #4A90E2
!define SECONDARY_COLOR #7ED321
!define INFRASTRUCTURE_COLOR #F5A623
!define DOMAIN_COLOR #BD10E0
!define AWS_COLOR #FF9900
!define CACHE_COLOR #DC382D

skinparam backgroundColor #FFFFFF
skinparam componentStyle rectangle

title Enterprise Loan Management System - Hexagonal Architecture (AWS EKS Production)

package "Infrastructure Layer (AWS EKS)" <<Frame>> {
    
    package "Input Adapters" {
        component [REST API Controllers\n(Banking Operations)] as RestAPI INFRASTRUCTURE_COLOR
        component [Spring Boot Actuator\n(Health & Metrics)] as Actuator INFRASTRUCTURE_COLOR
        component [Event Listeners\n(Kafka MSK)] as EventListeners INFRASTRUCTURE_COLOR
        component [Scheduled Jobs\n(Batch Processing)] as ScheduledJobs INFRASTRUCTURE_COLOR
        component [Security Layer\n(FAPI Compliance 71.4%)] as SecurityLayer INFRASTRUCTURE_COLOR
    }
    
    package "Output Adapters" {
        component [PostgreSQL Repositories\n(RDS Multi-AZ)] as JpaRepositories INFRASTRUCTURE_COLOR
        component [Redis ElastiCache\n(100% Hit Ratio, 2.5ms)] as RedisCache CACHE_COLOR
        component [Event Publishers\n(Kafka MSK)] as EventPublishers INFRASTRUCTURE_COLOR
        component [External APIs\n(Credit Bureau, Payment Gateway)] as ExternalAPIs INFRASTRUCTURE_COLOR
        component [Monitoring Adapters\n(Prometheus, CloudWatch)] as MonitoringAdapters INFRASTRUCTURE_COLOR
    }
    
    package "Configuration & Security" {
        component [Spring Configuration\n(Java 21, Virtual Threads)] as SpringConfig INFRASTRUCTURE_COLOR
        component [Security Configuration\n(JWT, OAuth2)] as SecurityConfig INFRASTRUCTURE_COLOR
        component [Cache Configuration\n(Multi-Level Strategy)] as CacheConfig CACHE_COLOR
        component [AWS Integration\n(IAM, Secrets Manager)] as AWSIntegration AWS_COLOR
    }
}

package "Application Layer (Business Orchestration)" <<Frame>> {
    component [Customer Application Services\n(Profile Management)] as CustomerAppServices SECONDARY_COLOR
    component [Loan Application Services\n(Origination Workflow)] as LoanAppServices SECONDARY_COLOR
    component [Payment Application Services\n(Transaction Processing)] as PaymentAppServices SECONDARY_COLOR
    component [SAGA Orchestrators\n(Distributed Transactions)] as SagaOrchestrators SECONDARY_COLOR
    component [Use Case Implementations\n(Banking Workflows)] as UseCases SECONDARY_COLOR
    component [Event Handlers\n(Domain Events)] as EventHandlers SECONDARY_COLOR
    component [Cache Management\n(Invalidation & Warming)] as CacheManagement CACHE_COLOR
}

package "Domain Layer (Core Banking Logic)" <<Frame>> {
    
    package "Domain Aggregates" {
        component [Customer Aggregate\n(Profile, Credit Score)] as CustomerAggregate DOMAIN_COLOR
        component [Loan Aggregate\n(Application, Terms)] as LoanAggregate DOMAIN_COLOR
        component [Payment Aggregate\n(Installments, History)] as PaymentAggregate DOMAIN_COLOR
        component [Compliance Aggregate\n(Audit, Regulations)] as ComplianceAggregate DOMAIN_COLOR
    }
    
    package "Domain Entities & Value Objects" {
        component [Loan Installment Entity\n(Payment Schedule)] as LoanInstallment DOMAIN_COLOR
        component [Money Value Object\n(Currency, Amount)] as MoneyVO DOMAIN_COLOR
        component [Interest Rate VO\n(0.1% - 0.5% Range)] as InterestRateVO DOMAIN_COLOR
        component [Credit Score VO\n(Risk Assessment)] as CreditScoreVO DOMAIN_COLOR
        component [Domain Events\n(Banking Events)] as DomainEvents DOMAIN_COLOR
    }
    
    package "Domain Services" {
        component [Credit Assessment Service\n(Risk Evaluation)] as CreditAssessmentService DOMAIN_COLOR
        component [Loan Calculation Service\n(Interest & Installments)] as LoanCalculationService DOMAIN_COLOR
        component [Payment Calculation Service\n(Penalty & Schedule)] as PaymentCalculationService DOMAIN_COLOR
        component [Compliance Validation Service\n(Regulatory Rules)] as ComplianceService DOMAIN_COLOR
    }
    
    package "Ports (Interfaces)" {
        component [Customer Port\n(Use Cases)] as CustomerPort PRIMARY_COLOR
        component [Loan Port\n(Use Cases)] as LoanPort PRIMARY_COLOR
        component [Payment Port\n(Use Cases)] as PaymentPort PRIMARY_COLOR
        component [Repository Ports\n(Data Access)] as RepositoryPorts PRIMARY_COLOR
        component [Cache Ports\n(Caching Strategy)] as CachePorts PRIMARY_COLOR
    }
}

' External Systems (AWS Managed Services)
cloud "AWS Managed Services" {
    database "Amazon RDS PostgreSQL\n(Multi-AZ, Automated Backups)" as Database AWS_COLOR
    queue "Amazon MSK\n(Managed Kafka)" as Kafka AWS_COLOR
    storage "ElastiCache Redis Cluster\n(6.1GB, Multi-AZ)" as Redis CACHE_COLOR
    component "CloudWatch\n(Monitoring & Alerting)" as CloudWatch AWS_COLOR
    component "Secrets Manager\n(API Keys & Credentials)" as SecretsManager AWS_COLOR
}

' Connections - Input Flow (API Gateway → Application)
RestAPI --> CustomerAppServices : Customer Operations
RestAPI --> LoanAppServices : Loan Processing
RestAPI --> PaymentAppServices : Payment Operations
Actuator --> MonitoringAdapters : Health & Metrics
EventListeners --> EventHandlers : Kafka MSK Messages
ScheduledJobs --> SagaOrchestrators : Batch Processing
SecurityLayer --> RestAPI : Authentication/Authorization

' Application Layer Coordination
CustomerAppServices --> CustomerPort : Use Cases
LoanAppServices --> LoanPort : Use Cases
PaymentAppServices --> PaymentPort : Use Cases
UseCases --> CustomerPort : implements
UseCases --> LoanPort : implements
UseCases --> PaymentPort : implements
SagaOrchestrators --> CustomerPort : coordinates
SagaOrchestrators --> LoanPort : coordinates
SagaOrchestrators --> PaymentPort : coordinates
EventHandlers --> CustomerPort : event triggers
EventHandlers --> LoanPort : event triggers
EventHandlers --> PaymentPort : event triggers

' Domain Layer Internal Relationships
CustomerPort --> CustomerAggregate : orchestrates
LoanPort --> LoanAggregate : orchestrates
PaymentPort --> PaymentAggregate : orchestrates
CustomerPort --> CreditAssessmentService : uses
LoanPort --> LoanCalculationService : uses
PaymentPort --> PaymentCalculationService : uses
ComplianceService --> ComplianceAggregate : validates

' Domain Aggregates & Value Objects
CustomerAggregate --> CreditScoreVO : contains
CustomerAggregate --> MoneyVO : contains
LoanAggregate --> InterestRateVO : contains
LoanAggregate --> LoanInstallment : contains
LoanAggregate --> MoneyVO : contains
PaymentAggregate --> LoanInstallment : contains
PaymentAggregate --> MoneyVO : contains
CustomerAggregate --> DomainEvents : raises
LoanAggregate --> DomainEvents : raises
PaymentAggregate --> DomainEvents : raises

' Domain Services Operations
CreditAssessmentService --> CustomerAggregate : evaluates
LoanCalculationService --> LoanAggregate : calculates
PaymentCalculationService --> PaymentAggregate : processes

' Cache Management Integration
CacheManagement --> CachePorts : cache operations
CachePorts --> RedisCache : implements
CacheConfig --> CacheManagement : configuration

' Infrastructure Implementation (Outbound)
RepositoryPorts <-- CustomerAppServices : data access
RepositoryPorts <-- LoanAppServices : data access
RepositoryPorts <-- PaymentAppServices : data access
JpaRepositories --> RepositoryPorts : implements
RedisCache --> CachePorts : implements
EventPublishers --> RepositoryPorts : implements
ExternalAPIs --> RepositoryPorts : implements

' AWS Integration
AWSIntegration --> JpaRepositories : RDS connection
AWSIntegration --> RedisCache : ElastiCache connection
AWSIntegration --> EventPublishers : MSK connection
AWSIntegration --> SecretsManager : credentials
SecurityConfig --> AWSIntegration : IAM integration

' External Systems Integration
JpaRepositories --> Database : SQL operations
RedisCache --> Redis : cache operations
EventPublishers --> Kafka : message publishing
EventListeners <-- Kafka : message consumption
MonitoringAdapters --> CloudWatch : metrics & logs
ExternalAPIs --> SecretsManager : API credentials

' Banking Business Rules
note top of CustomerPort : Customer Management\n• Credit Score Validation (300-850)\n• Profile Management\n• Risk Assessment\n• KYC Compliance

note top of LoanPort : Loan Origination\n• Interest Rates: 0.1% - 0.5% monthly\n• Installments: 6, 9, 12, 24 months\n• Loan Amount: $1,000 - $500,000\n• Business Rule Validation

note top of PaymentPort : Payment Processing\n• Installment Calculations\n• Payment Validation\n• Transaction Processing\n• Penalty Calculations

note top of ComplianceAggregate : Banking Compliance\n• FAPI Security: 71.4%\n• TDD Coverage: 87.4%\n• Regulatory Standards\n• Audit Trail Management

' Architecture Principles
note bottom of CustomerAggregate : Hexagonal Architecture Benefits\n• Domain Independence\n• Technology Agnostic Core\n• Testable Business Logic\n• Flexible Infrastructure\n• Clean Separation of Concerns

note bottom of Redis : Cache Performance\n• 100% Hit Ratio Achieved\n• 2.5ms Response Time\n• 6.1GB Memory Pool\n• Multi-AZ High Availability\n• L1 + L2 Caching Strategy

note bottom of Database : Database Performance\n• PostgreSQL 16.9\n• Multi-AZ Deployment\n• Automated Backups\n• Read Replicas\n• Connection Pooling

' Production Readiness
note right of AWSIntegration : AWS EKS Production\n• Kubernetes Orchestration\n• Auto-scaling (HPA + CA)\n• Load Balancing (ALB)\n• Security (IAM + RBAC)\n• Monitoring (CloudWatch)\n• GitOps (ArgoCD)

' Color Legend
note as Legend
  <b>Production Architecture Colors:</b>
  <color:#BD10E0>■</color> Domain Layer (Banking Business Logic)
  <color:#4A90E2>■</color> Ports (Clean Architecture Interfaces)
  <color:#7ED321>■</color> Application Layer (Use Case Orchestration)
  <color:#F5A623>■</color> Infrastructure Layer (AWS Integration)
  <color:#FF9900>■</color> AWS Managed Services
  <color:#DC382D>■</color> Cache Layer (Redis ElastiCache)
end note

@enduml
