<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="4976px" preserveAspectRatio="none" style="width:2368px;height:4976px;background:#F8F9FA;" version="1.1" viewBox="0 0 2368 4976" width="2368px" zoomAndPan="magnify"><title>Enhanced Enterprise Banking System - OAuth 2.1 Authorization Code Flow with PKCE</title><defs/><g><rect fill="#F8F9FA" height="4976" style="stroke:none;stroke-width:1;" width="2368" x="0" y="0"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="617.9551" x="871.0476" y="28.5352">Enhanced Enterprise Banking System - OAuth 2.1 Authorization Code Flow with PKCE</text><g><title>Istio Ingress</title><rect fill="#FFFFFF" height="116.2422" style="stroke:#181818;stroke-width:1;" width="10" x="586.9087" y="261.6387"/></g><g><title>Istio Ingress</title><rect fill="#FFFFFF" height="196.416" style="stroke:#181818;stroke-width:1;" width="10" x="586.9087" y="450.502"/></g><g><title>Istio Ingress</title><rect fill="#FFFFFF" height="546.7637" style="stroke:#181818;stroke-width:1;" width="10" x="586.9087" y="1214.3711"/></g><g><title>Istio Ingress</title><rect fill="#FFFFFF" height="623.0059" style="stroke:#181818;stroke-width:1;" width="10" x="586.9087" y="1849.0664"/></g><g><title>Istio Ingress</title><rect fill="#FFFFFF" height="474.5215" style="stroke:#181818;stroke-width:1;" width="10" x="586.9087" y="2595.3145"/></g><g><title>Istio Ingress</title><rect fill="#FFFFFF" height="206.7949" style="stroke:#181818;stroke-width:1;" width="10" x="586.9087" y="3363.5625"/></g><g><title>Istio Ingress</title><rect fill="#FFFFFF" height="311.3477" style="stroke:#181818;stroke-width:1;" width="10" x="586.9087" y="3650.2891"/></g><g><title>Istio Ingress</title><rect fill="#FFFFFF" height="206.7949" style="stroke:#181818;stroke-width:1;" width="10" x="586.9087" y="4041.5684"/></g><g><title>Istio Ingress</title><rect fill="#FFFFFF" height="163.4844" style="stroke:#181818;stroke-width:1;" width="10" x="586.9087" y="4328.2949"/></g><g><title>Istio Ingress</title><rect fill="#FFFFFF" height="192.7949" style="stroke:#181818;stroke-width:1;" width="10" x="586.9087" y="4571.7109"/></g><g><title>OAuth2 Proxy</title><rect fill="#FFFFFF" height="86.9316" style="stroke:#181818;stroke-width:1;" width="10" x="921.4829" y="290.9492"/></g><g><title>OAuth2 Proxy</title><rect fill="#FFFFFF" height="167.1055" style="stroke:#181818;stroke-width:1;" width="10" x="921.4829" y="479.8125"/></g><g><title>OAuth2 Proxy</title><rect fill="#FFFFFF" height="517.4531" style="stroke:#181818;stroke-width:1;" width="10" x="921.4829" y="1243.6816"/></g><g><title>OAuth2 Proxy</title><rect fill="#FFFFFF" height="132.8633" style="stroke:#181818;stroke-width:1;" width="10" x="921.4829" y="1878.377"/></g><g><title>OAuth2 Proxy</title><rect fill="#FFFFFF" height="298.6582" style="stroke:#181818;stroke-width:1;" width="10" x="921.4829" y="2624.625"/></g><g><title>OAuth2 Proxy</title><rect fill="#FFFFFF" height="163.4844" style="stroke:#181818;stroke-width:1;" width="10" x="921.4829" y="4601.0215"/></g><g><title>Keycloak</title><rect fill="#FFFFFF" height="391.5898" style="stroke:#181818;stroke-width:1;" width="10" x="1309.0938" y="734.8496"/></g><g><title>Keycloak</title><rect fill="#FFFFFF" height="251.7266" style="stroke:#181818;stroke-width:1;" width="10" x="1309.0938" y="1391.8555"/></g><g><title>Keycloak</title><rect fill="#FFFFFF" height="121.1738" style="stroke:#181818;stroke-width:1;" width="10" x="1309.0938" y="2699.8672"/></g><g><title>Banking</title><rect fill="#FFFFFF" height="178.7949" style="stroke:#181818;stroke-width:1;" width="10" x="1652.6118" y="2204.0352"/></g><g><title>Banking</title><rect fill="#FFFFFF" height="29.3105" style="stroke:#181818;stroke-width:1;" width="10" x="1652.6118" y="2981.9043"/></g><g><title>Banking</title><rect fill="#FFFFFF" height="163.4844" style="stroke:#181818;stroke-width:1;" width="10" x="1652.6118" y="3708.9102"/></g><g><title>Envoy</title><rect fill="#FFFFFF" height="371.5898" style="stroke:#181818;stroke-width:1;" width="10" x="2084.7368" y="2055.8613"/></g><g><title>Envoy</title><rect fill="#FFFFFF" height="87.9316" style="stroke:#181818;stroke-width:1;" width="10" x="2084.7368" y="2952.5938"/></g><g><title>Envoy</title><rect fill="#FFFFFF" height="148.1738" style="stroke:#181818;stroke-width:1;" width="10" x="2084.7368" y="3392.873"/></g><g><title>Envoy</title><rect fill="#FFFFFF" height="237.416" style="stroke:#181818;stroke-width:1;" width="10" x="2084.7368" y="3679.5996"/></g><g><title>Envoy</title><rect fill="#FFFFFF" height="148.1738" style="stroke:#181818;stroke-width:1;" width="10" x="2084.7368" y="4070.8789"/></g><g><title>Banking Client</title><rect fill="#000000" fill-opacity="0.00000" height="4834.5254" width="8" x="138.0273" y="90.4648"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="142" x2="142" y1="90.4648" y2="4924.9902"/></g><g><title>Istio Ingress</title><rect fill="#000000" fill-opacity="0.00000" height="4834.5254" width="8" x="587.9087" y="90.4648"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="591.541" x2="591.541" y1="90.4648" y2="4924.9902"/></g><g><title>OAuth2 Proxy</title><rect fill="#000000" fill-opacity="0.00000" height="4834.5254" width="8" x="922.4829" y="90.4648"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="926.2842" x2="926.2842" y1="90.4648" y2="4924.9902"/></g><g><title>Keycloak</title><rect fill="#000000" fill-opacity="0.00000" height="4834.5254" width="8" x="1310.0938" y="90.4648"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1313.1011" x2="1313.1011" y1="90.4648" y2="4924.9902"/></g><g><title>Banking</title><rect fill="#000000" fill-opacity="0.00000" height="4834.5254" width="8" x="1653.6118" y="90.4648"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1657.3452" x2="1657.3452" y1="90.4648" y2="4924.9902"/></g><g><title>Envoy</title><rect fill="#000000" fill-opacity="0.00000" height="4834.5254" width="8" x="2085.7368" y="90.4648"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="2089.3223" x2="2089.3223" y1="90.4648" y2="4924.9902"/></g><g class="participant participant-head" data-participant="Client"><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="112.0547" x="86" y="42.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="98.0547" x="93" y="63.0234">Banking Client</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90.3984" x="96.8281" y="79.5117">(Web/Mobile)</text></g><g class="participant participant-tail" data-participant="Client"><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="112.0547" x="86" y="4923.9902"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="98.0547" x="93" y="4944.5254">Banking Client</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90.3984" x="96.8281" y="4961.0137">(Web/Mobile)</text></g><g class="participant participant-head" data-participant="Gateway"><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="96.7354" x="543.541" y="42.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82.7354" x="550.541" y="63.0234">Istio Ingress</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56.7178" x="563.5498" y="79.5117">Gateway</text></g><g class="participant participant-tail" data-participant="Gateway"><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="96.7354" x="543.541" y="4923.9902"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82.7354" x="550.541" y="4944.5254">Istio Ingress</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56.7178" x="563.5498" y="4961.0137">Gateway</text></g><g class="participant participant-head" data-participant="Proxy"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="108.3975" x="872.2842" y="58.9766"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94.3975" x="879.2842" y="79.5117">OAuth2 Proxy</text></g><g class="participant participant-tail" data-participant="Proxy"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="108.3975" x="872.2842" y="4923.9902"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94.3975" x="879.2842" y="4944.5254">OAuth2 Proxy</text></g><g class="participant participant-head" data-participant="Keycloak"><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="129.9854" x="1249.1011" y="42.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59.9854" x="1284.1011" y="63.0234">Keycloak</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="115.9854" x="1256.1011" y="79.5117">OAuth 2.1 Server</text></g><g class="participant participant-tail" data-participant="Keycloak"><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="129.9854" x="1249.1011" y="4923.9902"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59.9854" x="1284.1011" y="4944.5254">Keycloak</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="115.9854" x="1256.1011" y="4961.0137">OAuth 2.1 Server</text></g><g class="participant participant-head" data-participant="Service"><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="98.5332" x="1608.3452" y="42.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="54.1201" x="1630.5518" y="63.0234">Banking</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84.5332" x="1615.3452" y="79.5117">Microservice</text></g><g class="participant participant-tail" data-participant="Service"><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="98.5332" x="1608.3452" y="4923.9902"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="54.1201" x="1630.5518" y="4944.5254">Banking</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84.5332" x="1615.3452" y="4961.0137">Microservice</text></g><g class="participant participant-head" data-participant="Envoy"><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="62.8291" x="2058.3223" y="42.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39.4365" x="2070.0186" y="63.0234">Envoy</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="48.8291" x="2065.3223" y="79.5117">Sidecar</text></g><g class="participant participant-tail" data-participant="Envoy"><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="62.8291" x="2058.3223" y="4923.9902"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39.4365" x="2070.0186" y="4944.5254">Envoy</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="48.8291" x="2065.3223" y="4961.0137">Sidecar</text></g><g><title>Istio Ingress</title><rect fill="#FFFFFF" height="116.2422" style="stroke:#181818;stroke-width:1;" width="10" x="586.9087" y="261.6387"/></g><g><title>Istio Ingress</title><rect fill="#FFFFFF" height="196.416" style="stroke:#181818;stroke-width:1;" width="10" x="586.9087" y="450.502"/></g><g><title>Istio Ingress</title><rect fill="#FFFFFF" height="546.7637" style="stroke:#181818;stroke-width:1;" width="10" x="586.9087" y="1214.3711"/></g><g><title>Istio Ingress</title><rect fill="#FFFFFF" height="623.0059" style="stroke:#181818;stroke-width:1;" width="10" x="586.9087" y="1849.0664"/></g><g><title>Istio Ingress</title><rect fill="#FFFFFF" height="474.5215" style="stroke:#181818;stroke-width:1;" width="10" x="586.9087" y="2595.3145"/></g><g><title>Istio Ingress</title><rect fill="#FFFFFF" height="206.7949" style="stroke:#181818;stroke-width:1;" width="10" x="586.9087" y="3363.5625"/></g><g><title>Istio Ingress</title><rect fill="#FFFFFF" height="311.3477" style="stroke:#181818;stroke-width:1;" width="10" x="586.9087" y="3650.2891"/></g><g><title>Istio Ingress</title><rect fill="#FFFFFF" height="206.7949" style="stroke:#181818;stroke-width:1;" width="10" x="586.9087" y="4041.5684"/></g><g><title>Istio Ingress</title><rect fill="#FFFFFF" height="163.4844" style="stroke:#181818;stroke-width:1;" width="10" x="586.9087" y="4328.2949"/></g><g><title>Istio Ingress</title><rect fill="#FFFFFF" height="192.7949" style="stroke:#181818;stroke-width:1;" width="10" x="586.9087" y="4571.7109"/></g><g><title>OAuth2 Proxy</title><rect fill="#FFFFFF" height="86.9316" style="stroke:#181818;stroke-width:1;" width="10" x="921.4829" y="290.9492"/></g><g><title>OAuth2 Proxy</title><rect fill="#FFFFFF" height="167.1055" style="stroke:#181818;stroke-width:1;" width="10" x="921.4829" y="479.8125"/></g><g><title>OAuth2 Proxy</title><rect fill="#FFFFFF" height="517.4531" style="stroke:#181818;stroke-width:1;" width="10" x="921.4829" y="1243.6816"/></g><g><title>OAuth2 Proxy</title><rect fill="#FFFFFF" height="132.8633" style="stroke:#181818;stroke-width:1;" width="10" x="921.4829" y="1878.377"/></g><g><title>OAuth2 Proxy</title><rect fill="#FFFFFF" height="298.6582" style="stroke:#181818;stroke-width:1;" width="10" x="921.4829" y="2624.625"/></g><g><title>OAuth2 Proxy</title><rect fill="#FFFFFF" height="163.4844" style="stroke:#181818;stroke-width:1;" width="10" x="921.4829" y="4601.0215"/></g><g><title>Keycloak</title><rect fill="#FFFFFF" height="391.5898" style="stroke:#181818;stroke-width:1;" width="10" x="1309.0938" y="734.8496"/></g><g><title>Keycloak</title><rect fill="#FFFFFF" height="251.7266" style="stroke:#181818;stroke-width:1;" width="10" x="1309.0938" y="1391.8555"/></g><g><title>Keycloak</title><rect fill="#FFFFFF" height="121.1738" style="stroke:#181818;stroke-width:1;" width="10" x="1309.0938" y="2699.8672"/></g><g><title>Banking</title><rect fill="#FFFFFF" height="178.7949" style="stroke:#181818;stroke-width:1;" width="10" x="1652.6118" y="2204.0352"/></g><g><title>Banking</title><rect fill="#FFFFFF" height="29.3105" style="stroke:#181818;stroke-width:1;" width="10" x="1652.6118" y="2981.9043"/></g><g><title>Banking</title><rect fill="#FFFFFF" height="163.4844" style="stroke:#181818;stroke-width:1;" width="10" x="1652.6118" y="3708.9102"/></g><g><title>Envoy</title><rect fill="#FFFFFF" height="371.5898" style="stroke:#181818;stroke-width:1;" width="10" x="2084.7368" y="2055.8613"/></g><g><title>Envoy</title><rect fill="#FFFFFF" height="87.9316" style="stroke:#181818;stroke-width:1;" width="10" x="2084.7368" y="2952.5938"/></g><g><title>Envoy</title><rect fill="#FFFFFF" height="148.1738" style="stroke:#181818;stroke-width:1;" width="10" x="2084.7368" y="3392.873"/></g><g><title>Envoy</title><rect fill="#FFFFFF" height="237.416" style="stroke:#181818;stroke-width:1;" width="10" x="2084.7368" y="3679.5996"/></g><g><title>Envoy</title><rect fill="#FFFFFF" height="148.1738" style="stroke:#181818;stroke-width:1;" width="10" x="2084.7368" y="4070.8789"/></g><path d="M5,105.4648 L5,176.4648 L280,176.4648 L280,115.4648 L270,105.4648 L5,105.4648" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M270,105.4648 L270,115.4648 L280,115.4648 L270,105.4648" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="76.0195" x="11" y="123.0332">PKCE Setup</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="243.1914" x="11" y="138.3438">code_verifier = random(43-128 chars)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="254.5664" x="11" y="153.6543">code_challenge = SHA256(code_verifier)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="211.561" x="11" y="168.9648">code_challenge_method = "S256"</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="2361.0503" x="0" y="202.3623"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="2361.0503" y1="202.3623" y2="202.3623"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="2361.0503" y1="205.3623" y2="205.3623"/><rect fill="#EEEEEE" height="23.3105" style="stroke:#000000;stroke-width:2;" width="165.2393" x="1097.9055" y="191.707"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="146.9546" x="1103.9055" y="208.2754">Initial Access Attempt</text><g class="message" data-participant-1="Client" data-participant-2="Gateway"><polygon fill="#181818" points="574.9087,257.6387,584.9087,261.6387,574.9087,265.6387,578.9087,261.6387" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="142.0273" x2="580.9087" y1="261.6387" y2="261.6387"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="151.874" x="149.0273" y="241.5859">1. GET /api/customers</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155.3843" x="149.0273" y="256.8965">No Authorization header</text></g><g class="message" data-participant-1="Gateway" data-participant-2="Proxy"><polygon fill="#181818" points="909.4829,286.9492,919.4829,290.9492,909.4829,294.9492,913.4829,290.9492" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="596.9087" x2="915.4829" y1="290.9492" y2="290.9492"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="159.3833" x="603.9087" y="286.207">2. Check Authentication</text></g><g class="message" data-participant-1="Proxy" data-participant-2="Proxy"><line style="stroke:#181818;stroke-width:1;" x1="931.4829" x2="973.4829" y1="320.2598" y2="320.2598"/><line style="stroke:#181818;stroke-width:1;" x1="973.4829" x2="973.4829" y1="320.2598" y2="333.2598"/><line style="stroke:#181818;stroke-width:1;" x1="932.4829" x2="973.4829" y1="333.2598" y2="333.2598"/><polygon fill="#181818" points="942.4829,329.2598,932.4829,333.2598,942.4829,337.2598,938.4829,333.2598" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="169.7617" x="938.4829" y="315.5176">3. No valid session found</text></g><g class="message" data-participant-1="Proxy" data-participant-2="Client"><polygon fill="#181818" points="153.0273,373.8809,143.0273,377.8809,153.0273,381.8809,149.0273,377.8809" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="147.0273" x2="925.4829" y1="377.8809" y2="377.8809"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="141.5654" x="159.0273" y="357.8281">4. HTTP 302 Redirect</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="276.123" x="159.0273" y="373.1387">Location: /oauth2/start?rd=/api/customers</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="2361.0503" x="0" y="406.5361"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="2361.0503" y1="406.5361" y2="406.5361"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="2361.0503" y1="409.5361" y2="409.5361"/><rect fill="#EEEEEE" height="23.3105" style="stroke:#000000;stroke-width:2;" width="240.1099" x="1060.4702" y="395.8809"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="221.8252" x="1066.4702" y="412.4492">OAuth 2.1 Authorization Request</text><g class="message" data-participant-1="Client" data-participant-2="Gateway"><polygon fill="#181818" points="574.9087,446.502,584.9087,450.502,574.9087,454.502,578.9087,450.502" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="142.0273" x2="580.9087" y1="450.502" y2="450.502"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="139.8325" x="149.0273" y="445.7598">5. GET /oauth2/start</text></g><g class="message" data-participant-1="Gateway" data-participant-2="Proxy"><polygon fill="#181818" points="909.4829,475.8125,919.4829,479.8125,909.4829,483.8125,913.4829,479.8125" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="596.9087" x2="915.4829" y1="479.8125" y2="479.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="127.9116" x="603.9087" y="475.0703">6. Start OAuth flow</text></g><g class="message" data-participant-1="Proxy" data-participant-2="Client"><polygon fill="#181818" points="153.0273,642.918,143.0273,646.918,153.0273,650.918,149.0273,646.918" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="147.0273" x2="925.4829" y1="646.918" y2="646.918"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="223.4502" x="159.0273" y="504.3809">7. HTTP 302 Redirect to Keycloak</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="621.3403" x="159.0273" y="519.6914">Location: https://keycloak.banking.local/realms/banking-system/protocol/openid-connect/auth?</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140.3403" x="167.2539" y="535.002">response_type=code&amp;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="236.9834" x="167.2539" y="550.3125">client_id=banking-system-frontend&amp;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="358.6108" x="167.2539" y="565.623">redirect_uri=https://api.banking.local/oauth2/callback&amp;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="322.1436" x="167.2539" y="580.9336">scope=openid profile banking:read banking:write&amp;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="175.792" x="167.2539" y="596.2441">state=random_state_value&amp;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="202.6743" x="167.2539" y="611.5547">code_challenge=SHA256_hash&amp;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="202.687" x="167.2539" y="626.8652">code_challenge_method=S256&amp;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="193.1274" x="167.2539" y="642.1758">x-fapi-financial-id=bank-001</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="2361.0503" x="0" y="675.5732"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="2361.0503" y1="675.5732" y2="675.5732"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="2361.0503" y1="678.5732" y2="678.5732"/><rect fill="#EEEEEE" height="23.3105" style="stroke:#000000;stroke-width:2;" width="232.7085" x="1064.1709" y="664.918"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="214.4238" x="1070.1709" y="681.4863">User Authentication at Keycloak</text><g class="message" data-participant-1="Client" data-participant-2="Keycloak"><polygon fill="#181818" points="1297.0938,730.8496,1307.0938,734.8496,1297.0938,738.8496,1301.0938,734.8496" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="142.0273" x2="1303.0938" y1="734.8496" y2="734.8496"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="166.3467" x="149.0273" y="714.7969">8. Authorization Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126.7246" x="149.0273" y="730.1074">with PKCE challenge</text></g><g class="message" data-participant-1="Keycloak" data-participant-2="Keycloak"><line style="stroke:#181818;stroke-width:1;" x1="1319.0938" x2="1361.0938" y1="783.626" y2="783.626"/><line style="stroke:#181818;stroke-width:1;" x1="1361.0938" x2="1361.0938" y1="783.626" y2="796.626"/><line style="stroke:#181818;stroke-width:1;" x1="1320.0938" x2="1361.0938" y1="796.626" y2="796.626"/><polygon fill="#181818" points="1330.0938,792.626,1320.0938,796.626,1330.0938,800.626,1326.0938,796.626" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="146.4023" x="1326.0938" y="778.8838">9. Present Login Form</text></g><path d="M1494.4023,747.8496 L1494.4023,818.8496 L1725.4023,818.8496 L1725.4023,757.8496 L1715.4023,747.8496 L1494.4023,747.8496" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1715.4023,747.8496 L1715.4023,757.8496 L1725.4023,757.8496 L1715.4023,747.8496" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="129.689" x="1500.4023" y="765.418">FAPI Requirements:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="210.4883" x="1500.4023" y="780.7285">&#8226; Strong customer authentication</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="182.0825" x="1500.4023" y="796.0391">&#8226; Multi-factor authentication</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177.271" x="1500.4023" y="811.3496">&#8226; Risk-based authentication</text><g class="message" data-participant-1="Client" data-participant-2="Keycloak"><polygon fill="#181818" points="1297.0938,856.7129,1307.0938,860.7129,1297.0938,864.7129,1301.0938,860.7129" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="142.0273" x2="1303.0938" y1="860.7129" y2="860.7129"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="183.4028" x="149.0273" y="840.6602">10. User Credentials + MFA</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="195.9775" x="149.0273" y="855.9707">username, password, OTP/SMS</text></g><g class="message" data-participant-1="Keycloak" data-participant-2="Keycloak"><line style="stroke:#181818;stroke-width:1;" x1="1319.0938" x2="1361.0938" y1="905.334" y2="905.334"/><line style="stroke:#181818;stroke-width:1;" x1="1361.0938" x2="1361.0938" y1="905.334" y2="918.334"/><line style="stroke:#181818;stroke-width:1;" x1="1320.0938" x2="1361.0938" y1="918.334" y2="918.334"/><polygon fill="#181818" points="1330.0938,914.334,1320.0938,918.334,1330.0938,922.334,1326.0938,918.334" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="144.3965" x="1326.0938" y="885.2813">11. Authenticate User</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="182.4634" x="1326.0938" y="900.5918">Validate credentials and MFA</text></g><g class="message" data-participant-1="Keycloak" data-participant-2="Keycloak"><line style="stroke:#181818;stroke-width:1;" x1="1319.0938" x2="1361.0938" y1="1008.8867" y2="1008.8867"/><line style="stroke:#181818;stroke-width:1;" x1="1361.0938" x2="1361.0938" y1="1008.8867" y2="1021.8867"/><line style="stroke:#181818;stroke-width:1;" x1="1320.0938" x2="1361.0938" y1="1021.8867" y2="1021.8867"/><polygon fill="#181818" points="1330.0938,1017.8867,1320.0938,1021.8867,1330.0938,1025.8867,1326.0938,1021.8867" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="114.2578" x="1326.0938" y="942.9023">12. User Consent</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="239.3892" x="1326.0938" y="958.2129">note right : Display requested scopes:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149.2588" x="1326.0938" y="973.5234">&#8226; Customer data access</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140.6831" x="1326.0938" y="988.834">&#8226; Account information</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="132.8501" x="1326.0938" y="1004.1445">&#8226; Transaction history</text></g><g class="message" data-participant-1="Client" data-participant-2="Keycloak"><polygon fill="#181818" points="1297.0938,1047.1973,1307.0938,1051.1973,1297.0938,1055.1973,1301.0938,1051.1973" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="142.0273" x2="1303.0938" y1="1051.1973" y2="1051.1973"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="120.8594" x="149.0273" y="1046.4551">13. Grant Consent</text></g><g class="message" data-participant-1="Keycloak" data-participant-2="Client"><polygon fill="#181818" points="153.0273,1122.4395,143.0273,1126.4395,153.0273,1130.4395,149.0273,1126.4395" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="147.0273" x2="1313.0938" y1="1126.4395" y2="1126.4395"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="221.7554" x="159.0273" y="1075.7656">14. HTTP 302 Redirect with Code</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="334.1216" x="159.0273" y="1091.0762">Location: https://api.banking.local/oauth2/callback?</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170.5806" x="167.2539" y="1106.3867">code=authorization_code&amp;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="166.7275" x="167.2539" y="1121.6973">state=random_state_value</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="2361.0503" x="0" y="1155.0947"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="2361.0503" y1="1155.0947" y2="1155.0947"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="2361.0503" y1="1158.0947" y2="1158.0947"/><rect fill="#EEEEEE" height="23.3105" style="stroke:#000000;stroke-width:2;" width="127.5405" x="1116.7549" y="1144.4395"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="109.2559" x="1122.7549" y="1161.0078">Token Exchange</text><g class="message" data-participant-1="Client" data-participant-2="Gateway"><polygon fill="#181818" points="574.9087,1210.3711,584.9087,1214.3711,574.9087,1218.3711,578.9087,1214.3711" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="142.0273" x2="580.9087" y1="1214.3711" y2="1214.3711"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="171.3867" x="149.0273" y="1194.3184">15. GET /oauth2/callback</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149.5444" x="149.0273" y="1209.6289">with authorization code</text></g><g class="message" data-participant-1="Gateway" data-participant-2="Proxy"><polygon fill="#181818" points="909.4829,1239.6816,919.4829,1243.6816,909.4829,1247.6816,913.4829,1243.6816" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="596.9087" x2="915.4829" y1="1243.6816" y2="1243.6816"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="130.1333" x="603.9087" y="1238.9395">16. Handle callback</text></g><g class="message" data-participant-1="Proxy" data-participant-2="Proxy"><line style="stroke:#181818;stroke-width:1;" x1="931.4829" x2="973.4829" y1="1272.9922" y2="1272.9922"/><line style="stroke:#181818;stroke-width:1;" x1="973.4829" x2="973.4829" y1="1272.9922" y2="1285.9922"/><line style="stroke:#181818;stroke-width:1;" x1="932.4829" x2="973.4829" y1="1285.9922" y2="1285.9922"/><polygon fill="#181818" points="942.4829,1281.9922,932.4829,1285.9922,942.4829,1289.9922,938.4829,1285.9922" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="189.5156" x="938.4829" y="1268.25">17. Validate state parameter</text></g><g class="message" data-participant-1="Proxy" data-participant-2="Keycloak"><polygon fill="#181818" points="1297.0938,1387.8555,1307.0938,1391.8555,1297.0938,1395.8555,1301.0938,1391.8555" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="931.4829" x2="1303.0938" y1="1391.8555" y2="1391.8555"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="109.3066" x="938.4829" y="1310.5605">18. POST /token</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="207.6255" x="938.4829" y="1325.8711">grant_type=authorization_code&amp;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170.5806" x="938.4829" y="1341.1816">code=authorization_code&amp;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="358.6108" x="938.4829" y="1356.4922">redirect_uri=https://api.banking.local/oauth2/callback&amp;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="236.9834" x="938.4829" y="1371.8027">client_id=banking-system-frontend&amp;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="226.1987" x="938.4829" y="1387.1133">code_verifier=original_code_verifier</text></g><g class="message" data-participant-1="Keycloak" data-participant-2="Keycloak"><line style="stroke:#181818;stroke-width:1;" x1="1319.0938" x2="1361.0938" y1="1436.4766" y2="1436.4766"/><line style="stroke:#181818;stroke-width:1;" x1="1361.0938" x2="1361.0938" y1="1436.4766" y2="1449.4766"/><line style="stroke:#181818;stroke-width:1;" x1="1320.0938" x2="1361.0938" y1="1449.4766" y2="1449.4766"/><polygon fill="#181818" points="1330.0938,1445.4766,1320.0938,1449.4766,1330.0938,1453.4766,1326.0938,1449.4766" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="117.5269" x="1326.0938" y="1416.4238">19. Validate PKCE</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="309.5181" x="1326.0938" y="1431.7344">Verify: SHA256(code_verifier) == code_challenge</text></g><g class="message" data-participant-1="Keycloak" data-participant-2="Keycloak"><line style="stroke:#181818;stroke-width:1;" x1="1319.0938" x2="1361.0938" y1="1478.7871" y2="1478.7871"/><line style="stroke:#181818;stroke-width:1;" x1="1361.0938" x2="1361.0938" y1="1478.7871" y2="1491.7871"/><line style="stroke:#181818;stroke-width:1;" x1="1320.0938" x2="1361.0938" y1="1491.7871" y2="1491.7871"/><polygon fill="#181818" points="1330.0938,1487.7871,1320.0938,1491.7871,1330.0938,1495.7871,1326.0938,1491.7871" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="213.3511" x="1326.0938" y="1474.0449">20. Validate Authorization Code</text></g><g class="message" data-participant-1="Keycloak" data-participant-2="Proxy"><polygon fill="#181818" points="942.4829,1639.582,932.4829,1643.582,942.4829,1647.582,938.4829,1643.582" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="936.4829" x2="1313.0938" y1="1643.582" y2="1643.582"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="134.9448" x="948.4829" y="1516.3555">21. Token Response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.2275" x="948.4829" y="1531.666">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="242.8613" x="956.7095" y="1546.9766">"access_token": "JWT_ACCESS_TOKEN",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140.8799" x="956.7095" y="1562.2871">"token_type": "Bearer",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111.3823" x="956.7095" y="1577.5977">"expires_in": 300,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="222.6313" x="956.7095" y="1592.9082">"refresh_token": "REFRESH_TOKEN",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="334.5088" x="956.7095" y="1608.2188">"scope": "openid profile banking:read banking:write",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="175.1699" x="956.7095" y="1623.5293">"id_token": "JWT_ID_TOKEN"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.2275" x="948.4829" y="1638.8398">}</text></g><g class="message" data-participant-1="Proxy" data-participant-2="Proxy"><line style="stroke:#181818;stroke-width:1;" x1="931.4829" x2="973.4829" y1="1688.2031" y2="1688.2031"/><line style="stroke:#181818;stroke-width:1;" x1="973.4829" x2="973.4829" y1="1688.2031" y2="1701.2031"/><line style="stroke:#181818;stroke-width:1;" x1="932.4829" x2="973.4829" y1="1701.2031" y2="1701.2031"/><polygon fill="#181818" points="942.4829,1697.2031,932.4829,1701.2031,942.4829,1705.2031,938.4829,1701.2031" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="123.062" x="938.4829" y="1668.1504">22. Create Session</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134.729" x="938.4829" y="1683.4609">Store tokens securely</text></g><g class="message" data-participant-1="Proxy" data-participant-2="Client"><polygon fill="#181818" points="153.0273,1757.1348,143.0273,1761.1348,153.0273,1765.1348,149.0273,1761.1348" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="147.0273" x2="925.4829" y1="1761.1348" y2="1761.1348"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="150.1411" x="159.0273" y="1725.7715">23. HTTP 302 Redirect</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="159.9355" x="159.0273" y="1741.082">Location: /api/customers</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173.0815" x="159.0273" y="1756.3926">Set-Cookie: session_cookie</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="2361.0503" x="0" y="1789.79"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="2361.0503" y1="1789.79" y2="1789.79"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="2361.0503" y1="1792.79" y2="1792.79"/><rect fill="#EEEEEE" height="23.3105" style="stroke:#000000;stroke-width:2;" width="196.311" x="1082.3696" y="1779.1348"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="178.0264" x="1088.3696" y="1795.7031">Authenticated API Request</text><g class="message" data-participant-1="Client" data-participant-2="Gateway"><polygon fill="#181818" points="574.9087,1845.0664,584.9087,1849.0664,574.9087,1853.0664,578.9087,1849.0664" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="142.0273" x2="580.9087" y1="1849.0664" y2="1849.0664"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="160.4497" x="149.0273" y="1829.0137">24. GET /api/customers</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="146.4531" x="149.0273" y="1844.3242">Cookie: session_cookie</text></g><g class="message" data-participant-1="Gateway" data-participant-2="Proxy"><polygon fill="#181818" points="909.4829,1874.377,919.4829,1878.377,909.4829,1882.377,913.4829,1878.377" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="596.9087" x2="915.4829" y1="1878.377" y2="1878.377"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="167.959" x="603.9087" y="1873.6348">25. Check Authentication</text></g><g class="message" data-participant-1="Proxy" data-participant-2="Proxy"><line style="stroke:#181818;stroke-width:1;" x1="931.4829" x2="973.4829" y1="1922.998" y2="1922.998"/><line style="stroke:#181818;stroke-width:1;" x1="973.4829" x2="973.4829" y1="1922.998" y2="1935.998"/><line style="stroke:#181818;stroke-width:1;" x1="932.4829" x2="973.4829" y1="1935.998" y2="1935.998"/><polygon fill="#181818" points="942.4829,1931.998,932.4829,1935.998,942.4829,1939.998,938.4829,1935.998" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="134.0688" x="938.4829" y="1902.9453">26. Validate Session</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="162.3159" x="938.4829" y="1918.2559">Retrieve stored JWT token</text></g><g class="message" data-participant-1="Proxy" data-participant-2="Gateway"><polygon fill="#181818" points="607.9087,2007.2402,597.9087,2011.2402,607.9087,2015.2402,603.9087,2011.2402" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="601.9087" x2="925.4829" y1="2011.2402" y2="2011.2402"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="199.5767" x="613.9087" y="1960.5664">27. Add Authorization Header</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="266.3032" x="613.9087" y="1975.877">Authorization: Bearer JWT_ACCESS_TOKEN</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="191.02" x="613.9087" y="1991.1875">x-fapi-financial-id: bank-001</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="260.2793" x="613.9087" y="2006.498">x-fapi-interaction-id: unique-request-id</text></g><g class="message" data-participant-1="Gateway" data-participant-2="Envoy"><polygon fill="#181818" points="2072.7368,2051.8613,2082.7368,2055.8613,2072.7368,2059.8613,2076.7368,2055.8613" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="596.9087" x2="2078.7368" y1="2055.8613" y2="2055.8613"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="137.9663" x="603.9087" y="2035.8086">28. Forward Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94.0723" x="603.9087" y="2051.1191">with JWT token</text></g><g class="message" data-participant-1="Envoy" data-participant-2="Envoy"><line style="stroke:#181818;stroke-width:1;" x1="2094.7368" x2="2136.7368" y1="2146.4141" y2="2146.4141"/><line style="stroke:#181818;stroke-width:1;" x1="2136.7368" x2="2136.7368" y1="2146.4141" y2="2159.4141"/><line style="stroke:#181818;stroke-width:1;" x1="2095.7368" x2="2136.7368" y1="2159.4141" y2="2159.4141"/><polygon fill="#181818" points="2105.7368,2155.4141,2095.7368,2159.4141,2105.7368,2163.4141,2101.7368,2159.4141" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="122.8652" x="2101.7368" y="2080.4297">29. JWT Validation</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="236.5327" x="2101.7368" y="2095.7402">&#8226; Verify signature with Keycloak JWKS</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118.4028" x="2101.7368" y="2111.0508">&#8226; Check expiration</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122.5732" x="2101.7368" y="2126.3613">&#8226; Validate audience</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="194.5811" x="2101.7368" y="2141.6719">&#8226; Extract claims (roles, scopes)</text></g><g class="message" data-participant-1="Envoy" data-participant-2="Service"><polygon fill="#181818" points="1673.6118,2200.0352,1663.6118,2204.0352,1673.6118,2208.0352,1669.6118,2204.0352" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1667.6118" x2="2083.7368" y1="2204.0352" y2="2204.0352"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="157.1743" x="1679.6118" y="2183.9824">30. Authorized Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171.0249" x="1679.6118" y="2199.293">with validated user context</text></g><g class="message" data-participant-1="Service" data-participant-2="Service"><line style="stroke:#181818;stroke-width:1;" x1="1662.6118" x2="1704.6118" y1="2279.2773" y2="2279.2773"/><line style="stroke:#181818;stroke-width:1;" x1="1704.6118" x2="1704.6118" y1="2279.2773" y2="2292.2773"/><line style="stroke:#181818;stroke-width:1;" x1="1663.6118" x2="1704.6118" y1="2292.2773" y2="2292.2773"/><polygon fill="#181818" points="1673.6118,2288.2773,1663.6118,2292.2773,1673.6118,2296.2773,1669.6118,2292.2773" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="123.6777" x="1669.6118" y="2228.6035">31. Business Logic</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161.7764" x="1669.6118" y="2243.9141">&#8226; Check user permissions</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141.7241" x="1669.6118" y="2259.2246">&#8226; Apply business rules</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148.7129" x="1669.6118" y="2274.5352">&#8226; Access customer data</text></g><g class="message" data-participant-1="Service" data-participant-2="Envoy"><polygon fill="#181818" points="2072.7368,2378.8301,2082.7368,2382.8301,2072.7368,2386.8301,2076.7368,2382.8301" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1657.6118" x2="2078.7368" y1="2382.8301" y2="2382.8301"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="124.1538" x="1664.6118" y="2316.8457">32. Response Data</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.2275" x="1664.6118" y="2332.1563">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="108.3735" x="1672.8384" y="2347.4668">"customers": [...],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="264.2085" x="1672.8384" y="2362.7773">"fapi-interaction-id": "unique-request-id"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.2275" x="1664.6118" y="2378.0879">}</text></g><g class="message" data-participant-1="Envoy" data-participant-2="Gateway"><polygon fill="#181818" points="607.9087,2423.4512,597.9087,2427.4512,607.9087,2431.4512,603.9087,2427.4512" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="601.9087" x2="2088.7368" y1="2427.4512" y2="2427.4512"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="181.7207" x="613.9087" y="2407.3984">33. Response with Headers</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="260.2793" x="613.9087" y="2422.709">x-fapi-interaction-id: unique-request-id</text></g><g class="message" data-participant-1="Gateway" data-participant-2="Client"><polygon fill="#181818" points="153.0273,2468.0723,143.0273,2472.0723,153.0273,2476.0723,149.0273,2472.0723" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="147.0273" x2="590.9087" y1="2472.0723" y2="2472.0723"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="125.3916" x="159.0273" y="2452.0195">34. Final Response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="253.2842" x="159.0273" y="2467.3301">Customer data with compliance headers</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="2361.0503" x="0" y="2500.7275"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="2361.0503" y1="2500.7275" y2="2500.7275"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="2361.0503" y1="2503.7275" y2="2503.7275"/><rect fill="#EEEEEE" height="23.3105" style="stroke:#000000;stroke-width:2;" width="309.0645" x="1025.9929" y="2490.0723"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="290.7798" x="1031.9929" y="2506.6406">Token Refresh (when access token expires)</text><path d="M7,2528.3828 L7,2553.3828 L276,2553.3828 L276,2538.3828 L266,2528.3828 L7,2528.3828" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M266,2528.3828 L266,2538.3828 L276,2538.3828 L266,2528.3828" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="248.6694" x="13" y="2545.9512">Access token expires after 5 minutes</text><g class="message" data-participant-1="Client" data-participant-2="Gateway"><polygon fill="#181818" points="574.9087,2591.3145,584.9087,2595.3145,574.9087,2599.3145,578.9087,2595.3145" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="142.0273" x2="580.9087" y1="2595.3145" y2="2595.3145"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="104.7617" x="149.0273" y="2575.2617">35. API Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118.5869" x="149.0273" y="2590.5723">with expired token</text></g><g class="message" data-participant-1="Gateway" data-participant-2="Proxy"><polygon fill="#181818" points="909.4829,2620.625,919.4829,2624.625,909.4829,2628.625,913.4829,2624.625" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="596.9087" x2="915.4829" y1="2624.625" y2="2624.625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="120.8657" x="603.9087" y="2619.8828">36. Token expired</text></g><g class="message" data-participant-1="Proxy" data-participant-2="Keycloak"><polygon fill="#181818" points="1297.0938,2695.8672,1307.0938,2699.8672,1297.0938,2703.8672,1301.0938,2699.8672" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="931.4829" x2="1303.0938" y1="2699.8672" y2="2699.8672"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="174.6177" x="938.4829" y="2649.1934">37. POST /token (Refresh)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173.3672" x="938.4829" y="2664.5039">grant_type=refresh_token&amp;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="210.2661" x="938.4829" y="2679.8145">refresh_token=REFRESH_TOKEN&amp;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="227.9189" x="938.4829" y="2695.125">client_id=banking-system-frontend</text></g><g class="message" data-participant-1="Keycloak" data-participant-2="Proxy"><polygon fill="#181818" points="942.4829,2817.041,932.4829,2821.041,942.4829,2825.041,938.4829,2821.041" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="936.4829" x2="1313.0938" y1="2821.041" y2="2821.041"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="168.0542" x="948.4829" y="2724.4355">38. New Token Response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.2275" x="948.4829" y="2739.7461">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="277.1323" x="956.7095" y="2755.0566">"access_token": "NEW_JWT_ACCESS_TOKEN",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140.8799" x="956.7095" y="2770.3672">"token_type": "Bearer",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111.3823" x="956.7095" y="2785.6777">"expires_in": 300,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="252.7891" x="956.7095" y="2800.9883">"refresh_token": "NEW_REFRESH_TOKEN"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.2275" x="948.4829" y="2816.2988">}</text></g><g class="message" data-participant-1="Proxy" data-participant-2="Proxy"><line style="stroke:#181818;stroke-width:1;" x1="931.4829" x2="973.4829" y1="2865.6621" y2="2865.6621"/><line style="stroke:#181818;stroke-width:1;" x1="973.4829" x2="973.4829" y1="2865.6621" y2="2878.6621"/><line style="stroke:#181818;stroke-width:1;" x1="932.4829" x2="973.4829" y1="2878.6621" y2="2878.6621"/><polygon fill="#181818" points="942.4829,2874.6621,932.4829,2878.6621,942.4829,2882.6621,938.4829,2878.6621" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="127.0737" x="938.4829" y="2845.6094">39. Update Session</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="108.3481" x="938.4829" y="2860.9199">Store new tokens</text></g><g class="message" data-participant-1="Proxy" data-participant-2="Gateway"><polygon fill="#181818" points="607.9087,2919.2832,597.9087,2923.2832,607.9087,2927.2832,603.9087,2923.2832" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="601.9087" x2="925.4829" y1="2923.2832" y2="2923.2832"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="172.5737" x="613.9087" y="2903.2305">40. Retry with New Token</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="300.5742" x="613.9087" y="2918.541">Authorization: Bearer NEW_JWT_ACCESS_TOKEN</text></g><g class="message" data-participant-1="Gateway" data-participant-2="Envoy"><polygon fill="#181818" points="2072.7368,2948.5938,2082.7368,2952.5938,2072.7368,2956.5938,2076.7368,2952.5938" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="596.9087" x2="2078.7368" y1="2952.5938" y2="2952.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="137.9663" x="603.9087" y="2947.8516">41. Forward Request</text></g><g class="message" data-participant-1="Envoy" data-participant-2="Service"><polygon fill="#181818" points="1673.6118,2977.9043,1663.6118,2981.9043,1673.6118,2985.9043,1669.6118,2981.9043" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1667.6118" x2="2083.7368" y1="2981.9043" y2="2981.9043"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="134.3291" x="1679.6118" y="2977.1621">42. Process Request</text></g><g class="message" data-participant-1="Service" data-participant-2="Envoy"><polygon fill="#181818" points="2072.7368,3007.2148,2082.7368,3011.2148,2072.7368,3015.2148,2076.7368,3011.2148" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1657.6118" x2="2078.7368" y1="3011.2148" y2="3011.2148"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="89.0068" x="1664.6118" y="3006.4727">43. Response</text></g><g class="message" data-participant-1="Envoy" data-participant-2="Gateway"><polygon fill="#181818" points="607.9087,3036.5254,597.9087,3040.5254,607.9087,3044.5254,603.9087,3040.5254" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="601.9087" x2="2088.7368" y1="3040.5254" y2="3040.5254"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="89.0068" x="613.9087" y="3035.7832">44. Response</text></g><g class="message" data-participant-1="Gateway" data-participant-2="Client"><polygon fill="#181818" points="153.0273,3065.8359,143.0273,3069.8359,153.0273,3073.8359,149.0273,3069.8359" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="147.0273" x2="590.9087" y1="3069.8359" y2="3069.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="163.5664" x="159.0273" y="3065.0938">45. Successful Response</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="2361.0503" x="0" y="3098.4912"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="2361.0503" y1="3098.4912" y2="3098.4912"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="2361.0503" y1="3101.4912" y2="3101.4912"/><rect fill="#EEEEEE" height="23.3105" style="stroke:#000000;stroke-width:2;" width="216.2681" x="1072.3911" y="3087.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="197.9834" x="1078.3911" y="3104.4043">Exception Handling Scenarios</text><path d="M91,3126.1465 L91,3151.1465 L1706,3151.1465 L1706,3136.1465 L1696,3126.1465 L91,3126.1465" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1696,3126.1465 L1696,3136.1465 L1706,3136.1465 L1696,3126.1465" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="247.3174" x="770.7805" y="3143.7148">Exception Case 1: Invalid Credentials</text><g class="message" data-participant-1="Client" data-participant-2="Keycloak"><polygon fill="#181818" points="1302.0938,3189.0781,1312.0938,3193.0781,1302.0938,3197.0781,1306.0938,3193.0781" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="142.0273" x2="1308.0938" y1="3193.0781" y2="3193.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="149.7095" x="149.0273" y="3173.0254">E1. Invalid Credentials</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172.4277" x="149.0273" y="3188.3359">wrong username/password</text></g><g class="message" data-participant-1="Keycloak" data-participant-2="Client"><polygon fill="#181818" points="153.0273,3279.6309,143.0273,3283.6309,153.0273,3287.6309,149.0273,3283.6309" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="147.0273" x2="1313.0938" y1="3283.6309" y2="3283.6309"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="184.6787" x="159.0273" y="3217.6465">E2. HTTP 401 Unauthorized</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.2275" x="159.0273" y="3232.957">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144.4155" x="167.2539" y="3248.2676">"error": "invalid_grant",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="250.4087" x="167.2539" y="3263.5781">"error_description": "Invalid credentials"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.2275" x="159.0273" y="3278.8887">}</text></g><path d="M91,3296.6309 L91,3321.6309 L1706,3321.6309 L1706,3306.6309 L1696,3296.6309 L91,3296.6309" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1696,3296.6309 L1696,3306.6309 L1706,3306.6309 L1696,3296.6309" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="283.5371" x="752.6707" y="3314.1992">Exception Case 2: Insufficient Permissions</text><g class="message" data-participant-1="Client" data-participant-2="Gateway"><polygon fill="#181818" points="574.9087,3359.5625,584.9087,3363.5625,574.9087,3367.5625,578.9087,3363.5625" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="142.0273" x2="580.9087" y1="3363.5625" y2="3363.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="103.9937" x="149.0273" y="3343.5098">E3. API Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197.5454" x="149.0273" y="3358.8203">with valid token but wrong role</text></g><g class="message" data-participant-1="Gateway" data-participant-2="Envoy"><polygon fill="#181818" points="2072.7368,3388.873,2082.7368,3392.873,2072.7368,3396.873,2076.7368,3392.873" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="596.9087" x2="2078.7368" y1="3392.873" y2="3392.873"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="137.1982" x="603.9087" y="3388.1309">E4. Forward Request</text></g><g class="message" data-participant-1="Envoy" data-participant-2="Envoy"><line style="stroke:#181818;stroke-width:1;" x1="2094.7368" x2="2136.7368" y1="3437.4941" y2="3437.4941"/><line style="stroke:#181818;stroke-width:1;" x1="2136.7368" x2="2136.7368" y1="3437.4941" y2="3450.4941"/><line style="stroke:#181818;stroke-width:1;" x1="2095.7368" x2="2136.7368" y1="3450.4941" y2="3450.4941"/><polygon fill="#181818" points="2105.7368,3446.4941,2095.7368,3450.4941,2105.7368,3454.4941,2101.7368,3450.4941" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="160.7417" x="2101.7368" y="3417.4414">E5. Authorization Check</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="237.3135" x="2101.7368" y="3432.752">JWT valid but insufficient permissions</text></g><g class="message" data-participant-1="Envoy" data-participant-2="Gateway"><polygon fill="#181818" points="607.9087,3537.0469,597.9087,3541.0469,607.9087,3545.0469,603.9087,3541.0469" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="601.9087" x2="2088.7368" y1="3541.0469" y2="3541.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="162.1318" x="613.9087" y="3475.0625">E6. HTTP 403 Forbidden</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.2275" x="613.9087" y="3490.373">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176.5728" x="622.1353" y="3505.6836">"error": "insufficient_scope",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="428.8032" x="622.1353" y="3520.9941">"error_description": "Insufficient permissions for banking operation"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.2275" x="613.9087" y="3536.3047">}</text></g><g class="message" data-participant-1="Gateway" data-participant-2="Client"><polygon fill="#181818" points="153.0273,3566.3574,143.0273,3570.3574,153.0273,3574.3574,149.0273,3570.3574" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="147.0273" x2="590.9087" y1="3570.3574" y2="3570.3574"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="120.8149" x="159.0273" y="3565.6152">E7. Access Denied</text></g><path d="M91,3583.3574 L91,3608.3574 L1706,3608.3574 L1706,3593.3574 L1696,3583.3574 L91,3583.3574" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1696,3583.3574 L1696,3593.3574 L1706,3593.3574 L1696,3583.3574" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="250.8657" x="769.0063" y="3600.9258">Exception Case 3: Service Unavailable</text><g class="message" data-participant-1="Client" data-participant-2="Gateway"><polygon fill="#181818" points="574.9087,3646.2891,584.9087,3650.2891,574.9087,3654.2891,578.9087,3650.2891" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="142.0273" x2="580.9087" y1="3650.2891" y2="3650.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="103.9937" x="149.0273" y="3630.2363">E8. API Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100.293" x="149.0273" y="3645.5469">with valid token</text></g><g class="message" data-participant-1="Gateway" data-participant-2="Envoy"><polygon fill="#181818" points="2072.7368,3675.5996,2082.7368,3679.5996,2072.7368,3683.5996,2076.7368,3679.5996" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="596.9087" x2="2078.7368" y1="3679.5996" y2="3679.5996"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="137.1982" x="603.9087" y="3674.8574">E9. Forward Request</text></g><g class="message" data-participant-1="Envoy" data-participant-2="Service"><polygon fill="#181818" points="1673.6118,3704.9102,1663.6118,3708.9102,1673.6118,3712.9102,1669.6118,3708.9102" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1667.6118" x2="2083.7368" y1="3708.9102" y2="3708.9102"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="138.144" x="1679.6118" y="3704.168">E10. Service Request</text></g><g class="message" data-participant-1="Service" data-participant-2="Service"><line style="stroke:#181818;stroke-width:1;" x1="1662.6118" x2="1704.6118" y1="3753.5313" y2="3753.5313"/><line style="stroke:#181818;stroke-width:1;" x1="1704.6118" x2="1704.6118" y1="3753.5313" y2="3766.5313"/><line style="stroke:#181818;stroke-width:1;" x1="1663.6118" x2="1704.6118" y1="3766.5313" y2="3766.5313"/><polygon fill="#181818" points="1673.6118,3762.5313,1663.6118,3766.5313,1673.6118,3770.5313,1669.6118,3766.5313" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="122.6304" x="1669.6118" y="3733.4785">E11. Internal Error</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="175.8745" x="1669.6118" y="3748.7891">Database connection failure</text></g><g class="message" data-participant-1="Service" data-participant-2="Envoy"><polygon fill="#181818" points="2072.7368,3868.3945,2082.7368,3872.3945,2072.7368,3876.3945,2076.7368,3872.3945" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1657.6118" x2="2078.7368" y1="3872.3945" y2="3872.3945"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="232.1846" x="1664.6118" y="3791.0996">E12. HTTP 503 Service Unavailable</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.2275" x="1664.6118" y="3806.4102">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="184.1265" x="1672.8384" y="3821.7207">"error": "service_unavailable",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="389.8984" x="1672.8384" y="3837.0313">"error_description": "Banking service temporarily unavailable",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99.7979" x="1672.8384" y="3852.3418">"retry_after": 30</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.2275" x="1664.6118" y="3867.6523">}</text></g><g class="message" data-participant-1="Envoy" data-participant-2="Gateway"><polygon fill="#181818" points="607.9087,3913.0156,597.9087,3917.0156,607.9087,3921.0156,603.9087,3917.0156" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="601.9087" x2="2088.7368" y1="3917.0156" y2="3917.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="132.2026" x="613.9087" y="3896.9629">E13. Circuit Breaker</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145.6533" x="613.9087" y="3912.2734">Activate circuit breaker</text></g><g class="message" data-participant-1="Gateway" data-participant-2="Client"><polygon fill="#181818" points="153.0273,3957.6367,143.0273,3961.6367,153.0273,3965.6367,149.0273,3961.6367" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="147.0273" x2="590.9087" y1="3961.6367" y2="3961.6367"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="161.8335" x="159.0273" y="3941.584">E14. Service Unavailable</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="139.1279" x="159.0273" y="3956.8945">with retry instructions</text></g><path d="M91,3974.6367 L91,3999.6367 L1706,3999.6367 L1706,3984.6367 L1696,3974.6367 L91,3974.6367" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1696,3974.6367 L1696,3984.6367 L1706,3984.6367 L1696,3974.6367" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="285.1113" x="751.8835" y="3992.2051">Exception Case 4: Token Validation Failure</text><g class="message" data-participant-1="Client" data-participant-2="Gateway"><polygon fill="#181818" points="574.9087,4037.5684,584.9087,4041.5684,574.9087,4045.5684,578.9087,4041.5684" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="142.0273" x2="580.9087" y1="4041.5684" y2="4041.5684"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="112.5693" x="149.0273" y="4021.5156">E15. API Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="166.9053" x="149.0273" y="4036.8262">with malformed JWT token</text></g><g class="message" data-participant-1="Gateway" data-participant-2="Envoy"><polygon fill="#181818" points="2072.7368,4066.8789,2082.7368,4070.8789,2072.7368,4074.8789,2076.7368,4070.8789" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="596.9087" x2="2078.7368" y1="4070.8789" y2="4070.8789"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="145.7739" x="603.9087" y="4066.1367">E16. Forward Request</text></g><g class="message" data-participant-1="Envoy" data-participant-2="Envoy"><line style="stroke:#181818;stroke-width:1;" x1="2094.7368" x2="2136.7368" y1="4115.5" y2="4115.5"/><line style="stroke:#181818;stroke-width:1;" x1="2136.7368" x2="2136.7368" y1="4115.5" y2="4128.5"/><line style="stroke:#181818;stroke-width:1;" x1="2095.7368" x2="2136.7368" y1="4128.5" y2="4128.5"/><polygon fill="#181818" points="2105.7368,4124.5,2095.7368,4128.5,2105.7368,4132.5,2101.7368,4128.5" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="130.6729" x="2101.7368" y="4095.4473">E17. JWT Validation</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="206.8828" x="2101.7368" y="4110.7578">Token signature verification fails</text></g><g class="message" data-participant-1="Envoy" data-participant-2="Gateway"><polygon fill="#181818" points="607.9087,4215.0527,597.9087,4219.0527,607.9087,4223.0527,603.9087,4219.0527" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="601.9087" x2="2088.7368" y1="4219.0527" y2="4219.0527"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="193.2544" x="613.9087" y="4153.0684">E18. HTTP 401 Unauthorized</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.2275" x="613.9087" y="4168.3789">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="146.6372" x="622.1353" y="4183.6895">"error": "invalid_token",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="335.9307" x="622.1353" y="4199">"error_description": "JWT signature verification failed"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.2275" x="613.9087" y="4214.3105">}</text></g><g class="message" data-participant-1="Gateway" data-participant-2="Client"><polygon fill="#181818" points="153.0273,4244.3633,143.0273,4248.3633,153.0273,4252.3633,149.0273,4248.3633" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="147.0273" x2="590.9087" y1="4248.3633" y2="4248.3633"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="195.311" x="159.0273" y="4243.6211">E19. Authentication Required</text></g><path d="M91,4261.3633 L91,4286.3633 L1706,4286.3633 L1706,4271.3633 L1696,4261.3633 L91,4261.3633" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1696,4261.3633 L1696,4271.3633 L1706,4271.3633 L1696,4261.3633" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="210.501" x="789.1887" y="4278.9316">Exception Case 5: Rate Limiting</text><g class="message" data-participant-1="Client" data-participant-2="Gateway"><polygon fill="#181818" points="574.9087,4324.2949,584.9087,4328.2949,574.9087,4332.2949,578.9087,4328.2949" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="142.0273" x2="580.9087" y1="4328.2949" y2="4328.2949"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="162.3477" x="149.0273" y="4308.2422">E20. Excessive Requests</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106.8501" x="149.0273" y="4323.5527">Beyond rate limit</text></g><g class="message" data-participant-1="Gateway" data-participant-2="Gateway"><line style="stroke:#181818;stroke-width:1;" x1="596.9087" x2="638.9087" y1="4372.916" y2="4372.916"/><line style="stroke:#181818;stroke-width:1;" x1="638.9087" x2="638.9087" y1="4372.916" y2="4385.916"/><line style="stroke:#181818;stroke-width:1;" x1="597.9087" x2="638.9087" y1="4385.916" y2="4385.916"/><polygon fill="#181818" points="607.9087,4381.916,597.9087,4385.916,607.9087,4389.916,603.9087,4385.916" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="144.9741" x="603.9087" y="4352.8633">E21. Rate Limit Check</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="193.5591" x="603.9087" y="4368.1738">Too many requests from client</text></g><g class="message" data-participant-1="Gateway" data-participant-2="Client"><polygon fill="#181818" points="153.0273,4487.7793,143.0273,4491.7793,153.0273,4495.7793,149.0273,4491.7793" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="147.0273" x2="590.9087" y1="4491.7793" y2="4491.7793"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="233.835" x="159.0273" y="4410.4844">E22. HTTP 429 Too Many Requests</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.2275" x="159.0273" y="4425.7949">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="188.792" x="167.2539" y="4441.1055">"error": "rate_limit_exceeded",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="412.6548" x="167.2539" y="4456.416">"error_description": "Rate limit exceeded for banking operations",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99.7979" x="167.2539" y="4471.7266">"retry_after": 60</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.2275" x="159.0273" y="4487.0371">}</text></g><path d="M91,4504.7793 L91,4529.7793 L1706,4529.7793 L1706,4514.7793 L1696,4504.7793 L91,4504.7793" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1696,4504.7793 L1696,4514.7793 L1706,4514.7793 L1696,4504.7793" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="297.1528" x="745.8628" y="4522.3477">Exception Case 6: FAPI Compliance Violation</text><g class="message" data-participant-1="Client" data-participant-2="Gateway"><polygon fill="#181818" points="574.9087,4567.7109,584.9087,4571.7109,574.9087,4575.7109,578.9087,4571.7109" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="142.0273" x2="580.9087" y1="4571.7109" y2="4571.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="112.5693" x="149.0273" y="4551.6582">E23. API Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="190.5249" x="149.0273" y="4566.9688">Missing required FAPI headers</text></g><g class="message" data-participant-1="Gateway" data-participant-2="Proxy"><polygon fill="#181818" points="909.4829,4597.0215,919.4829,4601.0215,909.4829,4605.0215,913.4829,4601.0215" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="596.9087" x2="915.4829" y1="4601.0215" y2="4601.0215"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="133.834" x="603.9087" y="4596.2793">E24. FAPI Validation</text></g><g class="message" data-participant-1="Proxy" data-participant-2="Proxy"><line style="stroke:#181818;stroke-width:1;" x1="931.4829" x2="973.4829" y1="4645.6426" y2="4645.6426"/><line style="stroke:#181818;stroke-width:1;" x1="973.4829" x2="973.4829" y1="4645.6426" y2="4658.6426"/><line style="stroke:#181818;stroke-width:1;" x1="932.4829" x2="973.4829" y1="4658.6426" y2="4658.6426"/><polygon fill="#181818" points="942.4829,4654.6426,932.4829,4658.6426,942.4829,4662.6426,938.4829,4658.6426" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="124.8457" x="938.4829" y="4625.5898">E25. Header Check</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171.8374" x="938.4829" y="4640.9004">Missing x-fapi-financial-id</text></g><g class="message" data-participant-1="Proxy" data-participant-2="Client"><polygon fill="#181818" points="153.0273,4760.5059,143.0273,4764.5059,153.0273,4768.5059,149.0273,4764.5059" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="147.0273" x2="925.4829" y1="4764.5059" y2="4764.5059"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="185.5103" x="159.0273" y="4683.2109">E26. HTTP 400 Bad Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.2275" x="159.0273" y="4698.5215">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158.4248" x="167.2539" y="4713.832">"error": "invalid_request",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="330.6177" x="167.2539" y="4729.1426">"error_description": "Missing required FAPI headers",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="417.4409" x="167.2539" y="4744.4531">"required_headers": ["x-fapi-financial-id", "x-fapi-interaction-id"]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.2275" x="159.0273" y="4759.7637">}</text></g><path d="M91,4777.5059 L91,4909.5059 L1706,4909.5059 L1706,4787.5059 L1696,4777.5059 L91,4777.5059" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1696,4777.5059 L1696,4787.5059 L1706,4787.5059 L1696,4777.5059" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="210.3105" x="742.2097" y="4795.0742">Security Features Implemented:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="304.459" x="742.2097" y="4810.3848">&#8226; PKCE prevents authorization code interception</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="249.0947" x="742.2097" y="4825.6953">&#8226; Short-lived access tokens (5 minutes)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="152.9023" x="742.2097" y="4841.0059">&#8226; Refresh token rotation</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="175.7856" x="742.2097" y="4856.3164">&#8226; mTLS between all services</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="250.8848" x="742.2097" y="4871.627">&#8226; JWT signature validation at mesh level</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167.9844" x="742.2097" y="4886.9375">&#8226; FAPI compliance headers</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197.1582" x="742.2097" y="4902.248">&#8226; Comprehensive audit logging</text><!--SRC=[jLdRRXiv4dtNLnIqmC3sMf9riISHe0rifHrx4YU6vKmUneC6tKtPX5jD3PloPHSBxBVif-sNR1N9ladT7Jcp-oRnKYnMdJfLhDP2Hnoy-9x50G_nX-PggKJ2uOJ53oA-WzbBela2El3bUANlOT3j0_sGIloTQI5ZcCgGmsaad-19u8BBZrElrKfmxv8fje1R5ZpSARcAmwcCf8A_pD_CtyvPOKLopqBvH6VDMPJmLWk7jGZ4aiKQsgaUqqZmMD_4Ez_uRUz2teg8xxQ19MwYlEayGTNWFBvJF4bkuWzCyoVsOfQxt-Nrvcu3k5JosQuolyfhFlAN89BiuIREBJ7Zwf4hioEThjJ-9huGWP89BXS1D-jdzdTvkHS_ofURU2P27Z0hrmorMh7K72GUvkuBOzZR8rkZ8BrQxktTn04wmiSLOYvmsGGKYqEvs1aDE_t16mZkcKfstIhy4qKylkEuR7PsF3WysYdjtbZdBpZwFCJbxHckRhTQamdQLsZ18ZWE0ZGp76i4obB3PD9gEIKxVqljRVJjT-63TmqzjXIzO9LekU0g8TK_opLGtNCMSjLYWHQFA23pMYiLXvADZupSGHUczpnuC4BmN14OANjxkG3hq9RTKzeyx08U_yWY4KA2zw3ZvuHNt9wlBrXzr8Mpw-jB61uCu8g7Gl50qoK-INli67gI4PvwYKRdlbFXf7pZLiZNz2eCP3T50zU5t1N_OyMJ9aiVEaiN5IcQezcUHrsOqGwdm1o3kycM1TlyN64Rq3ABZhATxhLU9kDUxy7DTczjk7GZN1Br56VH8kcvmKvYcAYtL5BBG4OzkUIn23k1Z6CyfKStVNSJ0s3CBsMSS5-_BFc4SFmJ3GT6Ir-4axB0pbn9fBqu_CbkjahxAoKcgNxelJNLd5tnPqG4PxOc0MeqiLe1QZb7YWAtROnt2RC_JqfegnGwHlE9ZLJV_F4HYIkdSIa49pPG_NkMt5TCkmYTK7YQwUVE7FNkp4MCt8vXsd4txnmSzBT6u5UahBMe0gOpTwuXC1icABpfLgEM891b2iZqp-6LCMahaxSk-sqNrUO97Vj9teaOJgLQ84GDIofnTs_HU7fyUMwEHPSkS74ofiF_ywz_8xpHwNUGXYImqXNjcejLfD5-g9UiNd0baeVEBKimSPQdQstIF-XQaquHPxGU4nxy5IvEZqcn5Sx4RC7tOScIv4cgS1- -N5_sPXUp1blq-zsYXxWvWCJzIfH60q7XC4GQ7TSaRv3gI44K6t-LxFfU9Ci8AKDPV-Bj3VAJiRNADBKfdis0cTnWPp1F8Azg4F4StLKmv3K6G4B-9-ONk5szr9iG-Vg3ecoPwLU-J86D-bLKRSiKgbggoUYxmVuk3Ru9A-BRpvYcBgXRnIZBKOvXTYqVU0pUCqQ3IShr6NIDs5ETig0ggMIqt9Rq-yZwPwWpabOkTPi4saVIpx1chWkciEEQS5ZOKlOZyiFbbnbUHTFbwG9tv5RBsfMMhRVv3xFsDacXL1bDy6ma71RvfU5NiLV_RS5Wn88cMadIoxYw74D4hD5zW_Z1GK7yPgs-7Y-5CWgPn2BnogLGKkmV1EcsZMFV-AezXlOltwxzu-dKcytywoyVlS_jVRFCp1iNqg8JpXIMntQAFo_HHualQF_muC2EAZx7mVjSy9LtUkNDpafI3R_GvDR9rMqKOLdZy_TExatyp-fWhC3tWCfBF0BNpMnzI6QP8KjnCD8Jh1k3bU9HJL4q67w_OYmLY2YTwyvKoWV1nsbHYe2Z_rkdxc9E227DXCrbus1KLw7NABDjWNxuPohqmL41q0KNN76j17yaqa5VX80UjWufI2dT3edgE0pNOkBCF3L8Ncby31Qzi8xqcxYYiXf3MbfbquBUqZQfcGMhMA3vEovhuj2c9ul6C-y-gpOo9TOtJqo56pLKVkLCb7imslrbGSWxjC7PqbcH4h0b7qZ4NSmq8jdco8mbVldsSUQIkt6Y2UL2_iwSmrOXmYhWTjXxrcG0hBoPM2ImesJ4atrNBUmML7HlOViSEyZhHhvvuKTtL0XKBI4fefMVTNxxz5dTIcMkYqUEErab8gONAzMEGMe3UpKZTSdLGXYOfPNBSXczm6swJwtm8bbDGoD1iUWf7PwRVuWyaX8hlCTrERjceOP4zLkts_tTqbS5ZeZ9Df2qJcUP4J8B5yDWE2peOOngGy34-O-0ro6k0Du2-GsHKaufOPQIIhb8D4e4Sh6C1FMXtEi_gMEsD4UPp04xJqWehiwqiG0krUmQfglid1nNB0Ssnql38In4lD8yeKHPJPD3fBC2eMRWj8B2zOXiviRXKPfrtVOcKYmb-k7FfH8ATfn9TjUAgLAEDTLIuV-ab72tAOc-L-iKheRCzPa_RLrKVFQ- -V-tmeA4bukBrnG1G-JEhykmiWY8yOgs4AX9FAC3YZYjNYpICvFK9vqgIsoRBqRzYdnHdn-Ax3WQqCDQcjYes5f5heLp2xo2kxRcez6eRbyZiOmm26ShWw3vAggHKAGDV5xnfKtvzCmnpUs0nqm9cLGonNx9DldsAJxveJ-6yzXs3GkF-J9dbABLGxTKxa3oCCs8zFdVIr__jUzQR-0Aoj517xx6B4kNUMXnfQGYs0jxf6_u88qOclH3dWHAc2lHmbItGhV0HCZhp38WioIh-Lm4HjtBF9NMywathEPJgv0bjziLljoDdQYCQ2RN79FUw5MnKDXukDw-ClK1gKObbDMCT1B5snOAXngmUqUPwuQasQq8Gqi46txBvVhs0TJel6ejO2vL-Z82b66hjdNcQumpZwfccoxVu-lBvAUg27iLJ8RZR1Rn-yX4n6uZte2GDzz5oDQGUFl3zEXH_ouTs98Vo_iD1sYAymWySYJTX6f1QYE2QsMRBn1e4Yp4QwZMwwSCS8WmghJa1g3SnoT_bQzgGbJwtSrj0_gs8nMI9HR2co8KPJVV550c2R-g8FMefpSLAbW93IVuqdvmxx5qU-3cRktSzj2b1c2DTGnyZDeKmbgjZDsJFm_jqTZLE_ap2qwjDnlmtQyfAHSiecPfwNMxBT2fe_TZv4SjlSsNehrM_aYqxIdtLO00MqjwrEnxRSAoXLi3Gad11cLu-3gQewxSsfSEz-dWVy9uXsEuejsVn49e3Am6B503ZtOZXJzcF6CAXHF-8kCG50cAI50p5ifIaNjo3V9qTYqbeYpE-lcOCvHSkCzbjTOQP2N8u2sGY0iIKTHrpQsaiszqzZdU3MkCiCcvLzaL8LrUdSkIIWOwMcUW7tFQqHZCDwHf_ZRzLSWexLtLEd2pdhcWX4p5YuEKbPi-TBTyAdhKdpCRYu6vJGlDemwSVURddazrgkXdLJSolK5UlHp02IkrPsh2sA6goTUDjidSQ-VyT7WClxKh56_lGxkoXz7-VGqHzStJPeZCgDShz0kSSiCy2PmZECptHHvc7nZDnysbue_qsR7YgmmOxHpOt3T9NA8x4SPyM6fd9B2JzIHstPT7r_kmfR6Ikj2CMrn_ci4jrq-SsY9Hb6Pmrx1QOyqyHp4D2v8PeSwHNMlyiDcNSVqo75SSwTAm57N-D4JoxWuzsVel]--></g></svg>