@startuml OWASP Top 10 Security Architecture
!theme plain

skinparam backgroundColor #FAFAFA
skinparam package {
    BackgroundColor #F5F5F5
    BorderColor #333333
}
skinparam rectangle {
    BackgroundColor #E8F4FD
    BorderColor #2196F3
}

title OWASP Top 10 2021 Security Compliance Architecture
!define SUBTITLE Comprehensive Security Implementation for Banking Systems

package "Security Gateway Layer" {
    rectangle "API Gateway Security" as GATEWAY_SEC #FFE0B2
    note right of GATEWAY_SEC : Rate Limiting & DDoS Protection\n- Redis-backed rate limiting\n- Per-IP request throttling\n- Geographic IP filtering\n- Request size validation
    
    rectangle "OAuth2.1 Identity & Access Management" as AUTH #E1F5FE
    note right of AUTH : Keycloak OAuth2.1 Server\n- Authorization Code Flow with PKCE\n- JWT token validation (RS256)\n- LDAP identity federation\n- Role-based access control (RBAC)\n- Banking compliance features\n- Event-driven audit logging\n\nMulti-layered Authorization:\n- Keycloak realm roles\n- LDAP group membership\n- Party data management roles\n- Temporal access controls
}

package "OWASP Top 10 Protection Filters" {
    
    rectangle "A01: Broken Access Control" as A01 #FFEBEE
    note right of A01
        Access Control Implementation:
        - Path-based authorization
        - Resource-level permissions
        - Privilege escalation prevention
        - Direct object reference protection
        
        Security Measures:
        - Spring Security filter chains
        - Method-level authorization
        - Resource ownership validation
        - Administrative function restriction
    end note
    
    rectangle "A02: Cryptographic Failures" as A02 #F3E5F5
    note right of A02
        Encryption & Hashing:
        - TLS 1.3 encryption in transit
        - AES-256 encryption at rest
        - bcrypt password hashing
        - Secure random generation
        
        Key Management:
        - JWT signing with RS256
        - Database field encryption
        - Secure credential storage
        - Certificate management
    end note
    
    rectangle "A03: Injection" as A03 #E8F5E8
    note right of A03
        Input Validation & Sanitization:
        - SQL injection prevention
        - NoSQL injection protection
        - LDAP injection filtering
        - Command injection blocking
        
        Implementation:
        - Parameterized queries (JPA)
        - Input validation annotations
        - OWASP Java Encoder
        - Regular expression filtering
    end note
    
    rectangle "A04: Insecure Design" as A04 #FFF3E0
    note right of A04
        Secure Architecture Patterns:
        - Defense in depth
        - Fail-safe defaults
        - Principle of least privilege
        - Separation of concerns
        
        Security Headers:
        - Content Security Policy
        - X-Frame-Options: DENY
        - X-Content-Type-Options: nosniff
        - Strict-Transport-Security
    end note
    
    rectangle "A05: Security Misconfiguration" as A05 #E0F2F1
    note right of A05
        Configuration Hardening:
        - Secure default configurations
        - Unnecessary feature removal
        - Error message sanitization
        - Environment separation
        
        Monitoring:
        - Configuration drift detection
        - Security baseline validation
        - Automated compliance checks
        - Regular security audits
    end note
    
    rectangle "A06: Vulnerable Components" as A06 #FCE4EC
    note right of A06
        Dependency Management:
        - Automated vulnerability scanning
        - Dependency version tracking
        - Security patch management
        - License compliance
        
        Tools Integration:
        - Gradle dependency checks
        - OWASP Dependency Check
        - Snyk vulnerability scanning
        - Regular component updates
    end note
}

package "Advanced Security Controls" {
    
    rectangle "A07: Authentication Failures" as A07 #E8EAF6
    note right of A07
        Authentication Hardening:
        - Account lockout mechanisms
        - Password policy enforcement
        - Session timeout controls
        - Brute force protection
        
        Implementation:
        - Failed login tracking
        - CAPTCHA integration
        - Device fingerprinting
        - Anomaly detection
    end note
    
    rectangle "A08: Data Integrity Failures" as A08 #F1F8E9
    note right of A08
        Integrity Validation:
        - Digital signature verification
        - Data tampering detection
        - Checksum validation
        - Audit trail maintenance
        
        Banking Specific:
        - Transaction signing
        - Request/response integrity
        - Non-repudiation
        - Compliance logging
    end note
    
    rectangle "A09: Logging & Monitoring" as A09 #FFF8E1
    note right of A09
        Security Event Logging:
        - Real-time security monitoring
        - Failed authentication tracking
        - Privilege escalation alerts
        - Data access logging
        
        SIEM Integration:
        - Structured log formats
        - Correlation rule engines
        - Automated incident response
        - Forensic investigation support
    end note
    
    rectangle "A10: SSRF Prevention" as A10 #EFEBE9
    note right of A10
        Server-Side Request Forgery:
        - URL validation and filtering
        - Private IP address blocking
        - Protocol restriction
        - DNS resolution control
        
        Network Security:
        - Egress traffic filtering
        - Internal service isolation
        - Request proxy validation
        - Response sanitization
    end note
}

package "OAuth2.1 Identity Architecture" {
    
    rectangle "Keycloak Authorization Server" as KEYCLOAK #E3F2FD
    note right of KEYCLOAK
        OAuth2.1 Server Features:
        - Banking realm configuration
        - Client credentials management
        - Token lifecycle management
        - User federation with LDAP
        - Fine-grained authorization
        
        Security Features:
        - Brute force protection
        - Account lockout policies
        - Password complexity rules
        - Session management
        - Audit event logging
    end note
    
    rectangle "LDAP Identity Provider" as LDAP #F0F4C3
    note right of LDAP
        Enterprise Directory:
        - User identity storage
        - Group membership management
        - Authentication provider
        - Department/role mapping
        - Security credentials
        
        Banking Organization:
        - Loan Officers group
        - Compliance Officers group
        - Customer Service group
        - Administrative groups
        - Role-based security groups
    end note
    
    rectangle "Party Data Management" as PARTY_DATA #FCE4EC
    note right of PARTY_DATA
        Authoritative Role Source:
        - Business role definitions
        - Temporal role assignments
        - Authority level management
        - Monetary limit controls
        - Geographic scope restrictions
        
        Compliance Features:
        - Role review cycles
        - Access certification
        - Segregation of duties
        - Audit trail maintenance
        - Regulatory reporting
    end note
}

package "Banking-Specific Security" {
    
    rectangle "FAPI Compliance" as FAPI #E3F2FD
    note right of FAPI
        Financial API Security:
        - FAPI 1.0 Advanced implementation
        - Request object signing (JWS)
        - MTLS client authentication
        - PKCE code challenge
        - Keycloak FAPI integration
        
        OpenBanking Standards:
        - Customer IP tracking
        - Interaction ID correlation
        - Timestamp validation
        - Geographic restrictions
        - OAuth2.1 compliance
    end note
    
    rectangle "PCI DSS Compliance" as PCI #F9FBE7
    note right of PCI
        Payment Card Security:
        - Cardholder data protection
        - Encrypted transmission
        - Access control measures
        - Regular security testing
        
        Network Security:
        - Firewall configuration
        - Network segmentation
        - Intrusion detection
        - Vulnerability management
    end note
    
    rectangle "Audit & Compliance" as AUDIT #FFF3E0
    note right of AUDIT
        Regulatory Compliance:
        - SOX financial reporting
        - GDPR data protection
        - Basel III risk management
        - Regional banking laws
        
        Audit Trail:
        - Immutable log storage
        - User action tracking
        - Data lineage recording
        - Compliance reporting
    end note
}

package "Implementation Layer" {
    
    rectangle "Redis Security Cache" as REDIS_SEC #FFEBEE
    note right of REDIS_SEC
        Caching Security Data:
        - Token blacklist management
        - Failed login attempt tracking
        - Rate limiting counters
        - Session state storage
        
        Performance:
        - Sub-millisecond lookups
        - Distributed caching
        - Automatic expiration
        - Memory optimization
    end note
    
    rectangle "Database Security" as DB_SEC #E8F5E8
    note right of DB_SEC
        Data Protection:
        - Field-level encryption
        - Row-level security
        - Database activity monitoring
        - Backup encryption
        
        Access Control:
        - Role-based permissions
        - Connection pooling security
        - Query logging
        - Privilege auditing
    end note
    
    rectangle "Microservice Security" as MS_SEC #F3E5F5
    note right of MS_SEC
        Service-to-Service Security:
        - mTLS communication
        - Service mesh security
        - API key management
        - Zero-trust architecture
        
        Isolation:
        - Container security
        - Network policies
        - Resource limits
        - Secret management
    end note
}

' OAuth2.1 Identity Flow Connections
LDAP --> KEYCLOAK : Identity Federation
KEYCLOAK --> PARTY_DATA : Role Authorization
PARTY_DATA --> A01 : Business Authorization
AUTH --> KEYCLOAK : OAuth2.1 Integration

' Security Flow Connections
GATEWAY_SEC --> A01 : Authorization Check
AUTH --> A07 : Authentication Validation
KEYCLOAK --> A07 : OAuth2.1 Authentication
LDAP --> A07 : Identity Verification

A01 --> A02 : Encrypted Communication
A02 --> A03 : Secure Data Handling
A03 --> A04 : Validated Input Processing
A04 --> A05 : Secure Configuration
A05 --> A06 : Component Validation

A06 --> A07 : Authentication Flow
A07 --> A08 : Data Integrity Check
A08 --> A09 : Security Event Logging
A09 --> A10 : Monitoring & Response

' Banking Security Integration
FAPI --> KEYCLOAK : OAuth2.1 FAPI Extension
FAPI --> A02 : Enhanced Encryption
PCI --> A08 : Transaction Integrity
AUDIT --> A09 : Compliance Logging
PARTY_DATA --> AUDIT : Role Audit Trail

REDIS_SEC --> GATEWAY_SEC : Security Cache
DB_SEC --> A02 : Data Encryption
MS_SEC --> A04 : Secure Architecture
PARTY_DATA --> DB_SEC : Role Data Security

note top of GATEWAY_SEC
**Rate Limiting Configuration:**
- API Endpoints: 1000 req/min
- Authentication: 10 req/min
- Geographic filtering enabled
- DDoS protection active
end note

note bottom of FAPI
**FAPI Security Headers:**
- x-fapi-auth-date
- x-fapi-customer-ip-address
- x-fapi-interaction-id
- x-jws-signature
end note

note right of A09
**Security Monitoring Metrics:**
- Failed authentication attempts
- Privilege escalation attempts
- Data access anomalies
- Performance degradation
- Compliance violations
end note

@enduml