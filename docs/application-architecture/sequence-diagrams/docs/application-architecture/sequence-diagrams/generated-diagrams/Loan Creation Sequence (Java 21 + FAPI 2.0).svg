<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="3420px" preserveAspectRatio="none" style="width:2930px;height:3420px;background:#FFFFFF;" version="1.1" viewBox="0 0 2930 3420" width="2930px" zoomAndPan="magnify"><defs/><g><g><title>FAPI 2.0 Gateway</title><rect fill="#FFFFFF" height="990.8008" style="stroke:#181818;stroke-width:1;" width="10" x="407.2935" y="157.041"/></g><g><title>LoanController</title><rect fill="#FFFFFF" height="741.6953" style="stroke:#181818;stroke-width:1;" width="10" x="668.3936" y="406.1465"/></g><g><title>ZeroTrustSecurityService</title><rect fill="#FFFFFF" height="117.5527" style="stroke:#181818;stroke-width:1;" width="10" x="877.1509" y="243.9727"/></g><g><title>LoanApplicationService</title><rect fill="#FFFFFF" height="639.4531" style="stroke:#181818;stroke-width:1;" width="10" x="1069.0171" y="508.3887"/></g><g><title>LoanApplicationService</title><rect fill="#FFFFFF" height="87.9316" style="stroke:#181818;stroke-width:1;" width="10" x="1069.0171" y="2531.1738"/></g><g><title>CustomerApplicationService</title><rect fill="#FFFFFF" height="160.8633" style="stroke:#181818;stroke-width:1;" width="10" x="1370.6934" y="844.1152"/></g><g><title>CustomerApplicationService</title><rect fill="#FFFFFF" height="257.1738" style="stroke:#181818;stroke-width:1;" width="10" x="1370.6934" y="1394.9707"/></g><g><title>CustomerApplicationService</title><rect fill="#FFFFFF" height="149.2422" style="stroke:#181818;stroke-width:1;" width="10" x="1370.6934" y="2875.5898"/></g><g><title>AIRiskAssessmentService</title><rect fill="#FFFFFF" height="117.5527" style="stroke:#181818;stroke-width:1;" width="10" x="1604.6763" y="581.0098"/></g><g><title>Loan</title><rect fill="#FFFFFF" height="229.1738" style="stroke:#181818;stroke-width:1;" width="10" x="1787.1987" y="1880.2734"/></g><g><title>Loan</title><rect fill="#FFFFFF" height="30" style="stroke:#181818;stroke-width:1;" width="10" x="1787.1987" y="2399.2422"/></g><g><title>Customer</title><rect fill="#FFFFFF" height="102.2422" style="stroke:#181818;stroke-width:1;" width="10" x="2048.832" y="873.4258"/></g><g><title>Customer</title><rect fill="#FFFFFF" height="156.2422" style="stroke:#181818;stroke-width:1;" width="10" x="2048.832" y="1424.2813"/></g><g><title>Customer</title><rect fill="#FFFFFF" height="77.6211" style="stroke:#181818;stroke-width:1;" width="10" x="2048.832" y="2904.9004"/></g><g><title>LoanRepository</title><rect fill="#FFFFFF" height="29.3105" style="stroke:#181818;stroke-width:1;" width="10" x="2365.4233" y="2138.7578"/></g><g><title>LoanRepository</title><rect fill="#FFFFFF" height="29.3105" style="stroke:#181818;stroke-width:1;" width="10" x="2365.4233" y="2560.4844"/></g><g><title>LoanRepository</title><rect fill="#FFFFFF" height="29.3105" style="stroke:#181818;stroke-width:1;" width="10" x="2365.4233" y="2816.9688"/></g><g><title>EventPublisher</title><rect fill="#FFFFFF" height="79.9316" style="stroke:#181818;stroke-width:1;" width="10" x="2491.3506" y="1235.418"/></g><g><title>EventPublisher</title><rect fill="#FFFFFF" height="79.9316" style="stroke:#181818;stroke-width:1;" width="10" x="2491.3506" y="2283"/></g><g><title>LoanCreationSaga</title><rect fill="#FFFFFF" height="50.6211" style="stroke:#181818;stroke-width:1;" width="10" x="2737.123" y="1264.7285"/></g><g><title>LoanCreationSaga</title><rect fill="#FFFFFF" height="50.6211" style="stroke:#181818;stroke-width:1;" width="10" x="2737.123" y="2312.3105"/></g><rect fill="none" height="1701.0586" style="stroke:#000000;stroke-width:1.5;" width="2903.9585" x="10" y="1019.9785"/><rect fill="none" height="1046.8926" style="stroke:#000000;stroke-width:1.5;" width="2883.9585" x="20" y="1667.1445"/><rect fill="none" height="335.416" style="stroke:#000000;stroke-width:1.5;" width="2419.7285" x="20" y="2778.3477"/><g><title>Bank Employee</title><rect fill="#000000" fill-opacity="0.00000" height="3348.623" width="8" x="84.0576" y="36.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="88" x2="88" y1="36.4883" y2="3385.1113"/></g><g><title>FAPI 2.0 Gateway</title><rect fill="#000000" fill-opacity="0.00000" height="3348.623" width="8" x="408.2935" y="36.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="411.9692" x2="411.9692" y1="36.4883" y2="3385.1113"/></g><g><title>LoanController</title><rect fill="#000000" fill-opacity="0.00000" height="3348.623" width="8" x="669.3936" y="36.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="673.0708" x2="673.0708" y1="36.4883" y2="3385.1113"/></g><g><title>ZeroTrustSecurityService</title><rect fill="#000000" fill-opacity="0.00000" height="3348.623" width="8" x="878.1509" y="36.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="881.6055" x2="881.6055" y1="36.4883" y2="3385.1113"/></g><g><title>LoanApplicationService</title><rect fill="#000000" fill-opacity="0.00000" height="3348.623" width="8" x="1070.0171" y="36.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1073.6841" x2="1073.6841" y1="36.4883" y2="3385.1113"/></g><g><title>CustomerApplicationService</title><rect fill="#000000" fill-opacity="0.00000" height="3348.623" width="8" x="1371.6934" y="36.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1375.6294" x2="1375.6294" y1="36.4883" y2="3385.1113"/></g><g><title>AIRiskAssessmentService</title><rect fill="#000000" fill-opacity="0.00000" height="3348.623" width="8" x="1605.6763" y="36.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1609.6543" x2="1609.6543" y1="36.4883" y2="3385.1113"/></g><g><title>Loan</title><rect fill="#000000" fill-opacity="0.00000" height="3348.623" width="8" x="1788.1987" y="36.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1791.9565" x2="1791.9565" y1="36.4883" y2="3385.1113"/></g><g><title>Customer</title><rect fill="#000000" fill-opacity="0.00000" height="3348.623" width="8" x="2049.832" y="36.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="2052.8589" x2="2052.8589" y1="36.4883" y2="3385.1113"/></g><g><title>LoanRepository</title><rect fill="#000000" fill-opacity="0.00000" height="3348.623" width="8" x="2366.4233" y="36.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="2370.1182" x2="2370.1182" y1="36.4883" y2="3385.1113"/></g><g><title>EventPublisher</title><rect fill="#000000" fill-opacity="0.00000" height="3348.623" width="8" x="2492.3506" y="36.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="2495.7285" x2="2495.7285" y1="36.4883" y2="3385.1113"/></g><g><title>LoanCreationSaga</title><rect fill="#000000" fill-opacity="0.00000" height="3348.623" width="8" x="2738.123" y="36.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="2741.2559" x2="2741.2559" y1="36.4883" y2="3385.1113"/></g><g class="participant participant-head" data-participant="Employee"><rect fill="#4A90E2" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="116.1152" x="30" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="102.1152" x="37" y="25.5352">Bank Employee</text></g><g class="participant participant-tail" data-participant="Employee"><rect fill="#4A90E2" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="116.1152" x="30" y="3384.1113"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="102.1152" x="37" y="3404.6465">Bank Employee</text></g><g class="participant participant-head" data-participant="Gateway"><rect fill="#F5A623" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="130.6484" x="346.9692" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116.6484" x="353.9692" y="25.5352">FAPI 2.0 Gateway</text></g><g class="participant participant-tail" data-participant="Gateway"><rect fill="#F5A623" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="130.6484" x="346.9692" y="3384.1113"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116.6484" x="353.9692" y="3404.6465">FAPI 2.0 Gateway</text></g><g class="participant participant-head" data-participant="Controller"><rect fill="#F5A623" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="114.6455" x="616.0708" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="100.6455" x="623.0708" y="25.5352">LoanController</text></g><g class="participant participant-tail" data-participant="Controller"><rect fill="#F5A623" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="114.6455" x="616.0708" y="3384.1113"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="100.6455" x="623.0708" y="3404.6465">LoanController</text></g><g class="participant participant-head" data-participant="ZeroTrust"><rect fill="#7ED321" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="181.0908" x="791.6055" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="167.0908" x="798.6055" y="25.5352">ZeroTrustSecurityService</text></g><g class="participant participant-tail" data-participant="ZeroTrust"><rect fill="#7ED321" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="181.0908" x="791.6055" y="3384.1113"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="167.0908" x="798.6055" y="3404.6465">ZeroTrustSecurityService</text></g><g class="participant participant-head" data-participant="LoanService"><rect fill="#7ED321" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="170.666" x="988.6841" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="156.666" x="995.6841" y="25.5352">LoanApplicationService</text></g><g class="participant participant-tail" data-participant="LoanService"><rect fill="#7ED321" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="170.666" x="988.6841" y="3384.1113"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="156.666" x="995.6841" y="3404.6465">LoanApplicationService</text></g><g class="participant participant-head" data-participant="CustomerService"><rect fill="#7ED321" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="204.1279" x="1273.6294" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="190.1279" x="1280.6294" y="25.5352">CustomerApplicationService</text></g><g class="participant participant-tail" data-participant="CustomerService"><rect fill="#7ED321" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="204.1279" x="1273.6294" y="3384.1113"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="190.1279" x="1280.6294" y="3404.6465">CustomerApplicationService</text></g><g class="participant participant-head" data-participant="AIService"><rect fill="#7ED321" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="184.0439" x="1517.6543" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="170.0439" x="1524.6543" y="25.5352">AIRiskAssessmentService</text></g><g class="participant participant-tail" data-participant="AIService"><rect fill="#7ED321" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="184.0439" x="1517.6543" y="3384.1113"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="170.0439" x="1524.6543" y="3404.6465">AIRiskAssessmentService</text></g><g class="participant participant-head" data-participant="LoanAggregate"><rect fill="#BD10E0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="46.4844" x="1768.9565" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="32.4844" x="1775.9565" y="25.5352">Loan</text></g><g class="participant participant-tail" data-participant="LoanAggregate"><rect fill="#BD10E0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="46.4844" x="1768.9565" y="3384.1113"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="32.4844" x="1775.9565" y="3404.6465">Loan</text></g><g class="participant participant-head" data-participant="CustomerAggregate"><rect fill="#BD10E0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="79.9463" x="2013.8589" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="65.9463" x="2020.8589" y="25.5352">Customer</text></g><g class="participant participant-tail" data-participant="CustomerAggregate"><rect fill="#BD10E0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="79.9463" x="2013.8589" y="3384.1113"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="65.9463" x="2020.8589" y="3404.6465">Customer</text></g><g class="participant participant-head" data-participant="LoanRepo"><rect fill="#FF6B6B" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="118.6104" x="2311.1182" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="104.6104" x="2318.1182" y="25.5352">LoanRepository</text></g><g class="participant participant-tail" data-participant="LoanRepo"><rect fill="#FF6B6B" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="118.6104" x="2311.1182" y="3384.1113"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="104.6104" x="2318.1182" y="3404.6465">LoanRepository</text></g><g class="participant participant-head" data-participant="EventPub"><rect fill="#FF6B6B" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="113.2441" x="2439.7285" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="99.2441" x="2446.7285" y="25.5352">EventPublisher</text></g><g class="participant participant-tail" data-participant="EventPub"><rect fill="#FF6B6B" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="113.2441" x="2439.7285" y="3384.1113"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="99.2441" x="2446.7285" y="3404.6465">EventPublisher</text></g><g class="participant participant-head" data-participant="Saga"><rect fill="#7ED321" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="135.7344" x="2674.2559" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="121.7344" x="2681.2559" y="25.5352">LoanCreationSaga</text></g><g class="participant participant-tail" data-participant="Saga"><rect fill="#7ED321" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="135.7344" x="2674.2559" y="3384.1113"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="121.7344" x="2681.2559" y="3404.6465">LoanCreationSaga</text></g><g><title>FAPI 2.0 Gateway</title><rect fill="#FFFFFF" height="990.8008" style="stroke:#181818;stroke-width:1;" width="10" x="407.2935" y="157.041"/></g><g><title>LoanController</title><rect fill="#FFFFFF" height="741.6953" style="stroke:#181818;stroke-width:1;" width="10" x="668.3936" y="406.1465"/></g><g><title>ZeroTrustSecurityService</title><rect fill="#FFFFFF" height="117.5527" style="stroke:#181818;stroke-width:1;" width="10" x="877.1509" y="243.9727"/></g><g><title>LoanApplicationService</title><rect fill="#FFFFFF" height="639.4531" style="stroke:#181818;stroke-width:1;" width="10" x="1069.0171" y="508.3887"/></g><g><title>LoanApplicationService</title><rect fill="#FFFFFF" height="87.9316" style="stroke:#181818;stroke-width:1;" width="10" x="1069.0171" y="2531.1738"/></g><g><title>CustomerApplicationService</title><rect fill="#FFFFFF" height="160.8633" style="stroke:#181818;stroke-width:1;" width="10" x="1370.6934" y="844.1152"/></g><g><title>CustomerApplicationService</title><rect fill="#FFFFFF" height="257.1738" style="stroke:#181818;stroke-width:1;" width="10" x="1370.6934" y="1394.9707"/></g><g><title>CustomerApplicationService</title><rect fill="#FFFFFF" height="149.2422" style="stroke:#181818;stroke-width:1;" width="10" x="1370.6934" y="2875.5898"/></g><g><title>AIRiskAssessmentService</title><rect fill="#FFFFFF" height="117.5527" style="stroke:#181818;stroke-width:1;" width="10" x="1604.6763" y="581.0098"/></g><g><title>Loan</title><rect fill="#FFFFFF" height="229.1738" style="stroke:#181818;stroke-width:1;" width="10" x="1787.1987" y="1880.2734"/></g><g><title>Loan</title><rect fill="#FFFFFF" height="30" style="stroke:#181818;stroke-width:1;" width="10" x="1787.1987" y="2399.2422"/></g><g><title>Customer</title><rect fill="#FFFFFF" height="102.2422" style="stroke:#181818;stroke-width:1;" width="10" x="2048.832" y="873.4258"/></g><g><title>Customer</title><rect fill="#FFFFFF" height="156.2422" style="stroke:#181818;stroke-width:1;" width="10" x="2048.832" y="1424.2813"/></g><g><title>Customer</title><rect fill="#FFFFFF" height="77.6211" style="stroke:#181818;stroke-width:1;" width="10" x="2048.832" y="2904.9004"/></g><g><title>LoanRepository</title><rect fill="#FFFFFF" height="29.3105" style="stroke:#181818;stroke-width:1;" width="10" x="2365.4233" y="2138.7578"/></g><g><title>LoanRepository</title><rect fill="#FFFFFF" height="29.3105" style="stroke:#181818;stroke-width:1;" width="10" x="2365.4233" y="2560.4844"/></g><g><title>LoanRepository</title><rect fill="#FFFFFF" height="29.3105" style="stroke:#181818;stroke-width:1;" width="10" x="2365.4233" y="2816.9688"/></g><g><title>EventPublisher</title><rect fill="#FFFFFF" height="79.9316" style="stroke:#181818;stroke-width:1;" width="10" x="2491.3506" y="1235.418"/></g><g><title>EventPublisher</title><rect fill="#FFFFFF" height="79.9316" style="stroke:#181818;stroke-width:1;" width="10" x="2491.3506" y="2283"/></g><g><title>LoanCreationSaga</title><rect fill="#FFFFFF" height="50.6211" style="stroke:#181818;stroke-width:1;" width="10" x="2737.123" y="1264.7285"/></g><g><title>LoanCreationSaga</title><rect fill="#FFFFFF" height="50.6211" style="stroke:#181818;stroke-width:1;" width="10" x="2737.123" y="2312.3105"/></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="2923.9585" x="0" y="67.1436"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="2923.9585" y1="67.1436" y2="67.1436"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="2923.9585" y1="70.1436" y2="70.1436"/><rect fill="#EEEEEE" height="23.3105" style="stroke:#000000;stroke-width:2;" width="228.4238" x="1347.7673" y="56.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="210.1392" x="1353.7673" y="73.0566">FAPI 2.0 Authenticated Request</text><g class="message" data-participant-1="Employee" data-participant-2="Gateway"><polygon fill="#181818" points="395.2935,153.041,405.2935,157.041,395.2935,161.041,399.2935,157.041" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="88.0576" x2="401.2935" y1="157.041" y2="157.041"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124.7568" x="95.0576" y="106.3672">POST /api/v1/loans</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="253.811" x="95.0576" y="121.6777">{customerId, amount, rate, installments}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165.7437" x="95.0576" y="136.9883">Authorization: Bearer {jwt}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122.0591" x="95.0576" y="152.2988">DPoP: {dpop_proof}</text></g><g class="message" data-participant-1="Gateway" data-participant-2="Gateway"><line style="stroke:#181818;stroke-width:1;" x1="417.2935" x2="459.2935" y1="201.6621" y2="201.6621"/><line style="stroke:#181818;stroke-width:1;" x1="459.2935" x2="459.2935" y1="201.6621" y2="214.6621"/><line style="stroke:#181818;stroke-width:1;" x1="418.2935" x2="459.2935" y1="214.6621" y2="214.6621"/><polygon fill="#181818" points="428.2935,210.6621,418.2935,214.6621,428.2935,218.6621,424.2935,214.6621" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160.2847" x="424.2935" y="181.6094">Validate FAPI 2.0 headers</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="169.1396" x="424.2935" y="196.9199">(DPoP, JWT, Interaction-ID)</text></g><g class="message" data-participant-1="Gateway" data-participant-2="ZeroTrust"><polygon fill="#181818" points="865.1509,239.9727,875.1509,243.9727,865.1509,247.9727,869.1509,243.9727" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="417.2935" x2="871.1509" y1="243.9727" y2="243.9727"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="169.7236" x="424.2935" y="239.2305">assessThreatLevel(request)</text></g><g class="message" data-participant-1="ZeroTrust" data-participant-2="ZeroTrust"><line style="stroke:#181818;stroke-width:1;" x1="887.1509" x2="929.1509" y1="303.9043" y2="303.9043"/><line style="stroke:#181818;stroke-width:1;" x1="929.1509" x2="929.1509" y1="303.9043" y2="316.9043"/><line style="stroke:#181818;stroke-width:1;" x1="888.1509" x2="929.1509" y1="316.9043" y2="316.9043"/><polygon fill="#181818" points="898.1509,312.9043,888.1509,316.9043,898.1509,320.9043,894.1509,316.9043" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157.8662" x="894.1509" y="268.541">Analyze behavior pattern</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111.0078" x="894.1509" y="283.8516">Device reputation</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116.5176" x="894.1509" y="299.1621">Contextual factors</text></g><g class="message" data-participant-1="ZeroTrust" data-participant-2="Gateway"><polygon fill="#181818" points="428.2935,357.5254,418.2935,361.5254,428.2935,365.5254,424.2935,361.5254" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="422.2935" x2="881.1509" y1="361.5254" y2="361.5254"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124.7314" x="434.2935" y="341.4727">SecurityAssessment</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114.2705" x="434.2935" y="356.7832">{threatLevel: LOW}</text></g><g class="message" data-participant-1="Gateway" data-participant-2="Controller"><polygon fill="#181818" points="656.3936,402.1465,666.3936,406.1465,656.3936,410.1465,660.3936,406.1465" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="417.2935" x2="662.3936" y1="406.1465" y2="406.1465"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102.6289" x="424.2935" y="386.0938">Forward request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140.3657" x="424.2935" y="401.4043">(with security context)</text></g><g class="message" data-participant-1="Controller" data-participant-2="Controller"><line style="stroke:#181818;stroke-width:1;" x1="678.3936" x2="720.3936" y1="466.0781" y2="466.0781"/><line style="stroke:#181818;stroke-width:1;" x1="720.3936" x2="720.3936" y1="466.0781" y2="479.0781"/><line style="stroke:#181818;stroke-width:1;" x1="679.3936" x2="720.3936" y1="479.0781" y2="479.0781"/><polygon fill="#181818" points="689.3936,475.0781,679.3936,479.0781,689.3936,483.0781,685.3936,479.0781" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102.3179" x="685.3936" y="430.7148">Validate request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="174.7573" x="685.3936" y="446.0254">(amount, rate, installments)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158.4629" x="685.3936" y="461.3359">Java 21 pattern matching</text></g><g class="message" data-participant-1="Controller" data-participant-2="LoanService"><polygon fill="#181818" points="1057.0171,504.3887,1067.0171,508.3887,1057.0171,512.3887,1061.0171,508.3887" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="678.3936" x2="1063.0171" y1="508.3887" y2="508.3887"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="212.8115" x="685.3936" y="503.6465">createLoan(CreateLoanCommand)</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="2923.9585" x="0" y="537.0439"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="2923.9585" y1="537.0439" y2="537.0439"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="2923.9585" y1="540.0439" y2="540.0439"/><rect fill="#EEEEEE" height="23.3105" style="stroke:#000000;stroke-width:2;" width="215.6841" x="1354.1372" y="526.3887"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="197.3994" x="1360.1372" y="542.957">AI-Powered Risk Assessment</text><g class="message" data-participant-1="LoanService" data-participant-2="AIService"><polygon fill="#181818" points="1592.6763,577.0098,1602.6763,581.0098,1592.6763,585.0098,1596.6763,581.0098" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1079.0171" x2="1598.6763" y1="581.0098" y2="581.0098"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="294.6772" x="1086.0171" y="576.2676">assessRiskLevel(customerId, amount, purpose)</text></g><g class="message" data-participant-1="AIService" data-participant-2="AIService"><line style="stroke:#181818;stroke-width:1;" x1="1614.6763" x2="1656.6763" y1="640.9414" y2="640.9414"/><line style="stroke:#181818;stroke-width:1;" x1="1656.6763" x2="1656.6763" y1="640.9414" y2="653.9414"/><line style="stroke:#181818;stroke-width:1;" x1="1615.6763" x2="1656.6763" y1="653.9414" y2="653.9414"/><polygon fill="#181818" points="1625.6763,649.9414,1615.6763,653.9414,1625.6763,657.9414,1621.6763,653.9414" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130.4888" x="1621.6763" y="605.5781">ML model evaluation</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148.5225" x="1621.6763" y="620.8887">Fraud pattern detection</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116.4097" x="1621.6763" y="636.1992">Credit risk scoring</text></g><g class="message" data-participant-1="AIService" data-participant-2="LoanService"><polygon fill="#181818" points="1090.0171,694.5625,1080.0171,698.5625,1090.0171,702.5625,1086.0171,698.5625" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="1084.0171" x2="1608.6763" y1="698.5625" y2="698.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101.2324" x="1096.0171" y="678.5098">RiskAssessment</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="180.2354" x="1096.0171" y="693.8203">{score: 0.85, approved: true}</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="2923.9585" x="0" y="727.2178"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="2923.9585" y1="727.2178" y2="727.2178"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="2923.9585" y1="730.2178" y2="730.2178"/><rect fill="#EEEEEE" height="23.3105" style="stroke:#000000;stroke-width:2;" width="183.1396" x="1370.4094" y="716.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="164.855" x="1376.4094" y="733.1309">Business Rule Validation</text><g class="message" data-participant-1="LoanService" data-participant-2="LoanService"><line style="stroke:#181818;stroke-width:1;" x1="1079.0171" x2="1121.0171" y1="801.8047" y2="801.8047"/><line style="stroke:#181818;stroke-width:1;" x1="1121.0171" x2="1121.0171" y1="801.8047" y2="814.8047"/><line style="stroke:#181818;stroke-width:1;" x1="1080.0171" x2="1121.0171" y1="814.8047" y2="814.8047"/><polygon fill="#181818" points="1090.0171,810.8047,1080.0171,814.8047,1090.0171,818.8047,1086.0171,814.8047" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142.873" x="1086.0171" y="766.4414">Calculate total amount</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129.8604" x="1086.0171" y="781.752">(principal + interest)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="198.5991" x="1086.0171" y="797.0625">Java 21 records and BigDecimal</text></g><g class="message" data-participant-1="LoanService" data-participant-2="CustomerService"><polygon fill="#181818" points="1358.6934,840.1152,1368.6934,844.1152,1358.6934,848.1152,1362.6934,844.1152" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1079.0171" x2="1364.6934" y1="844.1152" y2="844.1152"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="272.6763" x="1086.0171" y="839.373">isEligibleForLoan(customerId, totalAmount)</text></g><g class="message" data-participant-1="CustomerService" data-participant-2="CustomerAggregate"><polygon fill="#181818" points="2036.832,869.4258,2046.832,873.4258,2036.832,877.4258,2040.832,873.4258" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1380.6934" x2="2042.832" y1="873.4258" y2="873.4258"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="175.9634" x="1387.6934" y="868.6836">hasSufficientCredit(amount)</text></g><g class="message" data-participant-1="CustomerAggregate" data-participant-2="CustomerAggregate"><line style="stroke:#181818;stroke-width:1;" x1="2058.832" x2="2100.832" y1="933.3574" y2="933.3574"/><line style="stroke:#181818;stroke-width:1;" x1="2100.832" x2="2100.832" y1="933.3574" y2="946.3574"/><line style="stroke:#181818;stroke-width:1;" x1="2059.832" x2="2100.832" y1="946.3574" y2="946.3574"/><polygon fill="#181818" points="2069.832,942.3574,2059.832,946.3574,2069.832,950.3574,2065.832,946.3574" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137.7759" x="2065.832" y="897.9941">Check available credit</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160.1514" x="2065.832" y="913.3047">(creditLimit - usedCredit)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="282.5913" x="2065.832" y="928.6152">Java 21 virtual threads for concurrent checks</text></g><g class="message" data-participant-1="CustomerAggregate" data-participant-2="CustomerService"><polygon fill="#181818" points="1391.6934,971.668,1381.6934,975.668,1391.6934,979.668,1387.6934,975.668" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="1385.6934" x2="2052.832" y1="975.668" y2="975.668"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97.7222" x="1397.6934" y="970.9258">eligibility result</text></g><g class="message" data-participant-1="CustomerService" data-participant-2="LoanService"><polygon fill="#181818" points="1090.0171,1000.9785,1080.0171,1004.9785,1090.0171,1008.9785,1086.0171,1004.9785" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="1084.0171" x2="1374.6934" y1="1004.9785" y2="1004.9785"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97.7222" x="1096.0171" y="1000.2363">eligibility result</text></g><path d="M10,1019.9785 L72.1387,1019.9785 L72.1387,1027.2891 L62.1387,1037.2891 L10,1037.2891 L10,1019.9785" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="1701.0586" style="stroke:#000000;stroke-width:1.5;" width="2903.9585" x="10" y="1019.9785"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1387" x="25" y="1033.5469">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="132.1235" x="87.1387" y="1032.6133">[Customer Not Eligible]</text><g class="message" data-participant-1="LoanService" data-participant-2="Controller"><polygon fill="#181818" points="689.3936,1054.5996,679.3936,1058.5996,689.3936,1062.5996,685.3936,1058.5996" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="683.3936" x2="1068.0171" y1="1058.5996" y2="1058.5996"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="210.9136" x="695.3936" y="1053.8574">throw InsufficientCreditException</text></g><g class="message" data-participant-1="Controller" data-participant-2="Gateway"><polygon fill="#181818" points="428.2935,1099.2207,418.2935,1103.2207,428.2935,1107.2207,424.2935,1103.2207" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="422.2935" x2="667.3936" y1="1103.2207" y2="1103.2207"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106.1709" x="434.2935" y="1083.168">400 Bad Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="227.1001" x="434.2935" y="1098.4785">{errorCode: "INSUFFICIENT_CREDIT"}</text></g><g class="message" data-participant-1="Gateway" data-participant-2="Employee"><polygon fill="#181818" points="99.0576,1143.8418,89.0576,1147.8418,99.0576,1151.8418,95.0576,1147.8418" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="93.0576" x2="411.2935" y1="1147.8418" y2="1147.8418"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148.2432" x="105.0576" y="1127.7891">FAPI 2.0 error response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="295.2358" x="105.0576" y="1143.0996">{error: "insufficient_credit", interaction_id: "..."}</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="10" x2="2913.9585" y1="1156.8418" y2="1156.8418"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="108.5605" x="15" y="1167.4766">[Customer Eligible]</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="2923.9585" x="0" y="1191.4521"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="2923.9585" y1="1191.4521" y2="1191.4521"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="2923.9585" y1="1194.4521" y2="1194.4521"/><rect fill="#EEEEEE" height="23.3105" style="stroke:#000000;stroke-width:2;" width="119.3838" x="1402.2874" y="1180.7969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="101.0991" x="1408.2874" y="1197.3652">SAGA Initiation</text><g class="message" data-participant-1="LoanService" data-participant-2="EventPub"><polygon fill="#181818" points="2479.3506,1231.418,2489.3506,1235.418,2479.3506,1239.418,2483.3506,1235.418" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1074.0171" x2="2485.3506" y1="1235.418" y2="1235.418"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="258.0322" x="1081.0171" y="1230.6758">publishAsync(LoanApplicationSubmitted)</text></g><g class="message" data-participant-1="EventPub" data-participant-2="Saga"><polygon fill="#181818" points="2725.123,1260.7285,2735.123,1264.7285,2725.123,1268.7285,2729.123,1264.7285" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="2501.3506" x2="2731.123" y1="1264.7285" y2="1264.7285"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="216.7725" x="2508.3506" y="1259.9863">handle(LoanApplicationSubmitted)</text></g><g class="message" data-participant-1="Saga" data-participant-2="Saga"><line style="stroke:#181818;stroke-width:1;" x1="2747.123" x2="2789.123" y1="1314.3496" y2="1314.3496"/><line style="stroke:#181818;stroke-width:1;" x1="2789.123" x2="2789.123" y1="1314.3496" y2="1327.3496"/><line style="stroke:#181818;stroke-width:1;" x1="2742.123" x2="2789.123" y1="1327.3496" y2="1327.3496"/><polygon fill="#181818" points="2752.123,1323.3496,2742.123,1327.3496,2752.123,1331.3496,2748.123,1327.3496" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="67.6724" x="2754.123" y="1294.2969">Start SAGA</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="108.583" x="2754.123" y="1309.6074">(store saga state)</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="2923.9585" x="0" y="1351.0049"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="2923.9585" y1="1351.0049" y2="1351.0049"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="2923.9585" y1="1354.0049" y2="1354.0049"/><rect fill="#EEEEEE" height="23.3105" style="stroke:#000000;stroke-width:2;" width="142.6226" x="1390.668" y="1340.3496"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="124.3379" x="1396.668" y="1356.918">Credit Reservation</text><g class="message" data-participant-1="LoanService" data-participant-2="CustomerService"><polygon fill="#181818" points="1358.6934,1390.9707,1368.6934,1394.9707,1358.6934,1398.9707,1362.6934,1394.9707" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1074.0171" x2="1364.6934" y1="1394.9707" y2="1394.9707"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="250.3262" x="1081.0171" y="1390.2285">reserveCredit(customerId, totalAmount)</text></g><g class="message" data-participant-1="CustomerService" data-participant-2="CustomerAggregate"><polygon fill="#181818" points="2036.832,1420.2813,2046.832,1424.2813,2036.832,1428.2813,2040.832,1424.2813" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1380.6934" x2="2042.832" y1="1424.2813" y2="1424.2813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140.8354" x="1387.6934" y="1419.5391">reserveCredit(amount)</text></g><g class="message" data-participant-1="CustomerAggregate" data-participant-2="CustomerAggregate"><line style="stroke:#181818;stroke-width:1;" x1="2058.832" x2="2100.832" y1="1453.5918" y2="1453.5918"/><line style="stroke:#181818;stroke-width:1;" x1="2100.832" x2="2100.832" y1="1453.5918" y2="1466.5918"/><line style="stroke:#181818;stroke-width:1;" x1="2059.832" x2="2100.832" y1="1466.5918" y2="1466.5918"/><polygon fill="#181818" points="2069.832,1462.5918,2059.832,1466.5918,2069.832,1470.5918,2065.832,1466.5918" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153.5117" x="2065.832" y="1448.8496">Validate sufficient credit</text></g><g class="message" data-participant-1="CustomerAggregate" data-participant-2="CustomerAggregate"><line style="stroke:#181818;stroke-width:1;" x1="2058.832" x2="2100.832" y1="1495.9023" y2="1495.9023"/><line style="stroke:#181818;stroke-width:1;" x1="2100.832" x2="2100.832" y1="1495.9023" y2="1508.9023"/><line style="stroke:#181818;stroke-width:1;" x1="2059.832" x2="2100.832" y1="1508.9023" y2="1508.9023"/><polygon fill="#181818" points="2069.832,1504.9023,2059.832,1508.9023,2069.832,1512.9023,2065.832,1508.9023" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148.6938" x="2065.832" y="1491.1602">Update usedCreditLimit</text></g><g class="message" data-participant-1="CustomerAggregate" data-participant-2="CustomerAggregate"><line style="stroke:#181818;stroke-width:1;" x1="2058.832" x2="2100.832" y1="1538.2129" y2="1538.2129"/><line style="stroke:#181818;stroke-width:1;" x1="2100.832" x2="2100.832" y1="1538.2129" y2="1551.2129"/><line style="stroke:#181818;stroke-width:1;" x1="2059.832" x2="2100.832" y1="1551.2129" y2="1551.2129"/><polygon fill="#181818" points="2069.832,1547.2129,2059.832,1551.2129,2069.832,1555.2129,2065.832,1551.2129" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167.6924" x="2065.832" y="1533.4707">raiseEvent(CreditReserved)</text></g><g class="message" data-participant-1="CustomerAggregate" data-participant-2="CustomerService"><polygon fill="#181818" points="1391.6934,1576.5234,1381.6934,1580.5234,1391.6934,1584.5234,1387.6934,1580.5234" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="1385.6934" x2="2052.832" y1="1580.5234" y2="1580.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122.9541" x="1397.6934" y="1575.7813">reservation success</text></g><g class="message" data-participant-1="CustomerService" data-participant-2="CustomerService"><line style="stroke:#181818;stroke-width:1;" x1="1380.6934" x2="1422.6934" y1="1609.834" y2="1609.834"/><line style="stroke:#181818;stroke-width:1;" x1="1422.6934" x2="1422.6934" y1="1609.834" y2="1622.834"/><line style="stroke:#181818;stroke-width:1;" x1="1381.6934" x2="1422.6934" y1="1622.834" y2="1622.834"/><polygon fill="#181818" points="1391.6934,1618.834,1381.6934,1622.834,1391.6934,1626.834,1387.6934,1622.834" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="199.9829" x="1387.6934" y="1605.0918">Save customer &amp; publish events</text></g><g class="message" data-participant-1="CustomerService" data-participant-2="LoanService"><polygon fill="#181818" points="1085.0171,1648.1445,1075.0171,1652.1445,1085.0171,1656.1445,1081.0171,1652.1445" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="1079.0171" x2="1374.6934" y1="1652.1445" y2="1652.1445"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="110.3223" x="1091.0171" y="1647.4023">reservation result</text></g><path d="M20,1667.1445 L82.1387,1667.1445 L82.1387,1674.4551 L72.1387,1684.4551 L20,1684.4551 L20,1667.1445" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="1046.8926" style="stroke:#000000;stroke-width:1.5;" width="2883.9585" x="20" y="1667.1445"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1387" x="35" y="1680.7129">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="150.6592" x="97.1387" y="1679.7793">[Credit Reservation Failed]</text><g class="message" data-participant-1="LoanService" data-participant-2="Controller"><polygon fill="#181818" points="684.3936,1701.7656,674.3936,1705.7656,684.3936,1709.7656,680.3936,1705.7656" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="678.3936" x2="1073.0171" y1="1705.7656" y2="1705.7656"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="210.9136" x="690.3936" y="1701.0234">throw InsufficientCreditException</text></g><g class="message" data-participant-1="Controller" data-participant-2="Employee"><polygon fill="#181818" points="99.0576,1746.3867,89.0576,1750.3867,99.0576,1754.3867,95.0576,1750.3867" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="93.0576" x2="672.3936" y1="1750.3867" y2="1750.3867"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106.1709" x="105.0576" y="1730.334">400 Bad Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="227.1001" x="105.0576" y="1745.6445">{errorCode: "INSUFFICIENT_CREDIT"}</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="20" x2="2903.9585" y1="1759.3867" y2="1759.3867"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="171.4238" x="25" y="1770.0215">[Credit Reserved Successfully]</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="2923.9585" x="0" y="1793.9971"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="2923.9585" y1="1793.9971" y2="1793.9971"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="2923.9585" y1="1796.9971" y2="1796.9971"/><rect fill="#EEEEEE" height="23.3105" style="stroke:#000000;stroke-width:2;" width="111.3794" x="1406.2896" y="1783.3418"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="93.0947" x="1412.2896" y="1799.9102">Loan Creation</text><g class="message" data-participant-1="LoanService" data-participant-2="LoanService"><line style="stroke:#181818;stroke-width:1;" x1="1074.0171" x2="1116.0171" y1="1837.9629" y2="1837.9629"/><line style="stroke:#181818;stroke-width:1;" x1="1116.0171" x2="1116.0171" y1="1837.9629" y2="1850.9629"/><line style="stroke:#181818;stroke-width:1;" x1="1075.0171" x2="1116.0171" y1="1850.9629" y2="1850.9629"/><polygon fill="#181818" points="1085.0171,1846.9629,1075.0171,1850.9629,1085.0171,1854.9629,1081.0171,1850.9629" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102.7559" x="1081.0171" y="1833.2207">Generate LoanId</text></g><g class="message" data-participant-1="LoanService" data-participant-2="LoanAggregate"><polygon fill="#181818" points="1775.1987,1876.2734,1785.1987,1880.2734,1775.1987,1884.2734,1779.1987,1880.2734" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1074.0171" x2="1781.1987" y1="1880.2734" y2="1880.2734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="333.582" x="1081.0171" y="1875.5313">new Loan(id, customerId, amount, installments, rate)</text></g><g class="message" data-participant-1="LoanAggregate" data-participant-2="LoanAggregate"><line style="stroke:#181818;stroke-width:1;" x1="1797.1987" x2="1839.1987" y1="1909.584" y2="1909.584"/><line style="stroke:#181818;stroke-width:1;" x1="1839.1987" x2="1839.1987" y1="1909.584" y2="1922.584"/><line style="stroke:#181818;stroke-width:1;" x1="1798.1987" x2="1839.1987" y1="1922.584" y2="1922.584"/><polygon fill="#181818" points="1808.1987,1918.584,1798.1987,1922.584,1808.1987,1926.584,1804.1987,1922.584" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145.1011" x="1804.1987" y="1904.8418">Validate business rules</text></g><g class="message" data-participant-1="LoanAggregate" data-participant-2="LoanAggregate"><line style="stroke:#181818;stroke-width:1;" x1="1797.1987" x2="1839.1987" y1="1967.2051" y2="1967.2051"/><line style="stroke:#181818;stroke-width:1;" x1="1839.1987" x2="1839.1987" y1="1967.2051" y2="1980.2051"/><line style="stroke:#181818;stroke-width:1;" x1="1798.1987" x2="1839.1987" y1="1980.2051" y2="1980.2051"/><polygon fill="#181818" points="1808.1987,1976.2051,1798.1987,1980.2051,1808.1987,1984.2051,1804.1987,1980.2051" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142.873" x="1804.1987" y="1947.1523">Calculate total amount</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141.7178" x="1804.1987" y="1962.4629">(principal &#215; (1 + rate))</text></g><g class="message" data-participant-1="LoanAggregate" data-participant-2="LoanAggregate"><line style="stroke:#181818;stroke-width:1;" x1="1797.1987" x2="1839.1987" y1="2024.8262" y2="2024.8262"/><line style="stroke:#181818;stroke-width:1;" x1="1839.1987" x2="1839.1987" y1="2024.8262" y2="2037.8262"/><line style="stroke:#181818;stroke-width:1;" x1="1798.1987" x2="1839.1987" y1="2037.8262" y2="2037.8262"/><polygon fill="#181818" points="1808.1987,2033.8262,1798.1987,2037.8262,1808.1987,2041.8262,1804.1987,2037.8262" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="190.9438" x="1804.1987" y="2004.7734">Generate installment schedule</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="227.6333" x="1804.1987" y="2020.084">(equal amounts, monthly due dates)</text></g><g class="message" data-participant-1="LoanAggregate" data-participant-2="LoanAggregate"><line style="stroke:#181818;stroke-width:1;" x1="1797.1987" x2="1839.1987" y1="2067.1367" y2="2067.1367"/><line style="stroke:#181818;stroke-width:1;" x1="1839.1987" x2="1839.1987" y1="2067.1367" y2="2080.1367"/><line style="stroke:#181818;stroke-width:1;" x1="1798.1987" x2="1839.1987" y1="2080.1367" y2="2080.1367"/><polygon fill="#181818" points="1808.1987,2076.1367,1798.1987,2080.1367,1808.1987,2084.1367,1804.1987,2080.1367" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151.7153" x="1804.1987" y="2062.3945">raiseEvent(LoanCreated)</text></g><g class="message" data-participant-1="LoanAggregate" data-participant-2="LoanService"><polygon fill="#181818" points="1085.0171,2105.4473,1075.0171,2109.4473,1085.0171,2113.4473,1081.0171,2109.4473" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="1079.0171" x2="1791.1987" y1="2109.4473" y2="2109.4473"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83.5669" x="1091.0171" y="2104.7051">loan instance</text></g><g class="message" data-participant-1="LoanService" data-participant-2="LoanRepo"><polygon fill="#181818" points="2353.4233,2134.7578,2363.4233,2138.7578,2353.4233,2142.7578,2357.4233,2138.7578" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1074.0171" x2="2359.4233" y1="2138.7578" y2="2138.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="63.2227" x="1081.0171" y="2134.0156">save(loan)</text></g><g class="message" data-participant-1="LoanRepo" data-participant-2="LoanService"><polygon fill="#181818" points="1085.0171,2164.0684,1075.0171,2168.0684,1085.0171,2172.0684,1081.0171,2168.0684" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="1079.0171" x2="2369.4233" y1="2168.0684" y2="2168.0684"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="67.063" x="1091.0171" y="2163.3262">saved loan</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="2923.9585" x="0" y="2196.7236"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="2923.9585" y1="2196.7236" y2="2196.7236"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="2923.9585" y1="2199.7236" y2="2199.7236"/><rect fill="#EEEEEE" height="23.3105" style="stroke:#000000;stroke-width:2;" width="130.3208" x="1396.8188" y="2186.0684"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="112.0361" x="1402.8188" y="2202.6367">Event Publishing</text><g class="message" data-participant-1="LoanService" data-participant-2="LoanService"><line style="stroke:#181818;stroke-width:1;" x1="1074.0171" x2="1116.0171" y1="2240.6895" y2="2240.6895"/><line style="stroke:#181818;stroke-width:1;" x1="1116.0171" x2="1116.0171" y1="2240.6895" y2="2253.6895"/><line style="stroke:#181818;stroke-width:1;" x1="1075.0171" x2="1116.0171" y1="2253.6895" y2="2253.6895"/><polygon fill="#181818" points="1085.0171,2249.6895,1075.0171,2253.6895,1085.0171,2257.6895,1081.0171,2253.6895" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="183.2441" x="1081.0171" y="2235.9473">Get domain events from loan</text></g><g class="message" data-participant-1="LoanService" data-participant-2="EventPub"><polygon fill="#181818" points="2479.3506,2279,2489.3506,2283,2479.3506,2287,2483.3506,2283" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1074.0171" x2="2485.3506" y1="2283" y2="2283"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171.3994" x="1081.0171" y="2278.2578">publishAsync(LoanCreated)</text></g><g class="message" data-participant-1="EventPub" data-participant-2="Saga"><polygon fill="#181818" points="2725.123,2308.3105,2735.123,2312.3105,2725.123,2316.3105,2729.123,2312.3105" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="2501.3506" x2="2731.123" y1="2312.3105" y2="2312.3105"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130.1396" x="2508.3506" y="2307.5684">handle(LoanCreated)</text></g><g class="message" data-participant-1="Saga" data-participant-2="Saga"><line style="stroke:#181818;stroke-width:1;" x1="2747.123" x2="2789.123" y1="2361.9316" y2="2361.9316"/><line style="stroke:#181818;stroke-width:1;" x1="2789.123" x2="2789.123" y1="2361.9316" y2="2374.9316"/><line style="stroke:#181818;stroke-width:1;" x1="2742.123" x2="2789.123" y1="2374.9316" y2="2374.9316"/><polygon fill="#181818" points="2752.123,2370.9316,2742.123,2374.9316,2752.123,2378.9316,2748.123,2374.9316" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98.8521" x="2754.123" y="2341.8789">Complete SAGA</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="127.8354" x="2754.123" y="2357.1895">(mark as successful)</text></g><g class="message" data-participant-1="LoanService" data-participant-2="LoanAggregate"><polygon fill="#181818" points="1775.1987,2395.2422,1785.1987,2399.2422,1775.1987,2403.2422,1779.1987,2399.2422" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1074.0171" x2="1781.1987" y1="2399.2422" y2="2399.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128.0513" x="1081.0171" y="2394.5">clearDomainEvents()</text></g><g class="message" data-participant-1="LoanService" data-participant-2="Controller"><polygon fill="#181818" points="684.3936,2454.5527,674.3936,2458.5527,684.3936,2462.5527,680.3936,2458.5527" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="678.3936" x2="1073.0171" y1="2458.5527" y2="2458.5527"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="38.9175" x="690.3936" y="2453.8105">loanId</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="2923.9585" x="0" y="2487.208"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="2923.9585" y1="2487.208" y2="2487.208"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="2923.9585" y1="2490.208" y2="2490.208"/><rect fill="#EEEEEE" height="23.3105" style="stroke:#000000;stroke-width:2;" width="82.6436" x="1420.6575" y="2476.5527"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="64.3589" x="1426.6575" y="2493.1211">Response</text><g class="message" data-participant-1="Controller" data-participant-2="LoanService"><polygon fill="#181818" points="1057.0171,2527.1738,1067.0171,2531.1738,1057.0171,2535.1738,1061.0171,2531.1738" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="673.3936" x2="1063.0171" y1="2531.1738" y2="2531.1738"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97.7476" x="680.3936" y="2526.4316">getLoan(loanId)</text></g><g class="message" data-participant-1="LoanService" data-participant-2="LoanRepo"><polygon fill="#181818" points="2353.4233,2556.4844,2363.4233,2560.4844,2353.4233,2564.4844,2357.4233,2560.4844" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1079.0171" x2="2359.4233" y1="2560.4844" y2="2560.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98.3569" x="1086.0171" y="2555.7422">findById(loanId)</text></g><g class="message" data-participant-1="LoanRepo" data-participant-2="LoanService"><polygon fill="#181818" points="1090.0171,2585.7949,1080.0171,2589.7949,1090.0171,2593.7949,1086.0171,2589.7949" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="1084.0171" x2="2369.4233" y1="2589.7949" y2="2589.7949"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="26.9902" x="1096.0171" y="2585.0527">loan</text></g><g class="message" data-participant-1="LoanService" data-participant-2="Controller"><polygon fill="#181818" points="684.3936,2615.1055,674.3936,2619.1055,684.3936,2623.1055,680.3936,2619.1055" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="678.3936" x2="1073.0171" y1="2619.1055" y2="2619.1055"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72.7124" x="690.3936" y="2614.3633">loan details</text></g><g class="message" data-participant-1="Controller" data-participant-2="Controller"><line style="stroke:#181818;stroke-width:1;" x1="673.3936" x2="715.3936" y1="2648.416" y2="2648.416"/><line style="stroke:#181818;stroke-width:1;" x1="715.3936" x2="715.3936" y1="2648.416" y2="2661.416"/><line style="stroke:#181818;stroke-width:1;" x1="674.3936" x2="715.3936" y1="2661.416" y2="2661.416"/><polygon fill="#181818" points="684.3936,2657.416,674.3936,2661.416,684.3936,2665.416,680.3936,2661.416" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192.8037" x="680.3936" y="2643.6738">Convert to LoanResponse DTO</text></g><g class="message" data-participant-1="Controller" data-participant-2="Employee"><polygon fill="#181818" points="99.0576,2702.0371,89.0576,2706.0371,99.0576,2710.0371,95.0576,2706.0371" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="93.0576" x2="672.3936" y1="2706.0371" y2="2706.0371"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="77.7969" x="105.0576" y="2685.9844">201 Created</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="309.8672" x="105.0576" y="2701.2949">LoanResponse{loanId, totalAmount, installments}</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="2923.9585" x="0" y="2748.6924"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="2923.9585" y1="2748.6924" y2="2748.6924"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="2923.9585" y1="2751.6924" y2="2751.6924"/><rect fill="#EEEEEE" height="23.3105" style="stroke:#000000;stroke-width:2;" width="239.9321" x="1342.0132" y="2738.0371"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="221.6475" x="1348.0132" y="2754.6055">Error Handling (Alternative Flow)</text><path d="M20,2778.3477 L208.0063,2778.3477 L208.0063,2785.6582 L198.0063,2795.6582 L20,2795.6582 L20,2778.3477" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="335.416" style="stroke:#000000;stroke-width:1.5;" width="2419.7285" x="20" y="2778.3477"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="143.0063" x="35" y="2791.916">Loan Creation Failure</text><g class="message" data-participant-1="LoanService" data-participant-2="LoanRepo"><polygon fill="#181818" points="2353.4233,2812.9688,2363.4233,2816.9688,2353.4233,2820.9688,2357.4233,2816.9688" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1074.0171" x2="2359.4233" y1="2816.9688" y2="2816.9688"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176.103" x="1081.0171" y="2812.2266">save(loan) throws Exception</text></g><g class="message" data-participant-1="LoanRepo" data-participant-2="LoanService"><polygon fill="#181818" points="1085.0171,2842.2793,1075.0171,2846.2793,1085.0171,2850.2793,1081.0171,2846.2793" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="1079.0171" x2="2369.4233" y1="2846.2793" y2="2846.2793"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119.9644" x="1091.0171" y="2841.5371">DatabaseException</text></g><g class="message" data-participant-1="LoanService" data-participant-2="CustomerService"><polygon fill="#181818" points="1358.6934,2871.5898,1368.6934,2875.5898,1358.6934,2879.5898,1362.6934,2875.5898" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1074.0171" x2="1364.6934" y1="2875.5898" y2="2875.5898"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="249.2153" x="1081.0171" y="2870.8477">releaseCredit(customerId, totalAmount)</text></g><g class="message" data-participant-1="CustomerService" data-participant-2="CustomerAggregate"><polygon fill="#181818" points="2036.832,2900.9004,2046.832,2904.9004,2036.832,2908.9004,2040.832,2904.9004" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1380.6934" x2="2042.832" y1="2904.9004" y2="2904.9004"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="139.7246" x="1387.6934" y="2900.1582">releaseCredit(amount)</text></g><g class="message" data-participant-1="CustomerAggregate" data-participant-2="CustomerAggregate"><line style="stroke:#181818;stroke-width:1;" x1="2058.832" x2="2100.832" y1="2934.2109" y2="2934.2109"/><line style="stroke:#181818;stroke-width:1;" x1="2100.832" x2="2100.832" y1="2934.2109" y2="2947.2109"/><line style="stroke:#181818;stroke-width:1;" x1="2059.832" x2="2100.832" y1="2947.2109" y2="2947.2109"/><polygon fill="#181818" points="2069.832,2943.2109,2059.832,2947.2109,2069.832,2951.2109,2065.832,2947.2109" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161.2876" x="2065.832" y="2929.4688">Decrease usedCreditLimit</text></g><g class="message" data-participant-1="CustomerAggregate" data-participant-2="CustomerAggregate"><line style="stroke:#181818;stroke-width:1;" x1="2058.832" x2="2100.832" y1="2981.5215" y2="2981.5215"/><line style="stroke:#181818;stroke-width:1;" x1="2100.832" x2="2100.832" y1="2981.5215" y2="2994.5215"/><line style="stroke:#181818;stroke-width:1;" x1="2053.832" x2="2100.832" y1="2994.5215" y2="2994.5215"/><polygon fill="#181818" points="2063.832,2990.5215,2053.832,2994.5215,2063.832,2998.5215,2059.832,2994.5215" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="166.5815" x="2065.832" y="2976.7793">raiseEvent(CreditReleased)</text></g><g class="message" data-participant-1="CustomerService" data-participant-2="CustomerService"><line style="stroke:#181818;stroke-width:1;" x1="1380.6934" x2="1422.6934" y1="3023.832" y2="3023.832"/><line style="stroke:#181818;stroke-width:1;" x1="1422.6934" x2="1422.6934" y1="3023.832" y2="3036.832"/><line style="stroke:#181818;stroke-width:1;" x1="1375.6934" x2="1422.6934" y1="3036.832" y2="3036.832"/><polygon fill="#181818" points="1385.6934,3032.832,1375.6934,3036.832,1385.6934,3040.832,1381.6934,3036.832" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="199.9829" x="1387.6934" y="3019.0898">Save customer &amp; publish events</text></g><g class="message" data-participant-1="LoanService" data-participant-2="Controller"><polygon fill="#181818" points="684.3936,3057.1426,674.3936,3061.1426,684.3936,3065.1426,680.3936,3061.1426" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="678.3936" x2="1073.0171" y1="3061.1426" y2="3061.1426"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156.6348" x="690.3936" y="3056.4004">throw BusinessException</text></g><g class="message" data-participant-1="Controller" data-participant-2="Employee"><polygon fill="#181818" points="99.0576,3101.7637,89.0576,3105.7637,99.0576,3109.7637,95.0576,3105.7637" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="93.0576" x2="672.3936" y1="3105.7637" y2="3105.7637"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155.0859" x="105.0576" y="3085.7109">500 Internal Server Error</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="196.1743" x="105.0576" y="3101.0215">{errorCode: "BUSINESS_ERROR"}</text></g><path d="M27,3125.7637 L27,3257.7637 L2801,3257.7637 L2801,3135.7637 L2791,3125.7637 L27,3125.7637" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M2791,3125.7637 L2791,3135.7637 L2801,3135.7637 L2791,3125.7637" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="195.4507" x="1247.4189" y="3143.332">Key Business Rules Enforced:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="1247.4189" y="3158.6426">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="282.7817" x="1247.4189" y="3173.9531">1. Interest rate: 0.1 &#8804; rate &#8804; 0.5 (10% - 50%)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="278.0908" x="1247.4189" y="3189.2637">2. Installments: Only 6, 9, 12, or 24 allowed</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="319.23" x="1247.4189" y="3204.5742">3. Credit validation: totalAmount &#8804; availableCredit</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="284.1528" x="1247.4189" y="3219.8848">4. Equal installments with monthly due dates</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="284.3813" x="1247.4189" y="3235.1953">5. First installment due on 1st of next month</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="325.1523" x="1247.4189" y="3250.5059">6. Atomic credit reservation with rollback on failure</text><path d="M2633,3268.248 L2633,3369.248 L2850,3369.248 L2850,3278.248 L2840,3268.248 L2633,3268.248" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M2840,3268.248 L2840,3278.248 L2850,3278.248 L2840,3268.248" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="91.9775" x="2639" y="3285.8164">SAGA Pattern:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="2639" y="3301.127">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="196.8345" x="2639" y="3316.4375">Ensures distributed transaction</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="183.2061" x="2639" y="3331.748">consistency across Customer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="193.2607" x="2639" y="3347.0586">and Loan contexts with proper</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="159.7642" x="2639" y="3362.3691">compensation on failures</text><!--SRC=[jLbzZkB85V_VfwZjQ2DQeHbWfZjPQsSaypLXmpO8wAmKjTGgxAAfj74vLMKOTZG7o0ds0dkJt2GdoQkoNIuRqp19TgIH0FlztlVllQh-9Y1h6X7azPVJ-LD_EfdEqU_UUT-rXrtdc-nPVtg_d4ydaw5vONJhtNNVcXUysMmoxdlByVG-V-EFmy7RRiUyCPZ-w8tDmzwWqnwspSFn_MZkBPRpX_xoOJuqEaPtlRkUuyIOI-hJ64SINVLmz8A6spXa1qAk41RcY-r1MMRapSQessgZZrYIFJveiUppaMzbqGd3KPz5ahCm95mB5b_FoFwDSBRaYP0BuYUSoiE2y1trKwlDm-FO7LlWnN58VImfYsmCzIZxVWwb3vhObl0JIFdZ2z6yyPoA5qy88iIMHDA6yiONWYZhZHlUypCdpv2IKg7K-r2o-191fM1EOYQePFnWTAgVQaklB3tSWOUpP1LIiScKvpzT8AqBY9CqulWPQtdreIOyplltoDIgbyWDQ5798W6Qatya18hb_Nl7CGL_yy5KiOjcqyKIlS4nVRFhl0b1gtYCFljPbCP14-4jIoBPH1n4ceX6Gk8mLDaJNnuZfOrn-hEsqqKzWZdKz-U_xoKy7CpOp4MVWvZ5Jp5dRFt5mRwaEnNrp037oIqf6VLN7D90lMRSsX0S40wsDHHg4_tmqxA9nf4aN46ow6Oyk2w15OtYGkXKnIqtAfuJiYDXWwTnkIuCCkyxJY5QmV4Y71v-9cX5DdX76KSnbc111AuINRgSn8dKiNZKxKy-oGI7Q0rQ61SsSCdTlD6Bpe0SoC9S5qscFtrn0b9dhUMpHJ4k6Z6-npn0cQiGkJsL6oGoNSXFxRD2K8WxZWLL1JR9AP1FryZrO_G3tc7KxUJ1Gbii_GsDdgjAR5foaQ-y9-gtHjzyxBFj5aU1PRCbfFl06z_Cs9vmLVl0DQW8gUu1MmUeB4WdBn8bb9P8NG_42GSw89P-W-0u1LW5-SS9shA0X8ZiS9XavJ7YE0bCJ08YYP_L3TXE9UBAUk53Sq6aBEYZG9Kf5Gf72H4NjLj_kWNBO-Yy7GbS97b2IZLacGw1woK2HgeGQ9w49Cyn65GNjh81VHpwIQWG9OEyPy62geZ1TiLd8Ve3r0JugJgkg0TEmD1084Wewj7d0V7f5eT7ogepnaLK34FwJ5SXWHhN5MBdIXlXQHlisYwZGErLO2rDnMnmqGQBHR9U0oz3SDFKPDLU0su42_W2wuI2_eRuBmX2GaCC7gcw1nqGlVJ3X6wX66vG8aYGghSYkADSyukc2eZa6YW9sXeQdAk2znMqg3EbDgn41vM6YXmWLKaexMfvnSVJjNaPfCa93gNv4TqpYV8yEmZ-bUgYIaeG0hQ7WI0goHf-yaciwbX3s8HJOk1txJRgOJCleOi8vupteMrTT3M-NpoCHkF-U7Y_VEhFXuFnykgB1ZJa2sXclhh5sD8eolMOHOBai019BKkVqbHVDTCkIGVQ4uMUlMgrMfacAsusvrKUMHHUUP8FN1AA8l95W1K5BBoF7eIGIdgoyyq6um8NwjN64uV8RrItpMG5PGiBYDKakQXZC01FRpIgow8W99UWA057InNI2mcRaxOUsWOSumG9zGIca0IkjeAWfQtlnYRbVaQySoB0tvCHEEuRhWL8HWw_7HMLzVnVISYCzA8eCoAw7ECXrWW5KMdgkboUOog8JaWZbKyJeR9_COLnAtSYyNsOPr_BONMm2xm3OivxvlTvwSCyLolE1JnestKf3nvNumXc10b-8owqsEk_9SElfgYKYsn7OMrRf7bR9s5uq7sfi51-5Zg_Zdma4U6v3UEWzcsxxYAorxyrA7HitT9dhxFfYblPFwroAeFNQ3ETjihtBGxxbZWlUC6MzQzVKAC3kvOsyVeyf8cKvI6id1iIW4c03EatYi3pBIHk4nvGa12aN10NgB2QsfneTKTN98-og4wYgLqHb52biYe1hoHNdyzT604xqb0mbMofnuvvxrYpaWkq_gfQBQagKZk4ihCzxEUN5AL40TjY6cMaWTQSRLCjNp5YJVng9jZhO_LOicwImlag3ebwc0xJBUOlwk91c9uy7gVry_HCq_aXmNoW0w9bHEDaJrsO-oe9Xcdtd-0abSLvjfNfxBrs57qcKXD42ddYy7cw4DSq2dg7SL0lVwuSJnRYMU_LeH8cXZWPWrVE-F1bHs2faYnJc8Lgi9mwfmT7jzr1MQ4zHhRSvzJrqaPKkKjowaU4Gw90_zTzfxVfFwkgLbtNy49rU8Qv0EDv5BBzjKxbCsT9N9aQQdGclEOSSO8oqXagK7ba7YSXnpkHl06MU8M10KimTTbKlzTPLxVZGE-8i-jcoTxgXg7d_wLRfwqEluPUjAQDVtRnWuC_LogELiUlGgbP7xNXmVNH0lAgkV_B8dX2aHtrIxUt_3hcqftj5dOsVHqQmSXMsEfmfzgbihtr7XRZ- -5YyJISpwTpMDnqRqKCp6LQ9eDifkIkb7w_-l0NSYXV445dH6l6VHAutxzPVIXSwxHICzIbizejr3rK1_txdx_gR_f3ktKBUqhxMtG3Ld-RfgUhn0esSD4qWatZhec-Qw9EjucWxRll43nc-sm3VjlADyUTkQjoxHRGkiozIlgkbdpNGaEzsTZyW_JbwD6AemLkMsX4EJXaxqdg5I2M3lpCrh14VfAfj9QuQo4FKa_zx1HLEW1eJIgBA-o_A8nrHawG2gGoOUV3pe8-dy_I6yDAs8Umx8CE550XELqbwkvVSXo9z391l-C34yDZ4la7w5tEHF7NaBIVGRrcpUncE8j9p5cSlU73Ua00KxjH62uAo_y3]--></g></svg>