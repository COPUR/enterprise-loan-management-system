<?xml version="1.0" encoding="us-ascii" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="3842px" preserveAspectRatio="none" style="width:3384px;height:3842px;background:#FFFFFF;" version="1.1" viewBox="0 0 3384 3842" width="3384px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFFF" height="370.5938" style="stroke:#181818;stroke-width:1.0;" width="10" x="623" y="125.6953"/><rect fill="#FFFFFF" height="284.1953" style="stroke:#181818;stroke-width:1.0;" width="10" x="1023" y="212.0938"/><rect fill="#FFFFFF" height="87.3984" style="stroke:#181818;stroke-width:1.0;" width="10" x="1439" y="284.3594"/><rect fill="#FFFFFF" height="201.6641" style="stroke:#181818;stroke-width:1.0;" width="10" x="1439" y="2370.0703"/><rect fill="#FFFFFF" height="101.2656" style="stroke:#181818;stroke-width:1.0;" width="10" x="1754" y="2470.4688"/><rect fill="#FFFFFF" height="113.3984" style="stroke:#181818;stroke-width:1.0;" width="10" x="1928" y="1316.2188"/><rect fill="#FFFFFF" height="155.5313" style="stroke:#181818;stroke-width:1.0;" width="10" x="1928" y="2016.7422"/><rect fill="#FFFFFF" height="30" style="stroke:#181818;stroke-width:1.0;" width="10" x="1928" y="2811.3984"/><rect fill="#FFFFFF" height="35.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="1928" y="3183.8594"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="2218" y="313.4922"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="2218" y="583.3594"/><rect fill="#FFFFFF" height="71.2656" style="stroke:#181818;stroke-width:1.0;" width="10" x="2218" y="1815.9453"/><rect fill="#FFFFFF" height="35.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="2218" y="2399.2031"/><rect fill="#FFFFFF" height="185.7969" style="stroke:#181818;stroke-width:1.0;" width="10" x="2448" y="694.8906"/><rect fill="#FFFFFF" height="203.6641" style="stroke:#181818;stroke-width:1.0;" width="10" x="2448" y="1526.0156"/><rect fill="#FFFFFF" height="462.9922" style="stroke:#181818;stroke-width:1.0;" width="10" x="2794" y="641.625"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="3131" y="2244.5391"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="3131" y="3125.5938"/><rect fill="#FFFFFF" height="30" style="stroke:#181818;stroke-width:1.0;" width="10" x="3131" y="3255.125"/><rect fill="#FFFFFF" height="30" style="stroke:#181818;stroke-width:1.0;" width="10" x="3273.5" y="2541.7344"/><rect fill="#FFFFFF" height="30" style="stroke:#181818;stroke-width:1.0;" width="10" x="3273.5" y="2600.8672"/><rect fill="#FFFFFF" height="30" style="stroke:#181818;stroke-width:1.0;" width="10" x="3273.5" y="2752.2656"/><rect fill="none" height="2601.3047" style="stroke:#000000;stroke-width:1.5;" width="3357" x="10" y="428.8906"/><rect fill="none" height="347.4609" style="stroke:#000000;stroke-width:1.5;" width="754" x="2382" y="656.625"/><rect fill="none" height="59.2656" style="stroke:#000000;stroke-width:1.5;" width="386.5" x="2689.5" y="937.8203"/><rect fill="none" height="1903.5781" style="stroke:#000000;stroke-width:1.5;" width="3337" x="20" y="1119.6172"/><rect fill="none" height="256.9297" style="stroke:#000000;stroke-width:1.5;" width="1835.5" x="918.5" y="1487.75"/><rect fill="none" height="307.0625" style="stroke:#000000;stroke-width:1.5;" width="2428.5" x="918.5" y="2331.8047"/><rect fill="none" height="279.1953" style="stroke:#000000;stroke-width:1.5;" width="3200" x="20" y="3087.3281"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="95" x2="95" y1="36.2969" y2="3806.7109"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="627.5" x2="627.5" y1="36.2969" y2="3806.7109"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1027.5" x2="1027.5" y1="36.2969" y2="3806.7109"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1444" x2="1444" y1="36.2969" y2="3806.7109"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1758.5" x2="1758.5" y1="36.2969" y2="3806.7109"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1933" x2="1933" y1="36.2969" y2="3806.7109"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="2222.5" x2="2222.5" y1="36.2969" y2="3806.7109"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="2453" x2="2453" y1="36.2969" y2="3806.7109"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="2798.5" x2="2798.5" y1="36.2969" y2="3806.7109"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="3136" x2="3136" y1="36.2969" y2="3806.7109"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="3278" x2="3278" y1="36.2969" y2="3806.7109"/><rect fill="#4A90E2" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="130" x="30" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="37" y="24.9951">Customer/Admin</text><rect fill="#4A90E2" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="130" x="30" y="3805.7109"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="37" y="3825.7061">Customer/Admin</text><rect fill="#F5A623" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="141" x="557.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="127" x="564.5" y="24.9951">PaymentController</text><rect fill="#F5A623" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="141" x="557.5" y="3805.7109"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="127" x="564.5" y="3825.7061">PaymentController</text><rect fill="#7ED321" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="199" x="928.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="185" x="935.5" y="24.9951">PaymentApplicationService</text><rect fill="#7ED321" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="199" x="928.5" y="3805.7109"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="185" x="935.5" y="3825.7061">PaymentApplicationService</text><rect fill="#7ED321" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="172" x="1358" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="158" x="1365" y="24.9951">LoanApplicationService</text><rect fill="#7ED321" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="172" x="1358" y="3805.7109"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="158" x="1365" y="3825.7061">LoanApplicationService</text><rect fill="#7ED321" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="207" x="1655.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="193" x="1662.5" y="24.9951">CustomerApplicationService</text><rect fill="#7ED321" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="207" x="1655.5" y="3805.7109"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="193" x="1662.5" y="3825.7061">CustomerApplicationService</text><rect fill="#BD10E0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="74" x="1896" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="60" x="1903" y="24.9951">Payment</text><rect fill="#BD10E0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="74" x="1896" y="3805.7109"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="60" x="1903" y="3825.7061">Payment</text><rect fill="#BD10E0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="47" x="2199.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="33" x="2206.5" y="24.9951">Loan</text><rect fill="#BD10E0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="47" x="2199.5" y="3805.7109"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="33" x="2206.5" y="3825.7061">Loan</text><rect fill="#BD10E0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="122" x="2392" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="108" x="2399" y="24.9951">LoanInstallment</text><rect fill="#BD10E0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="122" x="2392" y="3805.7109"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="108" x="2399" y="3825.7061">LoanInstallment</text><rect fill="#BD10E0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="199" x="2699.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="185" x="2706.5" y="24.9951">PaymentCalculationService</text><rect fill="#BD10E0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="199" x="2699.5" y="3805.7109"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="185" x="2706.5" y="3825.7061">PaymentCalculationService</text><rect fill="#FF6B6B" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="148" x="3062" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="134" x="3069" y="24.9951">PaymentRepository</text><rect fill="#FF6B6B" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="148" x="3062" y="3805.7109"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="134" x="3069" y="3825.7061">PaymentRepository</text><rect fill="#FF6B6B" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="117" x="3220" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="103" x="3227" y="24.9951">EventPublisher</text><rect fill="#FF6B6B" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="117" x="3220" y="3805.7109"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="103" x="3227" y="3825.7061">EventPublisher</text><rect fill="#FFFFFF" height="370.5938" style="stroke:#181818;stroke-width:1.0;" width="10" x="623" y="125.6953"/><rect fill="#FFFFFF" height="284.1953" style="stroke:#181818;stroke-width:1.0;" width="10" x="1023" y="212.0938"/><rect fill="#FFFFFF" height="87.3984" style="stroke:#181818;stroke-width:1.0;" width="10" x="1439" y="284.3594"/><rect fill="#FFFFFF" height="201.6641" style="stroke:#181818;stroke-width:1.0;" width="10" x="1439" y="2370.0703"/><rect fill="#FFFFFF" height="101.2656" style="stroke:#181818;stroke-width:1.0;" width="10" x="1754" y="2470.4688"/><rect fill="#FFFFFF" height="113.3984" style="stroke:#181818;stroke-width:1.0;" width="10" x="1928" y="1316.2188"/><rect fill="#FFFFFF" height="155.5313" style="stroke:#181818;stroke-width:1.0;" width="10" x="1928" y="2016.7422"/><rect fill="#FFFFFF" height="30" style="stroke:#181818;stroke-width:1.0;" width="10" x="1928" y="2811.3984"/><rect fill="#FFFFFF" height="35.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="1928" y="3183.8594"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="2218" y="313.4922"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="2218" y="583.3594"/><rect fill="#FFFFFF" height="71.2656" style="stroke:#181818;stroke-width:1.0;" width="10" x="2218" y="1815.9453"/><rect fill="#FFFFFF" height="35.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="2218" y="2399.2031"/><rect fill="#FFFFFF" height="185.7969" style="stroke:#181818;stroke-width:1.0;" width="10" x="2448" y="694.8906"/><rect fill="#FFFFFF" height="203.6641" style="stroke:#181818;stroke-width:1.0;" width="10" x="2448" y="1526.0156"/><rect fill="#FFFFFF" height="462.9922" style="stroke:#181818;stroke-width:1.0;" width="10" x="2794" y="641.625"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="3131" y="2244.5391"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="3131" y="3125.5938"/><rect fill="#FFFFFF" height="30" style="stroke:#181818;stroke-width:1.0;" width="10" x="3131" y="3255.125"/><rect fill="#FFFFFF" height="30" style="stroke:#181818;stroke-width:1.0;" width="10" x="3273.5" y="2541.7344"/><rect fill="#FFFFFF" height="30" style="stroke:#181818;stroke-width:1.0;" width="10" x="3273.5" y="2600.8672"/><rect fill="#FFFFFF" height="30" style="stroke:#181818;stroke-width:1.0;" width="10" x="3273.5" y="2752.2656"/><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="3377" x="0" y="66.8633"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="3377" y1="66.8633" y2="66.8633"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="3377" y1="69.8633" y2="69.8633"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="236" x="1570.5" y="56.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="217" x="1576.5" y="72.3638">Payment Processing Request</text><polygon fill="#181818" points="611,121.6953,621,125.6953,611,129.6953,615,125.6953" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="95" x2="617" y1="125.6953" y2="125.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="244" x="102" y="105.4966">POST /api/v1/loans/{loanId}/payments</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124" x="102" y="120.6294">{paymentAmount}</text><line style="stroke:#181818;stroke-width:1.0;" x1="633" x2="675" y1="169.9609" y2="169.9609"/><line style="stroke:#181818;stroke-width:1.0;" x1="675" x2="675" y1="169.9609" y2="182.9609"/><line style="stroke:#181818;stroke-width:1.0;" x1="634" x2="675" y1="182.9609" y2="182.9609"/><polygon fill="#181818" points="644,178.9609,634,182.9609,644,186.9609,640,182.9609" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="105" x="640" y="149.7622">Validate request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="87" x="640" y="164.895">(amount &gt; 0)</text><polygon fill="#181818" points="1011,208.0938,1021,212.0938,1011,216.0938,1015,212.0938" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="633" x2="1017" y1="212.0938" y2="212.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="291" x="640" y="207.0278">processPayment(ProcessPaymentCommand)</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="3377" x="0" y="240.6602"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="3377" y1="240.6602" y2="240.6602"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="3377" y1="243.6602" y2="243.6602"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="133" x="1622" y="230.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="114" x="1628" y="246.1606">Loan Validation</text><polygon fill="#181818" points="1427,280.3594,1437,284.3594,1427,288.3594,1431,284.3594" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1033" x2="1433" y1="284.3594" y2="284.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100" x="1040" y="279.2935">getLoan(loanId)</text><polygon fill="#181818" points="2206,309.4922,2216,313.4922,2206,317.4922,2210,313.4922" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1449" x2="2212" y1="313.4922" y2="313.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="1456" y="308.4263">findById(loanId)</text><polygon fill="#181818" points="1460,338.625,1450,342.625,1460,346.625,1456,342.625" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1454" x2="2222" y1="342.625" y2="342.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="73" x="1466" y="337.5591">loan details</text><polygon fill="#181818" points="1044,367.7578,1034,371.7578,1044,375.7578,1040,371.7578" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1038" x2="1443" y1="371.7578" y2="371.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="27" x="1050" y="366.6919">loan</text><line style="stroke:#181818;stroke-width:1.0;" x1="1033" x2="1075" y1="400.8906" y2="400.8906"/><line style="stroke:#181818;stroke-width:1.0;" x1="1075" x2="1075" y1="400.8906" y2="413.8906"/><line style="stroke:#181818;stroke-width:1.0;" x1="1034" x2="1075" y1="413.8906" y2="413.8906"/><polygon fill="#181818" points="1044,409.8906,1034,413.8906,1044,417.8906,1040,413.8906" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="237" x="1040" y="395.8247">Validate loan exists and not fully paid</text><path d="M10,428.8906 L74,428.8906 L74,436.0234 L64,446.0234 L10,446.0234 L10,428.8906 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="2601.3047" style="stroke:#000000;stroke-width:1.5;" width="3357" x="10" y="428.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="25" y="441.9575">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="160" x="89" y="441.1011">[Loan Already Fully Paid]</text><polygon fill="#181818" points="644,463.1563,634,467.1563,644,471.1563,640,467.1563" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="638" x2="1022" y1="467.1563" y2="467.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="334" x="650" y="462.0903">throw BusinessException("Loan is already fully paid")</text><polygon fill="#181818" points="106,492.2891,96,496.2891,106,500.2891,102,496.2891" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="100" x2="627" y1="496.2891" y2="496.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="112" y="491.2231">400 Bad Request</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="3367" y1="505.2891" y2="505.2891"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="201" x="15" y="515.4995">[Loan Has Unpaid Installments]</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="3377" x="0" y="539.6602"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="3377" y1="539.6602" y2="539.6602"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="3377" y1="542.6602" y2="542.6602"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="170" x="1603.5" y="529.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="151" x="1609.5" y="545.1606">Payment Calculation</text><polygon fill="#181818" points="2206,579.3594,2216,583.3594,2206,587.3594,2210,583.3594" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1028" x2="2212" y1="583.3594" y2="583.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154" x="1035" y="578.2935">getUnpaidInstallments()</text><polygon fill="#181818" points="1039,608.4922,1029,612.4922,1039,616.4922,1035,612.4922" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1033" x2="2222" y1="612.4922" y2="612.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="146" x="1045" y="607.4263">List&lt;LoanInstallment&gt;</text><polygon fill="#181818" points="2782,637.625,2792,641.625,2782,645.625,2786,641.625" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1028" x2="2788" y1="641.625" y2="641.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="356" x="1035" y="636.5591">calculatePayment(installments, amount, paymentDate)</text><path d="M2382,656.625 L2459,656.625 L2459,663.7578 L2449,673.7578 L2382,673.7578 L2382,656.625 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="347.4609" style="stroke:#000000;stroke-width:1.5;" width="754" x="2382" y="656.625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="32" x="2397" y="669.6919">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="280" x="2474" y="668.8354">[For each unpaid installment (by due date)]</text><polygon fill="#181818" points="2469,690.8906,2459,694.8906,2469,698.8906,2465,694.8906" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2463" x2="2793" y1="694.8906" y2="694.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="317" x="2475" y="689.8247">calculateEffectivePaymentAmount(paymentDate)</text><line style="stroke:#181818;stroke-width:1.0;" x1="2458" x2="2500" y1="739.1563" y2="739.1563"/><line style="stroke:#181818;stroke-width:1.0;" x1="2500" x2="2500" y1="739.1563" y2="752.1563"/><line style="stroke:#181818;stroke-width:1.0;" x1="2459" x2="2500" y1="752.1563" y2="752.1563"/><polygon fill="#181818" points="2469,748.1563,2459,752.1563,2469,756.1563,2465,752.1563" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="299" x="2465" y="718.9575">calculateEarlyPaymentDiscount(paymentDate)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="206" x="2465" y="734.0903">(amount &#215; 0.001 &#215; daysBefore)</text><line style="stroke:#181818;stroke-width:1.0;" x1="2458" x2="2500" y1="796.4219" y2="796.4219"/><line style="stroke:#181818;stroke-width:1.0;" x1="2500" x2="2500" y1="796.4219" y2="809.4219"/><line style="stroke:#181818;stroke-width:1.0;" x1="2459" x2="2500" y1="809.4219" y2="809.4219"/><polygon fill="#181818" points="2469,805.4219,2459,809.4219,2469,813.4219,2465,809.4219" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="287" x="2465" y="776.2231">calculateLatePaymentPenalty(paymentDate)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="195" x="2465" y="791.356">(amount &#215; 0.001 &#215; daysAfter)</text><line style="stroke:#181818;stroke-width:1.0;" x1="2458" x2="2500" y1="838.5547" y2="838.5547"/><line style="stroke:#181818;stroke-width:1.0;" x1="2500" x2="2500" y1="838.5547" y2="851.5547"/><line style="stroke:#181818;stroke-width:1.0;" x1="2459" x2="2500" y1="851.5547" y2="851.5547"/><polygon fill="#181818" points="2469,847.5547,2459,851.5547,2469,855.5547,2465,851.5547" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="291" x="2465" y="833.4888">Effective amount = base - discount + penalty</text><polygon fill="#181818" points="2782,876.6875,2792,880.6875,2782,884.6875,2786,880.6875" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2453" x2="2788" y1="880.6875" y2="880.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="108" x="2460" y="875.6216">effective amount</text><line style="stroke:#181818;stroke-width:1.0;" x1="2804" x2="2846" y1="909.8203" y2="909.8203"/><line style="stroke:#181818;stroke-width:1.0;" x1="2846" x2="2846" y1="909.8203" y2="922.8203"/><line style="stroke:#181818;stroke-width:1.0;" x1="2805" x2="2846" y1="922.8203" y2="922.8203"/><polygon fill="#181818" points="2815,918.8203,2805,922.8203,2815,926.8203,2811,922.8203" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="313" x="2811" y="904.7544">Check if payment amount covers this installment</text><path d="M2689.5,937.8203 L2777.5,937.8203 L2777.5,944.9531 L2767.5,954.9531 L2689.5,954.9531 L2689.5,937.8203 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="59.2656" style="stroke:#000000;stroke-width:1.5;" width="386.5" x="2689.5" y="937.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="43" x="2704.5" y="950.8872">break</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="194" x="2792.5" y="950.0308">[Payment amount insufficient]</text><line style="stroke:#181818;stroke-width:1.0;" x1="2804" x2="2846" y1="976.0859" y2="976.0859"/><line style="stroke:#181818;stroke-width:1.0;" x1="2846" x2="2846" y1="976.0859" y2="989.0859"/><line style="stroke:#181818;stroke-width:1.0;" x1="2805" x2="2846" y1="989.0859" y2="989.0859"/><polygon fill="#181818" points="2815,985.0859,2805,989.0859,2815,993.0859,2811,989.0859" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="253" x="2811" y="971.02">Stop processing remaining installments</text><line style="stroke:#181818;stroke-width:1.0;" x1="2804" x2="2846" y1="1047.3516" y2="1047.3516"/><line style="stroke:#181818;stroke-width:1.0;" x1="2846" x2="2846" y1="1047.3516" y2="1060.3516"/><line style="stroke:#181818;stroke-width:1.0;" x1="2805" x2="2846" y1="1060.3516" y2="1060.3516"/><polygon fill="#181818" points="2815,1056.3516,2805,1060.3516,2815,1064.3516,2811,1060.3516" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="206" x="2811" y="1027.1528">Validate advance payment rules</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147" x="2811" y="1042.2856">(max 3 months ahead)</text><polygon fill="#181818" points="1039,1100.6172,1029,1104.6172,1039,1108.6172,1035,1104.6172" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1033" x2="2798" y1="1104.6172" y2="1104.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="166" x="1045" y="1084.4185">PaymentCalculationResult</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="309" x="1045" y="1099.5513">{installmentsToPay, totalDiscount, totalPenalty}</text><path d="M20,1119.6172 L84,1119.6172 L84,1126.75 L74,1136.75 L20,1136.75 L20,1119.6172 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="1903.5781" style="stroke:#000000;stroke-width:1.5;" width="3337" x="20" y="1119.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="35" y="1132.6841">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="192" x="99" y="1131.8276">[No Installments Can Be Paid]</text><polygon fill="#181818" points="639,1153.8828,629,1157.8828,639,1161.8828,635,1157.8828" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="633" x2="1027" y1="1157.8828" y2="1157.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="361" x="645" y="1152.8169">throw BusinessException("Payment amount insufficient")</text><polygon fill="#181818" points="106,1183.0156,96,1187.0156,106,1191.0156,102,1187.0156" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="100" x2="627" y1="1187.0156" y2="1187.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="112" y="1181.9497">400 Bad Request</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="20" x2="3357" y1="1196.0156" y2="1196.0156"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="171" x="25" y="1206.2261">[Installments Can Be Paid]</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="3377" x="0" y="1230.3867"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="3377" y1="1230.3867" y2="1230.3867"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="3377" y1="1233.3867" y2="1233.3867"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="151" x="1613" y="1219.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="132" x="1619" y="1235.8872">Payment Creation</text><line style="stroke:#181818;stroke-width:1.0;" x1="1028" x2="1070" y1="1274.0859" y2="1274.0859"/><line style="stroke:#181818;stroke-width:1.0;" x1="1070" x2="1070" y1="1274.0859" y2="1287.0859"/><line style="stroke:#181818;stroke-width:1.0;" x1="1029" x2="1070" y1="1287.0859" y2="1287.0859"/><polygon fill="#181818" points="1039,1283.0859,1029,1287.0859,1039,1291.0859,1035,1287.0859" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="132" x="1035" y="1269.02">Generate PaymentId</text><polygon fill="#181818" points="1916,1312.2188,1926,1316.2188,1916,1320.2188,1920,1316.2188" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1028" x2="1922" y1="1316.2188" y2="1316.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="326" x="1035" y="1311.1528">new Payment(paymentId, loanId, paymentAmount)</text><line style="stroke:#181818;stroke-width:1.0;" x1="1938" x2="1980" y1="1345.3516" y2="1345.3516"/><line style="stroke:#181818;stroke-width:1.0;" x1="1980" x2="1980" y1="1345.3516" y2="1358.3516"/><line style="stroke:#181818;stroke-width:1.0;" x1="1939" x2="1980" y1="1358.3516" y2="1358.3516"/><polygon fill="#181818" points="1949,1354.3516,1939,1358.3516,1949,1362.3516,1945,1358.3516" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145" x="1945" y="1340.2856">Set status = INITIATED</text><line style="stroke:#181818;stroke-width:1.0;" x1="1938" x2="1980" y1="1387.4844" y2="1387.4844"/><line style="stroke:#181818;stroke-width:1.0;" x1="1980" x2="1980" y1="1387.4844" y2="1400.4844"/><line style="stroke:#181818;stroke-width:1.0;" x1="1939" x2="1980" y1="1400.4844" y2="1400.4844"/><polygon fill="#181818" points="1949,1396.4844,1939,1400.4844,1949,1404.4844,1945,1400.4844" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185" x="1945" y="1382.4185">raiseEvent(PaymentInitiated)</text><polygon fill="#181818" points="1039,1425.6172,1029,1429.6172,1039,1433.6172,1035,1429.6172" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1033" x2="1932" y1="1429.6172" y2="1429.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="115" x="1045" y="1424.5513">payment instance</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="3377" x="0" y="1458.1836"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="3377" y1="1458.1836" y2="1458.1836"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="3377" y1="1461.1836" y2="1461.1836"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="257" x="1560" y="1447.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="238" x="1566" y="1463.6841">Installment Payment Processing</text><path d="M918.5,1487.75 L995.5,1487.75 L995.5,1494.8828 L985.5,1504.8828 L918.5,1504.8828 L918.5,1487.75 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="256.9297" style="stroke:#000000;stroke-width:1.5;" width="1835.5" x="918.5" y="1487.75"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="32" x="933.5" y="1500.8169">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="186" x="1010.5" y="1499.9604">[For each installment to pay]</text><polygon fill="#181818" points="2436,1522.0156,2446,1526.0156,2436,1530.0156,2440,1526.0156" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1028" x2="2442" y1="1526.0156" y2="1526.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="335" x="1035" y="1520.9497">processPayment(installmentAmount, paymentDate)</text><line style="stroke:#181818;stroke-width:1.0;" x1="2458" x2="2500" y1="1555.1484" y2="1555.1484"/><line style="stroke:#181818;stroke-width:1.0;" x1="2500" x2="2500" y1="1555.1484" y2="1568.1484"/><line style="stroke:#181818;stroke-width:1.0;" x1="2459" x2="2500" y1="1568.1484" y2="1568.1484"/><polygon fill="#181818" points="2469,1564.1484,2459,1568.1484,2469,1572.1484,2465,1568.1484" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="159" x="2465" y="1550.0825">Validate not already paid</text><line style="stroke:#181818;stroke-width:1.0;" x1="2458" x2="2500" y1="1597.2813" y2="1597.2813"/><line style="stroke:#181818;stroke-width:1.0;" x1="2500" x2="2500" y1="1597.2813" y2="1610.2813"/><line style="stroke:#181818;stroke-width:1.0;" x1="2459" x2="2500" y1="1610.2813" y2="1610.2813"/><polygon fill="#181818" points="2469,1606.2813,2459,1610.2813,2469,1614.2813,2465,1610.2813" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="277" x="2465" y="1592.2153">Validate full payment (no partial payments)</text><line style="stroke:#181818;stroke-width:1.0;" x1="2458" x2="2500" y1="1639.4141" y2="1639.4141"/><line style="stroke:#181818;stroke-width:1.0;" x1="2500" x2="2500" y1="1639.4141" y2="1652.4141"/><line style="stroke:#181818;stroke-width:1.0;" x1="2459" x2="2500" y1="1652.4141" y2="1652.4141"/><polygon fill="#181818" points="2469,1648.4141,2459,1652.4141,2469,1656.4141,2465,1652.4141" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173" x="2465" y="1634.3481">Set paidAmount = amount</text><line style="stroke:#181818;stroke-width:1.0;" x1="2458" x2="2500" y1="1681.5469" y2="1681.5469"/><line style="stroke:#181818;stroke-width:1.0;" x1="2500" x2="2500" y1="1681.5469" y2="1694.5469"/><line style="stroke:#181818;stroke-width:1.0;" x1="2459" x2="2500" y1="1694.5469" y2="1694.5469"/><polygon fill="#181818" points="2469,1690.5469,2459,1694.5469,2469,1698.5469,2465,1694.5469" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="2465" y="1676.481">Set paymentDate = now</text><line style="stroke:#181818;stroke-width:1.0;" x1="2458" x2="2500" y1="1728.6797" y2="1728.6797"/><line style="stroke:#181818;stroke-width:1.0;" x1="2500" x2="2500" y1="1728.6797" y2="1741.6797"/><line style="stroke:#181818;stroke-width:1.0;" x1="2453" x2="2500" y1="1741.6797" y2="1741.6797"/><polygon fill="#181818" points="2463,1737.6797,2453,1741.6797,2463,1745.6797,2459,1741.6797" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="108" x="2465" y="1723.6138">Set isPaid = true</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="3377" x="0" y="1772.2461"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="3377" y1="1772.2461" y2="1772.2461"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="3377" y1="1775.2461" y2="1775.2461"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="165" x="1606" y="1761.6797"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="146" x="1612" y="1777.7466">Loan Status Update</text><polygon fill="#181818" points="2206,1811.9453,2216,1815.9453,2206,1819.9453,2210,1815.9453" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1028" x2="2212" y1="1815.9453" y2="1815.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="75" x="1035" y="1810.8794">isFullyPaid()</text><line style="stroke:#181818;stroke-width:1.0;" x1="2228" x2="2270" y1="1845.0781" y2="1845.0781"/><line style="stroke:#181818;stroke-width:1.0;" x1="2270" x2="2270" y1="1845.0781" y2="1858.0781"/><line style="stroke:#181818;stroke-width:1.0;" x1="2229" x2="2270" y1="1858.0781" y2="1858.0781"/><polygon fill="#181818" points="2239,1854.0781,2229,1858.0781,2239,1862.0781,2235,1858.0781" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="206" x="2235" y="1840.0122">Check if all installments are paid</text><polygon fill="#181818" points="1039,1883.2109,1029,1887.2109,1039,1891.2109,1035,1887.2109" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1033" x2="2222" y1="1887.2109" y2="1887.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="105" x="1045" y="1882.145">isFullyPaid result</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="3377" x="0" y="1915.7773"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="3377" y1="1915.7773" y2="1915.7773"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="3377" y1="1918.7773" y2="1918.7773"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="221" x="1578" y="1905.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="202" x="1584" y="1921.2778">Payment Result Processing</text><line style="stroke:#181818;stroke-width:1.0;" x1="1028" x2="1070" y1="1974.6094" y2="1974.6094"/><line style="stroke:#181818;stroke-width:1.0;" x1="1070" x2="1070" y1="1974.6094" y2="1987.6094"/><line style="stroke:#181818;stroke-width:1.0;" x1="1029" x2="1070" y1="1987.6094" y2="1987.6094"/><polygon fill="#181818" points="1039,1983.6094,1029,1987.6094,1039,1991.6094,1035,1987.6094" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143" x="1035" y="1954.4106">Create PaymentResult</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="402" x="1035" y="1969.5435">{installmentsPaid, totalDiscount, totalPenalty, isLoanFullyPaid}</text><polygon fill="#181818" points="1916,2012.7422,1926,2016.7422,1916,2020.7422,1920,2016.7422" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1028" x2="1922" y1="2016.7422" y2="2016.7422"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213" x="1035" y="2011.6763">processPayment(paymentResult)</text><line style="stroke:#181818;stroke-width:1.0;" x1="1938" x2="1980" y1="2045.875" y2="2045.875"/><line style="stroke:#181818;stroke-width:1.0;" x1="1980" x2="1980" y1="2045.875" y2="2058.875"/><line style="stroke:#181818;stroke-width:1.0;" x1="1939" x2="1980" y1="2058.875" y2="2058.875"/><polygon fill="#181818" points="1949,2054.875,1939,2058.875,1949,2062.875,1945,2058.875" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="266" x="1945" y="2040.8091">Set installmentsPaid, discounts, penalties</text><line style="stroke:#181818;stroke-width:1.0;" x1="1938" x2="1980" y1="2088.0078" y2="2088.0078"/><line style="stroke:#181818;stroke-width:1.0;" x1="1980" x2="1980" y1="2088.0078" y2="2101.0078"/><line style="stroke:#181818;stroke-width:1.0;" x1="1939" x2="1980" y1="2101.0078" y2="2101.0078"/><polygon fill="#181818" points="1949,2097.0078,1939,2101.0078,1949,2105.0078,1945,2101.0078" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="163" x="1945" y="2082.9419">Set status = COMPLETED</text><line style="stroke:#181818;stroke-width:1.0;" x1="1938" x2="1980" y1="2130.1406" y2="2130.1406"/><line style="stroke:#181818;stroke-width:1.0;" x1="1980" x2="1980" y1="2130.1406" y2="2143.1406"/><line style="stroke:#181818;stroke-width:1.0;" x1="1939" x2="1980" y1="2143.1406" y2="2143.1406"/><polygon fill="#181818" points="1949,2139.1406,1939,2143.1406,1949,2147.1406,1945,2143.1406" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="200" x="1945" y="2125.0747">raiseEvent(PaymentProcessed)</text><polygon fill="#181818" points="1039,2168.2734,1029,2172.2734,1039,2176.2734,1035,2172.2734" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1033" x2="1932" y1="2172.2734" y2="2172.2734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="1045" y="2167.2075">updated payment</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="3377" x="0" y="2200.8398"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="3377" y1="2200.8398" y2="2200.8398"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="3377" y1="2203.8398" y2="2203.8398"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="105" x="1636" y="2190.2734"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="86" x="1642" y="2206.3403">Persistence</text><polygon fill="#181818" points="3119,2240.5391,3129,2244.5391,3119,2248.5391,3123,2244.5391" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1028" x2="3125" y1="2244.5391" y2="2244.5391"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97" x="1035" y="2239.4731">save(payment)</text><polygon fill="#181818" points="1039,2269.6719,1029,2273.6719,1039,2277.6719,1035,2273.6719" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1033" x2="3135" y1="2273.6719" y2="2273.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99" x="1045" y="2268.606">saved payment</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="3377" x="0" y="2302.2383"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="3377" y1="2302.2383" y2="2302.2383"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="3377" y1="2305.2383" y2="2305.2383"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="264" x="1556.5" y="2291.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="245" x="1562.5" y="2307.7388">Credit Release (if loan fully paid)</text><path d="M918.5,2331.8047 L982.5,2331.8047 L982.5,2338.9375 L972.5,2348.9375 L918.5,2348.9375 L918.5,2331.8047 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="307.0625" style="stroke:#000000;stroke-width:1.5;" width="2428.5" x="918.5" y="2331.8047"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="933.5" y="2344.8716">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="108" x="997.5" y="2344.0151">[Loan Fully Paid]</text><polygon fill="#181818" points="1427,2366.0703,1437,2370.0703,1427,2374.0703,1431,2370.0703" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1028" x2="1433" y1="2370.0703" y2="2370.0703"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="183" x="1035" y="2365.0044">markLoanAsFullyPaid(loanId)</text><polygon fill="#181818" points="2206,2395.2031,2216,2399.2031,2206,2403.2031,2210,2399.2031" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1449" x2="2212" y1="2399.2031" y2="2399.2031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="86" x="1456" y="2394.1372">markAsPaid()</text><line style="stroke:#181818;stroke-width:1.0;" x1="2228" x2="2270" y1="2433.3359" y2="2433.3359"/><line style="stroke:#181818;stroke-width:1.0;" x1="2270" x2="2270" y1="2433.3359" y2="2446.3359"/><line style="stroke:#181818;stroke-width:1.0;" x1="2223" x2="2270" y1="2446.3359" y2="2446.3359"/><polygon fill="#181818" points="2233,2442.3359,2223,2446.3359,2233,2450.3359,2229,2446.3359" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="108" x="2235" y="2428.27">Set isPaid = true</text><polygon fill="#181818" points="1742,2466.4688,1752,2470.4688,1742,2474.4688,1746,2470.4688" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1449" x2="1748" y1="2470.4688" y2="2470.4688"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="286" x="1456" y="2465.4028">releaseCredit(customerId, totalLoanAmount)</text><line style="stroke:#181818;stroke-width:1.0;" x1="1764" x2="1806" y1="2499.6016" y2="2499.6016"/><line style="stroke:#181818;stroke-width:1.0;" x1="1806" x2="1806" y1="2499.6016" y2="2512.6016"/><line style="stroke:#181818;stroke-width:1.0;" x1="1765" x2="1806" y1="2512.6016" y2="2512.6016"/><polygon fill="#181818" points="1775,2508.6016,1765,2512.6016,1775,2516.6016,1771,2512.6016" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="1771" y="2494.5356">Release reserved credit</text><polygon fill="#181818" points="3261.5,2537.7344,3271.5,2541.7344,3261.5,2545.7344,3265.5,2541.7344" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1764" x2="3267.5" y1="2541.7344" y2="2541.7344"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="189" x="1771" y="2536.6685">publishAsync(CreditReleased)</text><polygon fill="#181818" points="3261.5,2596.8672,3271.5,2600.8672,3261.5,2604.8672,3265.5,2600.8672" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1028" x2="3267.5" y1="2600.8672" y2="2600.8672"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="179" x="1035" y="2595.8013">publishAsync(LoanFullyPaid)</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="3377" x="0" y="2666.4336"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="3377" y1="2666.4336" y2="2666.4336"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="3377" y1="2669.4336" y2="2669.4336"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="142" x="1617.5" y="2655.8672"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="123" x="1623.5" y="2671.9341">Event Publishing</text><line style="stroke:#181818;stroke-width:1.0;" x1="1028" x2="1070" y1="2710.1328" y2="2710.1328"/><line style="stroke:#181818;stroke-width:1.0;" x1="1070" x2="1070" y1="2710.1328" y2="2723.1328"/><line style="stroke:#181818;stroke-width:1.0;" x1="1029" x2="1070" y1="2723.1328" y2="2723.1328"/><polygon fill="#181818" points="1039,2719.1328,1029,2723.1328,1039,2727.1328,1035,2723.1328" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="217" x="1035" y="2705.0669">Get domain events from payment</text><polygon fill="#181818" points="3261.5,2748.2656,3271.5,2752.2656,3261.5,2756.2656,3265.5,2752.2656" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1028" x2="3267.5" y1="2752.2656" y2="2752.2656"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="216" x="1035" y="2747.1997">publishAsync(PaymentProcessed)</text><polygon fill="#181818" points="1916,2807.3984,1926,2811.3984,1916,2815.3984,1920,2811.3984" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1028" x2="1922" y1="2811.3984" y2="2811.3984"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="1035" y="2806.3325">clearDomainEvents()</text><polygon fill="#181818" points="639,2881.6641,629,2885.6641,639,2889.6641,635,2885.6641" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="633" x2="1027" y1="2885.6641" y2="2885.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96" x="645" y="2865.4653">PaymentResult</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="376" x="645" y="2880.5981">{paymentId, installmentsPaid, totalSpent, isLoanFullyPaid}</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="3377" x="0" y="2914.2305"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="3377" y1="2914.2305" y2="2914.2305"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="3377" y1="2917.2305" y2="2917.2305"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="91" x="1643" y="2903.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="72" x="1649" y="2919.731">Response</text><line style="stroke:#181818;stroke-width:1.0;" x1="628" x2="670" y1="2957.9297" y2="2957.9297"/><line style="stroke:#181818;stroke-width:1.0;" x1="670" x2="670" y1="2957.9297" y2="2970.9297"/><line style="stroke:#181818;stroke-width:1.0;" x1="629" x2="670" y1="2970.9297" y2="2970.9297"/><polygon fill="#181818" points="639,2966.9297,629,2970.9297,639,2974.9297,635,2970.9297" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="221" x="635" y="2952.8638">Convert to PaymentResponse DTO</text><polygon fill="#181818" points="106,3011.1953,96,3015.1953,106,3019.1953,102,3015.1953" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="100" x2="627" y1="3015.1953" y2="3015.1953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="112" y="2994.9966">201 Created</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="509" x="112" y="3010.1294">PaymentResponse{paymentId, installmentsPaid, totalAmountSpent, message}</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="3377" x="0" y="3057.7617"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="3377" y1="3057.7617" y2="3057.7617"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="3377" y1="3060.7617" y2="3060.7617"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="262" x="1557.5" y="3047.1953"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="243" x="1563.5" y="3063.2622">Error Handling (Alternative Flow)</text><path d="M20,3087.3281 L271,3087.3281 L271,3094.4609 L261,3104.4609 L20,3104.4609 L20,3087.3281 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="279.1953" style="stroke:#000000;stroke-width:1.5;" width="3200" x="20" y="3087.3281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="206" x="35" y="3100.395">Payment Processing Failure</text><polygon fill="#181818" points="3119,3121.5938,3129,3125.5938,3119,3129.5938,3123,3125.5938" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1028" x2="3125" y1="3125.5938" y2="3125.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="209" x="1035" y="3120.5278">save(payment) throws Exception</text><polygon fill="#181818" points="1039,3150.7266,1029,3154.7266,1039,3158.7266,1035,3154.7266" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1033" x2="3135" y1="3154.7266" y2="3154.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124" x="1045" y="3149.6606">DatabaseException</text><polygon fill="#181818" points="1916,3179.8594,1926,3183.8594,1916,3187.8594,1920,3183.8594" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1028" x2="1922" y1="3183.8594" y2="3183.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="203" x="1035" y="3178.7935">markAsFailed("Database error")</text><line style="stroke:#181818;stroke-width:1.0;" x1="1938" x2="1980" y1="3217.9922" y2="3217.9922"/><line style="stroke:#181818;stroke-width:1.0;" x1="1980" x2="1980" y1="3217.9922" y2="3230.9922"/><line style="stroke:#181818;stroke-width:1.0;" x1="1933" x2="1980" y1="3230.9922" y2="3230.9922"/><polygon fill="#181818" points="1943,3226.9922,1933,3230.9922,1943,3234.9922,1939,3230.9922" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129" x="1945" y="3212.9263">Set status = FAILED</text><polygon fill="#181818" points="3119,3251.125,3129,3255.125,3119,3259.125,3123,3255.125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1028" x2="3125" y1="3255.125" y2="3255.125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97" x="1035" y="3250.0591">save(payment)</text><polygon fill="#181818" points="639,3310.2578,629,3314.2578,639,3318.2578,635,3314.2578" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="633" x2="1027" y1="3314.2578" y2="3314.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="645" y="3309.1919">throw BusinessException</text><polygon fill="#181818" points="106,3354.5234,96,3358.5234,106,3362.5234,102,3358.5234" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="100" x2="627" y1="3358.5234" y2="3358.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="112" y="3338.3247">500 Internal Server Error</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="214" x="112" y="3353.4575">{errorCode: "BUSINESS_ERROR"}</text><path d="M35,3378.5234 L35,3509.5234 L3337,3509.5234 L3337,3388.5234 L3327,3378.5234 L35,3378.5234 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M3327,3378.5234 L3327,3388.5234 L3337,3388.5234 L3327,3378.5234 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="186" x="1468" y="3395.5903">Business Rules Enforced:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="1468" y="3410.7231">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="1468" y="3425.856">1.</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="156" x="1484" y="3425.856">No Partial Payments:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="209" x="1644" y="3425.856">Must pay full installment amount</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="1468" y="3440.9888">2.</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="117" x="1484" y="3440.9888">Payment Order:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="204" x="1605" y="3440.9888">Earliest unpaid installments first</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="1468" y="3456.1216">3.</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="179" x="1484" y="3456.1216">Advance Payment Limit:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172" x="1667" y="3456.1216">Maximum 3 months ahead</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="1468" y="3471.2544">4.</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="180" x="1484" y="3471.2544">Early Payment Discount:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="227" x="1668" y="3471.2544">amount &#215; 0.001 &#215; days before due</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="1468" y="3486.3872">5.</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="167" x="1484" y="3486.3872">Late Payment Penalty:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="216" x="1655" y="3486.3872">amount &#215; 0.001 &#215; days after due</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="1468" y="3501.52">6.</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="113" x="1484" y="3501.52">Credit Release:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="194" x="1601" y="3501.52">Automatic when loan fully paid</text><path d="M2608,3519.5859 L2608,3665.5859 L2990,3665.5859 L2990,3529.5859 L2980,3519.5859 L2608,3519.5859 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M2980,3519.5859 L2980,3529.5859 L2990,3529.5859 L2980,3519.5859 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="233" x="2614" y="3536.6528">Payment Calculation Algorithm:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="2614" y="3551.7856">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="205" x="2614" y="3566.9185">1. Sort installments by due date</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="2614" y="3582.0513">2. For each installment:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="349" x="2626" y="3597.1841">- Calculate effective amount (base &#177; discount/penalty)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="268" x="2626" y="3612.3169">- Check if payment covers this installment</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="223" x="2626" y="3627.4497">- Add to payment if sufficient funds</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="222" x="2614" y="3642.5825">3. Validate advance payment rules</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170" x="2614" y="3657.7153">4. Return calculation result</text><path d="M1784,3675.7813 L1784,3790.7813 L2082,3790.7813 L2082,3685.7813 L2072,3675.7813 L1784,3675.7813 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M2072,3675.7813 L2072,3685.7813 L2082,3685.7813 L2072,3675.7813 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="180" x="1790" y="3692.8481">Payment State Machine:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="1790" y="3707.981">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="260" x="1790" y="3723.1138">INITIATED &#8594; PROCESSING &#8594; COMPLETED</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="59" x="1830" y="3738.2466">&#8600; FAILED</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="40" x="1790" y="3753.3794">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="277" x="1790" y="3768.5122">Only INITIATED payments can be processed</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="219" x="1790" y="3783.645">Failed payments cannot be retried</text><!--SRC=[lLdRRjl86RxdK_phtiYeivQTGr4XDa39SbQ0OWcItAi0Yp4viWUXXkoGj2C4ljq7w4tx6ds5zatsIVhF36SuF8YcTnSraCGavp_CV_Z-Gtu8wPPn2lvairZzF5dC5oluqpl_hyFfkVT3yMsokDci5lFvr1wuVkz_E7zh3_ZBvNmsyJUpnOqvyPVfrTlpCtlYQl7PdzcFuwkpuNHeFyvkhbV-UhEwdMnkLrChu_h3-CFOyn8YCXQmXF0CZYPvciKxAaxzSCVu4P0KRbCgNFMh14kotr6UJMAUYJYAg50qvMFZSgtaVf94B20PY_cQYaSMKCMc-5gyQfgXociU4tw0aVpKauknm05EvdDFRiKDtDluz_U2tfEiwhJcLQpYVGbcFCr855bvpdC7fN4WYO8yQbuNNvkhliXZHPCuPLaizkvzvTlM4Apoc3xYsML-5x7qeOWYywgTshkuC29WAUA0fYdZzx2YVyzfci75XUUfq7rpwORZ29QBzGPEIS9E7yzE8xHRUlfT_ZCBdqyJpI_zmhyNl_gxEEVPiqU2Z3rA7vIyFC_XMvVoDnAnK9uNMfylV40KAxY4uN6Tj1Re8qZqXOhtWsNbSHBlTeI7nwLILNfb6XaHHWjqgh97JGmATXDZ1FSqaoy6sXmEV-UOvxaq1OioH4U0a1EEzxEmdOizwLNftZIKaUGGqeomAFL2Ue1BLPisKqe-TNfxbwP56lJMaqeX-esbMGfeVk1n1jiyYlQG41Pw7eaoRNK_4fI4UxXM7vVo8-1FNLOzPB874J_1ECSmHbzFlmKqaPuRgEG6Xa8BlgNGesF5sGqcvAh2VWJlXaCOaz1aX3hfsA4MCxMlJfZJADLMWvzaEU1Ii0ikQIKL7I3fY3atO33gD5ENv-0LSTDmsHnzzB46YPSTCTJKqSMz4GJ5dQZ9H-PeUW8wiK-WW8mhFEXexx3ol2YE4xYE1Q0k3v1hMphSO72tXp2d42ecohcEAgYPY-gEPjFjbag9HaMDMuEAIfARLSlXepwelrpc7RA8YFQ5d2kM1Wr99TZzzvym_74uF9E_X6IVZkas5eKg_OJDIxClASSSs_SKvMypAdf8ifOh_0WNS4Smujz0MDmD_Wo95dt0Kes0eJMUzUngDNxDqLMEamSQV0MsDK5cb0tYHofIn0x41zR6zGunuwlDpe8AJ-RRBTPUS_H5-UiC0pSfowoWEyAu_CtD1SMByj2JVxnEXXPMIVX8EBuo5nDvHB403tRa6xo57UBG0qBV0oBVSOrbM-etsvaLJVC8w-ztLz5DZ0TF88lnZGdXuh68icSNBoevB77-9guW81xWCAP_0DPtEEh_1_O7hrO1UWoi3fHlUEOJvLGukip23ZAtFd3wP5wRr9-59w3R2ukw6l2QFL4JvftYqIflJJF0-sTvYb0mkvbjPlvcUjMNMX2MKjMv3in5ESiOVfJnssJIslqL9bOHYxdXDJtfN0jzug9HIqyiFLIjF6x9oM8fi3LiwrXPQqiTBdvR3VoT1ST2XEoqJFEJc1JhHofx9MlF0PTNnQ63s7TfZmeX0qAAzKrzS42z1w4r25Bo-AaV6KjbmY559d9Qskj03L5mQvh-jOxTsqGPe5yFnbBLh4gPlJkl9XTRf52lIbq08gZsN8_kpT45oum4xuxMpG4a3VJrkE-1J0h9Q3cljjGBgKndkJX1jQLgLlNddkXMIwd4LUAFGhFcJKnhWzshRcqOJNyJFauMdvVpwU_2ny9Xhy37N8LsQ7BhHNXSOek48m6LRKPdJAXTnGXIyaYD9ve-a8Sybw1LHycZIqF5HIg7qHSo6RqHbMtd0DD7JPhbb7UibBRZvGjZPNsEtX7nLIMDa-9cDAy0j3iOMy1vOTYNpFsqW8q6jz8BXbKdVBJZti7SFwHZVKM7CQTjgoqz28hlCvFHYctHFbJkKEFajEer4QrIZKSHm_0T1aEWv1zYOBTTY0bw3UQdUnuCjDO5ixhF357TKfNtZNQlvLe75YIMl1bbX_IjeE1hrJM5JBs0OXtu2YZ_X24Knd8q0VgeAizMn3kRXlrlqSIcfh9j5-W7-W4wKrmfFHLbPTtHWB1EU7jfqgXNDQU3Fb3WrbWHifPwTdYSa1v30KdCKmsm7OjHVC29LNMTfMgQycgpyDgdctCSwtML3h_m6bcF6-daBkwrGt-IUrgTxvobhXrVPHWAWHtpJuI7aGp2WHzbL72Y9llhA7xIo7mluZnfwxkl2OjoGGyaK4VDqVDX2dOmhAQHMq8SteUB4NQVH2urglmE5AMEd6y9PLq1v4rfE3WoWe1AonqTj-fTXV3VqdLS-xCvjXpjbsYf4Ayh-9ssVgtHUax-7QFzUnpjPrm5NWIIBxvLWOdPhCmyYKCwWgFnxNfsCrslVvwkLelLqREEOfoTACWbaM9tKeNWZtUNHXDOoRqBJFas5W4DHnzFxoxBMvtzAC_Uo9pLurDnpLITWyzOKIJ8wd7B7IwTKUbSyJ1fiX0X5PfQxXEP_3-RvZuKyPk9OftnLj7xnRh8y9cp7SiABSWtjijtjQsHedsdQDNYqbAQHbuJ7zWYmftQMCgTh6BqNZ6QE-w7OWBePaFaDj9o-Q2uL3i_JU_dM9eHO09uUg2ytWbAbyffcBf-TPTJXLFRbl5-T1yBbZticgvTnw8w982pXJQ-QziTZCpoy8qLHHlBJnWeHFZFl-tKSLgiKuyTylf-iskngIZyC2nM5tfNieLoLOOcus5gegPxrMZYOqMpN72xU9OcAwRFDgEtOerZUJc4Kup80BiNMhEutId1hx_y0vQhnGIpTdRpIJsM0nLKVdxzvLykx9K_wd71CK9AlcQvWRVX6C5coAGw6JHOLmx93SkTR5KpmQWJPly3]--></g></svg>