# Java 21 Performance Optimization Configuration
# Optimized for banking workloads with Virtual Threads and enhanced features

# =====================================================
# Virtual Threads Configuration
# =====================================================

# Enable Virtual Threads for Spring Boot
spring.threads.virtual.enabled=true

# Thread pool configurations for different banking operations
# Loan Processing Virtual Thread Pool
loanmanagement.threading.loan-processing.virtual-threads=true
loanmanagement.threading.loan-processing.core-pool-size=50
loanmanagement.threading.loan-processing.max-pool-size=1000

# Payment Processing Virtual Thread Pool
loanmanagement.threading.payment-processing.virtual-threads=true
loanmanagement.threading.payment-processing.core-pool-size=100
loanmanagement.threading.payment-processing.max-pool-size=2000

# Risk Assessment Virtual Thread Pool
loanmanagement.threading.risk-assessment.virtual-threads=true
loanmanagement.threading.risk-assessment.core-pool-size=30
loanmanagement.threading.risk-assessment.max-pool-size=500

# Fraud Detection Virtual Thread Pool
loanmanagement.threading.fraud-detection.virtual-threads=true
loanmanagement.threading.fraud-detection.core-pool-size=25
loanmanagement.threading.fraud-detection.max-pool-size=300

# Compliance Check Virtual Thread Pool
loanmanagement.threading.compliance-check.virtual-threads=true
loanmanagement.threading.compliance-check.core-pool-size=20
loanmanagement.threading.compliance-check.max-pool-size=200

# =====================================================
# Performance Monitoring Configuration
# =====================================================

# Enable detailed performance metrics
management.endpoints.web.exposure.include=health,metrics,prometheus,performance
management.endpoint.metrics.enabled=true
management.endpoint.prometheus.enabled=true
management.metrics.export.prometheus.enabled=true

# Custom banking metrics
loanmanagement.metrics.enabled=true
loanmanagement.metrics.detailed-timing=true
loanmanagement.metrics.virtual-threads-monitoring=true
loanmanagement.metrics.pattern-matching-performance=true
loanmanagement.metrics.sequenced-collections-performance=true

# Performance thresholds for alerting
loanmanagement.performance.thresholds.loan-processing-ms=5000
loanmanagement.performance.thresholds.payment-processing-ms=2000
loanmanagement.performance.thresholds.risk-assessment-ms=3000
loanmanagement.performance.thresholds.fraud-detection-ms=1000
loanmanagement.performance.thresholds.compliance-check-ms=1500

# =====================================================
# JVM Optimizations for Java 21
# =====================================================

# Memory management optimizations
loanmanagement.jvm.memory.initial-heap-size=2g
loanmanagement.jvm.memory.max-heap-size=8g
loanmanagement.jvm.memory.new-generation-size=1g

# Garbage Collection optimizations for banking workloads
loanmanagement.jvm.gc.collector=ZGC
loanmanagement.jvm.gc.max-pause-time=10ms
loanmanagement.jvm.gc.adaptive-size-policy=true

# JIT Compiler optimizations
loanmanagement.jvm.compiler.tier-compilation=true
loanmanagement.jvm.compiler.aggressive-opts=true
loanmanagement.jvm.compiler.optimize-string-concat=true

# =====================================================
# Banking-Specific Performance Settings
# =====================================================

# High-frequency trading optimizations
loanmanagement.trading.batch-size=1000
loanmanagement.trading.max-concurrent-batches=10
loanmanagement.trading.timeout-ms=100
loanmanagement.trading.virtual-threads-enabled=true

# Payment processing optimizations
loanmanagement.payments.batch-processing=true
loanmanagement.payments.batch-size=500
loanmanagement.payments.concurrent-validation=true
loanmanagement.payments.validation-timeout-ms=2000

# Loan processing optimizations
loanmanagement.loans.concurrent-checks=true
loanmanagement.loans.parallel-risk-assessment=true
loanmanagement.loans.pattern-matching-optimization=true
loanmanagement.loans.state-transition-caching=true

# =====================================================
# Database Performance Optimizations
# =====================================================

# Connection pool optimizations for high-concurrency Virtual Threads
spring.datasource.hikari.maximum-pool-size=100
spring.datasource.hikari.minimum-idle=20
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.leak-detection-threshold=60000

# JPA optimizations for banking entities
spring.jpa.properties.hibernate.jdbc.batch_size=50
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.jdbc.batch_versioned_data=true
spring.jpa.properties.hibernate.connection.provider_disables_autocommit=true

# Query optimization for banking operations
spring.jpa.properties.hibernate.query.plan_cache_max_size=2048
spring.jpa.properties.hibernate.query.plan_parameter_metadata_max_size=256
spring.jpa.properties.hibernate.cache.use_second_level_cache=true
spring.jpa.properties.hibernate.cache.use_query_cache=true

# =====================================================
# Caching Optimizations
# =====================================================

# Redis configuration for high-performance caching
spring.data.redis.timeout=2000ms
spring.data.redis.lettuce.pool.max-active=100
spring.data.redis.lettuce.pool.max-idle=20
spring.data.redis.lettuce.pool.min-idle=5
spring.data.redis.lettuce.pool.max-wait=2000ms

# Banking-specific cache configurations
loanmanagement.cache.customer-profiles.ttl=300s
loanmanagement.cache.customer-profiles.max-size=10000
loanmanagement.cache.risk-assessments.ttl=600s
loanmanagement.cache.risk-assessments.max-size=5000
loanmanagement.cache.compliance-rules.ttl=1800s
loanmanagement.cache.compliance-rules.max-size=1000

# =====================================================
# Security Performance Optimizations
# =====================================================

# JWT token processing optimizations
loanmanagement.security.jwt.cache-tokens=true
loanmanagement.security.jwt.cache-size=5000
loanmanagement.security.jwt.cache-ttl=300s
loanmanagement.security.jwt.async-validation=true

# OAuth2 performance settings
loanmanagement.security.oauth2.connection-pool-size=50
loanmanagement.security.oauth2.connection-timeout=5000ms
loanmanagement.security.oauth2.read-timeout=10000ms

# =====================================================
# Logging and Monitoring Performance
# =====================================================

# Asynchronous logging for high-performance
logging.config=classpath:logback-spring-performance.xml

# Performance logging levels
logging.level.com.loanmanagement.performance=INFO
logging.level.com.loanmanagement.metrics=INFO
logging.level.org.springframework.web.filter.CommonsRequestLoggingFilter=INFO

# Custom performance loggers
loanmanagement.logging.performance.enabled=true
loanmanagement.logging.performance.detailed-metrics=true
loanmanagement.logging.performance.virtual-threads-stats=true
loanmanagement.logging.performance.pattern-matching-timing=true

# =====================================================
# API Performance Settings
# =====================================================

# Request/Response handling optimizations
server.tomcat.threads.max=400
server.tomcat.threads.min-spare=100
server.tomcat.accept-count=200
server.tomcat.max-connections=2000

# HTTP/2 and compression for better performance
server.http2.enabled=true
server.compression.enabled=true
server.compression.mime-types=application/json,application/xml,text/html,text/xml,text/plain

# =====================================================
# Banking Business Logic Performance
# =====================================================

# Amortization calculation optimizations
loanmanagement.calculations.amortization.parallel-computation=true
loanmanagement.calculations.amortization.cache-schedules=true
loanmanagement.calculations.amortization.max-cached-schedules=1000

# Risk calculation performance
loanmanagement.calculations.risk.concurrent-factors=true
loanmanagement.calculations.risk.cache-assessments=true
loanmanagement.calculations.risk.pattern-matching-optimized=true

# Payment allocation performance
loanmanagement.calculations.payment-allocation.batch-processing=true
loanmanagement.calculations.payment-allocation.parallel-validation=true

# =====================================================
# Development and Testing Performance
# =====================================================

# Performance testing configurations
loanmanagement.testing.performance.enabled=true
loanmanagement.testing.performance.benchmark-iterations=5
loanmanagement.testing.performance.warm-up-iterations=2
loanmanagement.testing.performance.detailed-reporting=true

# Mock data generation for performance testing
loanmanagement.testing.mock-data.large-datasets=true
loanmanagement.testing.mock-data.realistic-patterns=true
loanmanagement.testing.mock-data.performance-optimized=true